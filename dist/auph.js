var Auph=function(n){"use strict";var e="[AUPH]";function t(n){console.log(e,n)}function r(n){console.warn(e,n)}function a(n,t){console.error(e,n,t)}function u(n){return void 0===n&&(n=0),performance.now()-n}var i=null,o=["mousedown","pointerdown","touchstart"],c=!1;function f(){return i?"closed"===i.state?(a("invalid state:","Context is closed"),null):i:(r("not initialized"),null)}function s(){var n=0;return i&&("suspended"===i.state?n=2:"running"===i.state&&(n=1)),n}function l(n){t("resuming..."),n.resume().then((function(){t("resumed")})).catch((function(n){c?a("error resuming AudioContext",n):(t("cannot resume until user interaction, setup unlock handler..."),function(){for(var n=document.addEventListener,e=0;e<o.length;++e)n(o[e],d)}())}))}function d(){c=!0;for(var n=document.removeEventListener,e=0;e<o.length;++e)n(o[e],d);i&&"suspended"===i.state&&l(i)}function v(){return i?(r("already initialized"),i):(i=new AudioContext({latencyHint:"interactive",sampleRate:22050}))?("running"===i.state&&function(n){t("AudioContext suspending..."),n.suspend().then((function(){t("AudioContext suspended")})).catch((function(n){a("error suspending AudioContext",n)}))}(i),t("Latency: "+i.baseLatency),t("Sample rate: "+i.sampleRate),i):(a("error create AudioContext"),null)}function g(n){t("shutdown..."),n.close().then((function(){t("shutdown completed")})).catch((function(n){a("shutdown error",n)})),i=null}var h="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=",p=function(n,e){this.el=n,this.node=e};function m(n){return n.el.src===h}function A(n){var e=n.el;e.src!==h&&(e.pause(),e.src=h,e.currentTime=0,n.node.disconnect())}function b(n){n.el.play().then((function(){t("started stream player")})).catch((function(n){a("error on play stream",n)}))}var S=[];function E(n){for(var e=0;e<S.length;++e){var t=S[e];if(m(t))return t.el.src=n,t}if(S.length<4){var r=f();if(r){var a=function(n,e){var t=new Audio(e);return t.preload="metadata",t.preservesPitch=!1,new p(t,n.createMediaElementSource(t))}(r,n);return S.push(a),a}}return null}var R=16776960,w=function(n,e){this.gain=n,this.pan=e,this.stream=null,this.buffer=null,this.rate=1,this.cf=0,this.target=null,this.data=0,this.v=0};function y(n){n.stream&&(A(n.stream),n.stream=null);var e=n.buffer;e&&(0!=(1&n.cf)&&e.stop(),e.disconnect(),n.buffer=null),function(n){n.target&&(n.gain.disconnect(n.target),n.target=null)}(n),n.data=0,n.cf=0,n.v=n.v+256&R}function L(n){if(0==(1&n.cf)){var e=n.buffer;e&&(e.addEventListener("ended",(function(e){n.buffer===e.target&&y(n)})),e.loop=0!=(4&n.cf),e.start(),n.cf|=1)}}function _(n,e){n.rate!==e&&(n.rate=e,n.stream?n.stream.el.playbackRate=e:n.buffer&&(2&n.cf||(n.buffer.playbackRate.value=e)))}var B=[null];function U(n){var e=B[255&n];return e&&e.v===(n&R)?e:null}function V(){for(var n=1;n<B.length;++n){var e=B[n];if(0===e.data)return n|e.v}var t=B.length;if(t<64){var r=f();if(r)return B.push(function(n){var e=n.createGain(),t=n.createStereoPanner();return t.connect(e),new w(e,t)}(r)),t}return 0}var C=function(){this.cf=0,this.data=null},P=[null];var D=function(n,e){void 0===e&&(e=!0),this.gain=n,this.e=e},x=[];function I(n){var e=new D(n.createGain());return x.push(e),e}function T(n){return x[n]}function k(n){var e=T(n);return e?e.gain:void 0}function F(n){if(0!==n)for(var e=1;e<B.length;++e){var t=B[e];t.data===n&&y(t)}else console.warn("invalid source")}return n.BUFFERS_LOADED=2,n.BUS_MASTER=0,n.BUS_MUSIC=2,n.BUS_SFX=1,n.BUS_SPEECH=2,n.DEVICE_SAMPLE_RATE=4,n.DEVICE_STATE=5,n.STREAMS_IN_USE=1,n.STREAMS_LOADED=3,n.VOICES_IN_USE=0,n._getAudioContext=function(){return f()},n.getAudioDataState=function(n){if(0!==n){var e=P[n];if(e)return e.cf}return 0},n.getAudioDataStateString=function(n){var e;return null!==(e=["invalid","loading","-","loaded"][3&n])&&void 0!==e?e:"undefined"},n.getAudioSourceLength=function(n){var e=0;if(0!==n){var t=P[n];t&&t.data&&(4&t.cf||(e=t.data.duration))}return e},n.getBusEnabled=function(n){var e=T(n);return!!e&&e.e},n.getBusVolume=function(n){var e=k(n);return e?e.gain.value:0},n.getDeviceStateString=function(n){var e;return null!==(e=["invalid","running","paused"][n])&&void 0!==e?e:"undefined"},n.getInteger=function(n){switch(n){case 0:for(var e=0,t=1;t<B.length;++t)B[t].buffer&&++e;return e;case 1:return function(){for(var n=0,e=0;e<S.length;++e)m(S[e])||++n;return n}();case 2:case 3:return 0;case 4:var r=f();return r?r.sampleRate:0;case 5:return s()}return 0},n.getLoop=function(n){var e=U(n);return!!e&&0!=(4&e.cf)},n.getPan=function(n){var e=U(n);return e?e.pan.pan.value:0},n.getPause=function(n){var e=U(n);return!!e&&0!=(2&e.cf)},n.getPitch=function(n){var e=U(n);return e?e.rate:1},n.getVoiceLength=function(n){var e=U(n),t=0;return e&&(e.buffer&&e.buffer.buffer?t=e.buffer.buffer.duration:e.stream&&(t=e.stream.el.duration)),t},n.getVoicePosition=function(n){var e=U(n),t=0;return e&&(e.buffer&&e.buffer||e.stream&&(t=e.stream.el.currentTime)),t},n.getVoiceState=function(n){var e=U(n);return e?e.cf:0},n.getVolume=function(n){var e=U(n);return e?e.gain.gain.value:1},n.init=function(){var n=v();n&&function(n){var e=I(n).gain;e.connect(n.destination),I(n).gain.connect(e),I(n).gain.connect(e),I(n).gain.connect(e)}(n)},n.isVoiceValid=function(n){return!!(t=B[255&(e=n)])&&t.v===(e&R);var e,t},n.load=function(n,e){var r=function(){for(var n=1;n<P.length;++n)if(0===P[n].cf)return n;var e=P.length;return e<128?(P.push(new C),e):0}();if(0===r)return 0;var i=P[r];if(i.cf|=1,e)i.cf|=4,fetch(new Request(n)).then((function(n){return n.blob()})).then((function(n){i.data=URL.createObjectURL(n),i.cf|=2}));else{var o=0;fetch(new Request(n)).then((function(n){return n.arrayBuffer()})).then((function(n){var e=f();return e?(o=u(),e.decodeAudioData(n)):null})).then((function(n){i.data=n,n&&(t("decoding time: "+(0|u(o))+" ms."),i.cf|=2)})).catch((function(e){a("can't load audio buffer from "+n,e)}))}return r},n.pause=function(){var n=f();n&&"running"===n.state&&(t("pausing"),n.suspend().then((function(){t("paused")})).catch((function(n){a("pause error",n)})))},n.play=function(n,e,t,a,u,i,o){if(void 0===e&&(e=1),void 0===t&&(t=0),void 0===a&&(a=1),void 0===u&&(u=!1),void 0===i&&(i=!1),void 0===o&&(o=1),0===n)return 0;var c=f();if(!c)return 0;var s=P[n];if(!s)return r("audio source not found"),0;if(0==(2&s.cf))return r("audio source is not loaded yet"),0;if(null===s.data)return r("nothing to play, no audio data"),0;var l=k(o);if(!l)return r("invalid target bus!"),0;var d=V();if(!d)return r("no more free simple voices!"),0;var v=U(d);if(i&&(v.cf|=4),u&&(v.cf|=2),v.rate=1,v.data=n,v.gain.gain.value=e,v.pan.pan.value=t,4&s.cf){var g=E(s.data);if(!g)return r("no more free media stream elements!"),0;v.stream=g,g.el.loop=i,g.node.connect(v.pan),u||(b(g),v.cf|=1)}else!function(n,e,t){var r=e.createBufferSource();r.buffer=t,r.connect(n.pan),n.buffer=r}(v,c,s.data),u||L(v);return function(n,e){if(e!==n.target){var t=n.gain;n.target&&t.disconnect(n.target),n.target=e,e&&t.connect(e)}}(v,l),_(v,a),d},n.resume=function(){var n=f();n&&"suspended"===n.state&&l(n)},n.setBusEnabled=function(n,e){var t=T(n);t&&function(n,e){if(n.e!==e){var t=x[0],r=n===t?f().destination:t.gain;e?n.gain.connect(r):n.gain.disconnect(r),n.e=e}}(t,e)},n.setBusVolume=function(n,e){var t=k(n);t&&(t.gain.value=e)},n.setLoop=function(n,e){var t=U(n);t&&function(n,e){e!==(0!=(4&n.cf))&&(n.cf^=4,n.stream?n.stream.el.loop=e:n.buffer&&(n.buffer.loop=e))}(t,e)},n.setPan=function(n,e){var t=U(n);t&&(t.pan.pan.value=e)},n.setPause=function(n,e){var t=U(n);t&&function(n,e){e!==(0!=(2&n.cf))&&(n.cf^=2,e?n.stream?n.stream.el.pause():n.buffer&&(n.buffer.playbackRate.value=0):n.stream?b(n.stream):n.buffer&&(n.buffer.playbackRate.value=n.rate,L(n)))}(t,e)},n.setPitch=function(n,e){var t=U(n);t&&_(t,e)},n.setVolume=function(n,e){var t=U(n);t&&(t.gain.gain.value=e)},n.shutdown=function(){var n=f();n&&(!function(){for(var n=0;n<x.length;++n)x[n].gain.disconnect();x.length=0}(),B.length=1,P.length=1,function(){for(var n=0;n<S.length;++n){var e=S[n];A(e),e.el.src=""}S.length=0}(),g(n))},n.stop=function(n){var e=U(n);e&&y(e)},n.stopAudioData=F,n.unload=function(n){if(0!==n){F(n);var e=P[n];e&&(0!=(4&e.cf)&&e.data&&URL.revokeObjectURL(e.data),e.cf=0,e.data=null)}},Object.defineProperty(n,"__esModule",{value:!0}),n}({});//# sourceMappingURL=auph.js.map
