{"version":3,"file":"auph.js","sources":["../module/impl/debug.js","../module/impl/Device.js","../module/impl/StreamPlayer.js","../module/impl/Voice.js","../module/impl/AudioData.js","../module/impl/Bus.js","../module/index.js","../module/sa.js"],"sourcesContent":["var TAG = \"[AUPH]\";\nexport function log(message) {\n    console.log(TAG, message);\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function measure(ts) {\n    if (ts === void 0) { ts = 0; }\n    return performance.now() - ts;\n}\n//# sourceMappingURL=debug.js.map","import { error, log, warn } from \"./debug\";\nvar ctx = null;\nvar unlockEvents = [\"mousedown\", \"pointerdown\", \"touchstart\"];\nvar unlocked = false;\nexport function getContext() {\n    if (!ctx) {\n        warn(\"not initialized\");\n        return null;\n    }\n    if (ctx.state === \"closed\") {\n        error(\"invalid state:\", \"Context is closed\");\n        return null;\n    }\n    return ctx;\n}\nexport function getContextState() {\n    var state = 0 /* Invalid */;\n    if (ctx) {\n        if (ctx.state === \"suspended\") {\n            state = 2 /* Paused */;\n        }\n        else if (ctx.state === \"running\") {\n            state = 1 /* Running */;\n        }\n    }\n    return state;\n}\nexport function resumeAudioContext(ctx) {\n    log(\"resuming...\");\n    ctx.resume().then(function () {\n        log(\"resumed\");\n    }).catch(function (reason) {\n        if (!unlocked) {\n            log(\"cannot resume until user interaction, setup unlock handler...\");\n            setupUnlockHandler();\n        }\n        else {\n            error(\"error resuming AudioContext\", reason);\n        }\n    });\n}\nexport function suspendAudioContext(ctx) {\n    log(\"AudioContext suspending...\");\n    ctx.suspend().then(function () {\n        log(\"AudioContext suspended\");\n    }).catch(function (reason) {\n        error(\"error suspending AudioContext\", reason);\n    });\n}\nfunction unlock() {\n    unlocked = true;\n    var removeEventListener = document.removeEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        removeEventListener(unlockEvents[i], unlock);\n    }\n    if (ctx && ctx.state === \"suspended\") {\n        resumeAudioContext(ctx);\n    }\n}\nfunction setupUnlockHandler() {\n    var addEventListener = document.addEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        addEventListener(unlockEvents[i], unlock);\n    }\n}\nexport function initContext() {\n    if (ctx) {\n        warn(\"already initialized\");\n        return ctx;\n    }\n    ctx = new AudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: 22050\n    });\n    if (!ctx) {\n        error(\"error create AudioContext\");\n        return null;\n    }\n    if (ctx.state === \"running\") {\n        suspendAudioContext(ctx);\n    }\n    log(\"Latency: \" + ctx.baseLatency);\n    log(\"Sample rate: \" + ctx.sampleRate);\n    return ctx;\n}\nexport function closeContext(_notNullCtx) {\n    log(\"shutdown...\");\n    _notNullCtx.close().then(function () {\n        log(\"shutdown completed\");\n    }).catch(function (reason) {\n        error(\"shutdown error\", reason);\n    });\n    ctx = null;\n}\n//# sourceMappingURL=Device.js.map","import { getContext } from \"./Device\";\nimport { error, log } from \"./debug\";\nvar emptyWaveData = \"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=\";\nvar StreamPlayer = /** @class */ (function () {\n    function StreamPlayer(el, node) {\n        this.el = el;\n        this.node = node;\n    }\n    return StreamPlayer;\n}());\nexport { StreamPlayer };\nexport function StreamPlayer_create(ctx, url) {\n    var el = new Audio(url);\n    el.preload = \"metadata\";\n    el[\"preservesPitch\"] = false;\n    return new StreamPlayer(el, ctx.createMediaElementSource(el));\n}\nexport function StreamPlayer_isFree(player) {\n    return player.el.src === emptyWaveData;\n}\nexport function StreamPlayer_stop(player) {\n    var el = player.el;\n    if (el.src !== emptyWaveData) {\n        el.pause();\n        el.src = emptyWaveData;\n        el.currentTime = 0;\n        player.node.disconnect();\n    }\n}\nexport function StreamPlayer_resume(player) {\n    player.el.play().then(function () {\n        log(\"started stream player\");\n    }).catch(function (reason) {\n        error(\"error on play stream\", reason);\n    });\n}\nvar players = [];\nvar playersMaxCount = 4;\nexport function getNextStreamPlayer(src) {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        if (StreamPlayer_isFree(player)) {\n            player.el.src = src;\n            return player;\n        }\n    }\n    if (players.length < playersMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var mes = StreamPlayer_create(ctx, src);\n            players.push(mes);\n            return mes;\n        }\n    }\n    return null;\n}\nexport function destroyStreamPlayersPool() {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        StreamPlayer_stop(player);\n        player.el.src = \"\";\n    }\n    players.length = 0;\n}\nexport function getStreamPlayersCount() {\n    var count = 0;\n    for (var i = 0; i < players.length; ++i) {\n        if (!StreamPlayer_isFree(players[i])) {\n            ++count;\n        }\n    }\n    return count;\n}\n//# sourceMappingURL=StreamPlayer.js.map","import { StreamPlayer_resume, StreamPlayer_stop } from \"./StreamPlayer\";\nimport { getContext } from \"./Device\";\nvar vMask = 0xFFFF00;\nvar vIncr = 0x000100;\nvar iMask = 0x0000FF;\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan) {\n        this.gain = gain;\n        this.pan = pan;\n        this.stream = null;\n        // buffer playback\n        this.buffer = null;\n        // common nodes\n        // \"Pitch\" / \"Playback Rate\"\n        this.rate = 1.0;\n        // Control Flags\n        this.cf = 0;\n        this.target = null;\n        this.data = 0;\n        // handle version (maybe will add index as well)\n        this.v = 0;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function Voice_create(ctx) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan);\n}\nexport function Voice_changeDestination(v, target) {\n    if (target !== v.target) {\n        var gain = v.gain;\n        if (v.target) {\n            gain.disconnect(v.target);\n        }\n        v.target = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function Voice_resetDestination(v) {\n    if (v.target) {\n        v.gain.disconnect(v.target);\n        v.target = null;\n    }\n}\nexport function Voice_stop(v) {\n    // stop stream\n    if (v.stream) {\n        StreamPlayer_stop(v.stream);\n        v.stream = null;\n    }\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.cf & 1 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.disconnect();\n        v.buffer = null;\n    }\n    Voice_resetDestination(v);\n    v.data = 0;\n    v.cf = 0;\n    v.v = (v.v + vIncr) & vMask;\n}\nexport function Voice_startBuffer(v) {\n    if ((v.cf & 1 /* Running */) === 0) {\n        var source = v.buffer;\n        if (source) {\n            source.addEventListener(\"ended\", function (e) {\n                // maybe check is useless\n                if (v.buffer === e.target) {\n                    Voice_stop(v);\n                }\n            });\n            source.loop = (v.cf & 4 /* Loop */) !== 0;\n            source.start();\n            v.cf |= 1 /* Running */;\n        }\n    }\n}\nexport function Voice_prepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n}\nexport function Voice_loop(v, value) {\n    var current = (v.cf & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.cf ^= 4 /* Loop */;\n        if (v.stream) {\n            v.stream.el.loop = value;\n        }\n        else if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function Voice_pause(v, value) {\n    var paused = (v.cf & 2 /* Paused */) !== 0;\n    if (value !== paused) {\n        v.cf ^= 2 /* Paused */;\n        if (value) {\n            if (v.stream) {\n                v.stream.el.pause();\n            }\n            else if (v.buffer) {\n                v.buffer.playbackRate.value = 0.0;\n            }\n        }\n        else {\n            if (v.stream) {\n                StreamPlayer_resume(v.stream);\n            }\n            else if (v.buffer) {\n                v.buffer.playbackRate.value = v.rate;\n                // restart if play called in pause mode\n                Voice_startBuffer(v);\n            }\n        }\n    }\n}\nexport function Voice_pitch(v, value) {\n    if (v.rate !== value) {\n        v.rate = value;\n        if (v.stream) {\n            v.stream.el.playbackRate = value;\n        }\n        else if (v.buffer) {\n            if (!(v.cf & 2 /* Paused */)) {\n                v.buffer.playbackRate.value = value;\n            }\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _checkVoiceHandle(handle) {\n    var obj = voicePool[handle & iMask];\n    return !!obj && obj.v === (handle & vMask);\n}\nexport function _getVoiceObjAt(index) {\n    return voicePool[index];\n}\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.v === (handle & vMask)) ? obj : null;\n}\nexport function getNextVoice() {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.data === 0) {\n            return i | v.v;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            voicePool.push(Voice_create(ctx));\n            return index;\n        }\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","var AudioDataObj = /** @class */ (function () {\n    function AudioDataObj() {\n        this.cf = 0 /* Invalid */;\n        this.data = null;\n    }\n    return AudioDataObj;\n}());\nexport { AudioDataObj };\nexport var audioDataPool = [null];\nvar audioDataMaxCount = 128;\nexport function getNextAudioData() {\n    for (var i = 1; i < audioDataPool.length; ++i) {\n        if (audioDataPool[i].cf === 0) {\n            return i;\n        }\n    }\n    var next = audioDataPool.length;\n    if (next < audioDataMaxCount) {\n        audioDataPool.push(new AudioDataObj());\n        return next;\n    }\n    return 0;\n}\n//# sourceMappingURL=AudioData.js.map","import { getContext } from \"./Device\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain, e) {\n        if (e === void 0) { e = true; }\n        this.gain = gain;\n        this.e = e;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nvar busPool = [];\nexport function Bus_create(ctx) {\n    var obj = new BusObj(ctx.createGain());\n    busPool.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = Bus_create(ctx).gain;\n    master.connect(ctx.destination);\n    Bus_create(ctx).gain.connect(master);\n    Bus_create(ctx).gain.connect(master);\n    Bus_create(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busPool.length; ++i) {\n        busPool[i].gain.disconnect();\n    }\n    busPool.length = 0;\n}\nexport function _getBus(handle) {\n    return busPool[handle];\n}\nexport function _getBusGain(handle) {\n    var obj = _getBus(handle);\n    return obj ? obj.gain : undefined;\n}\nexport function Bus_enable(bus, enabled) {\n    if (bus.e !== enabled) {\n        var master = busPool[0];\n        var dest = bus === master ? getContext().destination : master.gain;\n        if (enabled) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.e = enabled;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { destroyStreamPlayersPool, getNextStreamPlayer, getStreamPlayersCount, StreamPlayer_resume } from \"./impl/StreamPlayer\";\nimport { closeContext, getContext, getContextState, initContext, resumeAudioContext } from \"./impl/Device\";\nimport { _checkVoiceHandle, _getVoiceObj, getNextVoice, Voice_changeDestination, Voice_loop, Voice_pause, Voice_pitch, Voice_prepareBuffer, Voice_startBuffer, Voice_stop, voicePool } from \"./impl/Voice\";\nimport { audioDataPool, getNextAudioData } from \"./impl/AudioData\";\nimport { _getBus, _getBusGain, Bus_enable, initBusPool, termBusPool } from \"./impl/Bus\";\nimport { error, log, measure, warn } from \"./impl/debug\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function resume() {\n    var ctx = getContext();\n    if (ctx && ctx.state === \"suspended\") {\n        resumeAudioContext(ctx);\n    }\n}\nexport function pause() {\n    var ctx = getContext();\n    if (ctx && ctx.state === \"running\") {\n        log(\"pausing\");\n        ctx.suspend().then(function () {\n            log(\"paused\");\n        }).catch(function (reason) {\n            error(\"pause error\", reason);\n        });\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        audioDataPool.length = 1;\n        destroyStreamPlayersPool();\n        closeContext(ctx);\n    }\n}\n/*** Context State ***/\nexport function getInteger(param) {\n    switch (param) {\n        case 0 /* VoicesInUse */: {\n            var count = 0;\n            for (var i = 1; i < voicePool.length; ++i) {\n                if (voicePool[i].buffer) {\n                    ++count;\n                }\n            }\n            return count;\n        }\n        case 1 /* StreamsInUse */: {\n            return getStreamPlayersCount();\n        }\n        case 2 /* BuffersLoaded */: {\n            return 0;\n        }\n        case 3 /* StreamsLoaded */: {\n            return 0;\n        }\n        case 4 /* Device_SampleRate */: {\n            var ctx = getContext();\n            return ctx ? ctx.sampleRate : 0;\n        }\n        case 5 /* Device_State */: {\n            return getContextState();\n        }\n    }\n    return 0;\n}\n/**\n * private function to get native HTMl5 AudioContext\n */\nexport function _getAudioContext() {\n    return getContext();\n}\n/***/\nexport function load(filepath, streaming) {\n    var handle = getNextAudioData();\n    if (handle === 0) {\n        return 0;\n    }\n    var obj = audioDataPool[handle];\n    obj.cf |= 1 /* Empty */;\n    if (streaming) {\n        obj.cf |= 4 /* Stream */;\n        fetch(new Request(filepath)).then(function (response) {\n            return response.blob();\n        }).then(function (blob) {\n            obj.data = URL.createObjectURL(blob);\n            obj.cf |= 2 /* Loaded */;\n        });\n    }\n    else {\n        var timeDecoding_1 = 0;\n        fetch(new Request(filepath)).then(function (response) {\n            return response.arrayBuffer();\n        }).then(function (buffer) {\n            var ctx = getContext();\n            if (ctx) {\n                timeDecoding_1 = measure();\n                return ctx.decodeAudioData(buffer);\n            }\n            return null;\n        }).then(function (buffer) {\n            obj.data = buffer;\n            if (buffer) {\n                log(\"decoding time: \" + (measure(timeDecoding_1) | 0) + \" ms.\");\n                obj.cf |= 2 /* Loaded */;\n            }\n        }).catch(function (reason) {\n            error(\"can't load audio buffer from \" + filepath, reason);\n        });\n    }\n    return handle;\n}\nexport function unload(data) {\n    if (data === 0) {\n        return;\n    }\n    stopAudioData(data);\n    var sourceObj = audioDataPool[data];\n    if (sourceObj) {\n        if ((sourceObj.cf & 4 /* Stream */) !== 0 && sourceObj.data) {\n            URL.revokeObjectURL(sourceObj.data);\n        }\n        sourceObj.cf = 0;\n        sourceObj.data = null;\n    }\n}\n/***\n *\n * @param data\n * @param volume\n * @param pan\n * @param pitch\n * @param paused\n * @param loop\n * @param bus\n */\nexport function play(data, volume, pan, pitch, paused, loop, bus) {\n    if (volume === void 0) { volume = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (pitch === void 0) { pitch = 1.0; }\n    if (paused === void 0) { paused = false; }\n    if (loop === void 0) { loop = false; }\n    if (bus === void 0) { bus = 1; }\n    if (data === 0) {\n        return 0;\n    }\n    var ctx = getContext();\n    if (!ctx) {\n        return 0;\n    }\n    var dataObj = audioDataPool[data];\n    if (!dataObj) {\n        warn(\"audio source not found\");\n        return 0;\n    }\n    if ((dataObj.cf & 2 /* Loaded */) === 0) {\n        warn(\"audio source is not loaded yet\");\n        return 0;\n    }\n    if (dataObj.data === null) {\n        warn(\"nothing to play, no audio data\");\n        return 0;\n    }\n    var targetNode = _getBusGain(bus);\n    if (!targetNode) {\n        warn(\"invalid target bus!\");\n        return 0;\n    }\n    var voice = getNextVoice();\n    if (!voice) {\n        warn(\"no more free simple voices!\");\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    if (loop) {\n        voiceObj.cf |= 4 /* Loop */;\n    }\n    if (paused) {\n        voiceObj.cf |= 2 /* Paused */;\n    }\n    voiceObj.rate = 1.0;\n    voiceObj.data = data;\n    voiceObj.gain.gain.value = volume;\n    voiceObj.pan.pan.value = pan;\n    if (dataObj.cf & 4 /* Stream */) {\n        var mes = getNextStreamPlayer(dataObj.data);\n        if (!mes) {\n            warn(\"no more free media stream elements!\");\n            return 0;\n        }\n        voiceObj.stream = mes;\n        mes.el.loop = loop;\n        mes.node.connect(voiceObj.pan);\n        if (!paused) {\n            StreamPlayer_resume(mes);\n            voiceObj.cf |= 1 /* Running */;\n        }\n    }\n    else {\n        Voice_prepareBuffer(voiceObj, ctx, dataObj.data);\n        if (!paused) {\n            Voice_startBuffer(voiceObj);\n        }\n    }\n    // maybe we need to set target before `startBuffer()`\n    Voice_changeDestination(voiceObj, targetNode);\n    Voice_pitch(voiceObj, pitch);\n    return voice;\n}\nexport function stop(voice) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_stop(obj);\n    }\n}\nexport function isVoiceValid(voice) {\n    return _checkVoiceHandle(voice);\n}\nexport function getVoiceState(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.cf : 0;\n}\nexport function setPan(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        obj.pan.pan.value = value;\n    }\n}\nexport function setVolume(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        obj.gain.gain.value = value;\n    }\n}\nexport function setPitch(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_pitch(obj, value);\n    }\n}\nexport function setPause(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_pause(obj, value);\n    }\n}\nexport function setLoop(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_loop(obj, value);\n    }\n}\nexport function getPan(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.pan.pan.value : 0.0;\n}\nexport function getVolume(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.gain.gain.value : 1.0;\n}\nexport function getPitch(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.rate : 1.0;\n}\nexport function getPause(voice) {\n    var obj = _getVoiceObj(voice);\n    return !!obj && (obj.cf & 2 /* Paused */) !== 0;\n}\nexport function getLoop(voice) {\n    var obj = _getVoiceObj(voice);\n    return !!obj && (obj.cf & 4 /* Loop */) !== 0;\n}\nexport function stopAudioData(data) {\n    if (data === 0) {\n        console.warn(\"invalid source\");\n        return;\n    }\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.data === data) {\n            Voice_stop(v);\n        }\n    }\n}\n/** Bus controls **/\nexport function setBusVolume(bus, value) {\n    var gain = _getBusGain(bus);\n    if (gain) {\n        gain.gain.value = value;\n    }\n}\nexport function getBusVolume(bus) {\n    var gain = _getBusGain(bus);\n    return gain ? gain.gain.value : 0.0;\n}\nexport function setBusEnabled(bus, enabled) {\n    var obj = _getBus(bus);\n    if (obj) {\n        Bus_enable(obj, enabled);\n    }\n}\nexport function getBusEnabled(bus) {\n    var obj = _getBus(bus);\n    return !!obj && obj.e;\n}\n/** length / position **/\nexport function getAudioDataState(data) {\n    if (data !== 0) {\n        var obj = audioDataPool[data];\n        if (obj) {\n            return obj.cf;\n        }\n    }\n    return 0 /* Invalid */;\n}\nexport function getAudioSourceLength(data) {\n    var d = 0.0;\n    if (data !== 0) {\n        var obj = audioDataPool[data];\n        if (obj && obj.data) {\n            if (obj.cf & 4 /* Stream */) {\n                // TODO: :(\n            }\n            else {\n                d = obj.data.duration;\n            }\n        }\n    }\n    return d;\n}\nexport function getVoiceLength(voice) {\n    var obj = _getVoiceObj(voice);\n    var d = 0.0;\n    if (obj) {\n        if (obj.buffer && obj.buffer.buffer) {\n            d = obj.buffer.buffer.duration;\n        }\n        else if (obj.stream) {\n            d = obj.stream.el.duration;\n        }\n    }\n    return d;\n}\nexport function getVoicePosition(voice) {\n    var obj = _getVoiceObj(voice);\n    var d = 0.0;\n    if (obj) {\n        if (obj.buffer && obj.buffer) {\n            // TODO: :(\n        }\n        else if (obj.stream) {\n            d = obj.stream.el.currentTime;\n        }\n    }\n    return d;\n}\n//# sourceMappingURL=index.js.map","/** Export Constants only for pre-bundled usage **/\nexport var VOICES_IN_USE = 0 /* VoicesInUse */;\nexport var STREAMS_IN_USE = 1 /* StreamsInUse */;\nexport var BUFFERS_LOADED = 2 /* BuffersLoaded */;\nexport var STREAMS_LOADED = 3 /* StreamsLoaded */;\nexport var DEVICE_SAMPLE_RATE = 4 /* Device_SampleRate */;\nexport var DEVICE_STATE = 5 /* Device_State */;\nexport var BUS_MASTER = 0;\nexport var BUS_SFX = 1;\nexport var BUS_MUSIC = 2;\nexport var BUS_SPEECH = 2;\nexport function getDeviceStateString(state) {\n    var _a;\n    return (_a = [\"invalid\", \"running\", \"paused\"][state]) !== null && _a !== void 0 ? _a : \"undefined\";\n}\nexport function getAudioDataStateString(state) {\n    var _a;\n    return (_a = [\"invalid\", \"loading\", \"-\", \"loaded\"][state & 0x3]) !== null && _a !== void 0 ? _a : \"undefined\";\n}\nexport * from \"./index\";\n//# sourceMappingURL=sa.js.map"],"names":["TAG","log","message","console","warn","error","reason","measure","ts","performance","now","ctx","unlockEvents","unlocked","getContext","state","getContextState","resumeAudioContext","resume","then","catch","addEventListener","document","i","length","unlock","setupUnlockHandler","removeEventListener","initContext","AudioContext","latencyHint","sampleRate","suspend","suspendAudioContext","baseLatency","closeContext","_notNullCtx","close","emptyWaveData","StreamPlayer","el","node","this","StreamPlayer_isFree","player","src","StreamPlayer_stop","pause","currentTime","disconnect","StreamPlayer_resume","play","players","getNextStreamPlayer","mes","url","Audio","preload","createMediaElementSource","StreamPlayer_create","push","vMask","VoiceObj","gain","pan","stream","buffer","rate","cf","target","data","v","Voice_stop","stop","Voice_resetDestination","Voice_startBuffer","source","e","loop","start","Voice_pitch","value","playbackRate","voicePool","_getVoiceObj","handle","obj","getNextVoice","index","createGain","createStereoPanner","connect","Voice_create","AudioDataObj","audioDataPool","BusObj","busPool","Bus_create","_getBus","_getBusGain","undefined","stopAudioData","_a","d","duration","bus","param","count","getStreamPlayersCount","voice","master","destination","initBusPool","filepath","streaming","next","getNextAudioData","fetch","Request","response","blob","URL","createObjectURL","timeDecoding_1","arrayBuffer","decodeAudioData","volume","pitch","paused","dataObj","targetNode","voiceObj","audioBuffer","createBufferSource","Voice_prepareBuffer","Voice_changeDestination","enabled","dest","Bus_enable","Voice_loop","Voice_pause","termBusPool","destroyStreamPlayersPool","sourceObj","revokeObjectURL"],"mappings":"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"}