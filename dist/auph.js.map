{"version":3,"file":"auph.js","sources":["../module/protocol/interface.js","../module/null/index.js","../module/webaudio/debug.js","../module/webaudio/Mixer.js","../module/webaudio/StreamPlayer.js","../module/webaudio/common.js","../module/webaudio/Voice.js","../module/webaudio/Bus.js","../module/webaudio/Buffer.js","../module/webaudio/index.js","../module/index.js","../module/protocol/static.js"],"sourcesContent":["/**\n * Object Name Identifier Layout: [00tt 0000 | vvvv vvvv | vvvv vvvv | iiii iiii]\n */\nexport var tMask = 0x30000000;\nexport var vMask = 0x00FFFF00;\nexport var vIncr = 0x00000100;\nexport var iMask = 0x000000FF;\nexport var Mixer = 0x00000001;\n// used for integer to float params conversion\nexport var Unit = 1024;\nexport var DefaultBus = 1 /* Sound */ | 268435456 /* Bus */;\n//# sourceMappingURL=interface.js.map","export function init() {\n}\nexport function shutdown() {\n}\nexport function load(filepath, flags) {\n    return 0;\n}\nexport function unload(name) {\n}\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    return 0;\n}\nexport function stop(name) {\n}\nexport function set(name, param, value) {\n}\nexport function get(name, param) {\n    return 0;\n}\n//# sourceMappingURL=index.js.map","var TAG = \"[AUPH]\";\nexport function log(message) {\n    if (process.env.NODE_ENV !== \"production\") {\n        console.log(TAG, message);\n    }\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function measure(ts) {\n    if (process.env.NODE_ENV !== \"production\") {\n        return performance.now() - ts;\n    }\n    else {\n        return 0;\n    }\n}\n//# sourceMappingURL=debug.js.map","import { error, log, warn } from \"./debug\";\nvar ctx = null;\nvar unlockEvents = [\"mousedown\", \"pointerdown\", \"touchstart\"];\nvar unlocked = false;\nexport function getContext() {\n    if (!ctx) {\n        warn(\"not initialized\");\n        return null;\n    }\n    if (ctx.state === \"closed\") {\n        error(\"invalid state:\", \"Context is closed\");\n        return null;\n    }\n    return ctx;\n}\nexport function getAudioContextObject() {\n    return ctx;\n}\nexport function getContextState(ctx) {\n    var state = 0;\n    if (ctx.state !== \"closed\") {\n        state |= 1 /* Active */;\n        if (ctx.state === \"running\") {\n            state |= 2 /* Running */;\n        }\n    }\n    return state;\n}\nexport function audioContextResume(ctx) {\n    log(\"resuming...\");\n    ctx.resume().then(function () {\n        log(\"resumed\");\n    }).catch(function (reason) {\n        if (!unlocked) {\n            log(\"cannot resume until user interaction, setup unlock handler...\");\n            setupUnlockHandler();\n        }\n        else {\n            error(\"error resuming AudioContext\", reason);\n        }\n    });\n}\nexport function audioContextPause(ctx) {\n    log(\"AudioContext suspending...\");\n    ctx.suspend().then(function () {\n        log(\"AudioContext suspended\");\n    }).catch(function (reason) {\n        error(\"error suspending AudioContext\", reason);\n    });\n}\nfunction unlock() {\n    unlocked = true;\n    var removeEventListener = document.removeEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        removeEventListener(unlockEvents[i], unlock);\n    }\n    if (ctx && ctx.state === \"suspended\") {\n        audioContextResume(ctx);\n    }\n}\nfunction setupUnlockHandler() {\n    var addEventListener = document.addEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        addEventListener(unlockEvents[i], unlock);\n    }\n}\nexport function initContext() {\n    if (ctx) {\n        warn(\"already initialized\");\n        return ctx;\n    }\n    ctx = new AudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: 22050\n    });\n    if (!ctx) {\n        error(\"error create AudioContext\");\n        return null;\n    }\n    if (ctx.state === \"running\") {\n        audioContextPause(ctx);\n    }\n    log(\"Latency: \" + ctx.baseLatency);\n    log(\"Sample rate: \" + ctx.sampleRate);\n    return ctx;\n}\nexport function closeContext(_notNullCtx) {\n    log(\"shutdown...\");\n    _notNullCtx.close().then(function () {\n        log(\"shutdown completed\");\n    }).catch(function (reason) {\n        error(\"shutdown error\", reason);\n    });\n    ctx = null;\n}\nexport function _setAudioParam(param, value) {\n    if (param.value !== value) {\n        param.value = value;\n    }\n}\n//# sourceMappingURL=Mixer.js.map","import { getContext } from \"./Mixer\";\nimport { error, log } from \"./debug\";\nvar emptyWaveData = \"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=\";\nvar StreamPlayer = /** @class */ (function () {\n    function StreamPlayer(el, node) {\n        this.el = el;\n        this.node = node;\n    }\n    return StreamPlayer;\n}());\nexport { StreamPlayer };\nexport function StreamPlayer_create(ctx, url) {\n    var el = new Audio(url);\n    el.preload = \"metadata\";\n    el[\"preservesPitch\"] = false;\n    return new StreamPlayer(el, ctx.createMediaElementSource(el));\n}\nexport function StreamPlayer_isFree(player) {\n    return player.el.src === emptyWaveData;\n}\nexport function StreamPlayer_stop(player) {\n    var el = player.el;\n    if (el.src !== emptyWaveData) {\n        el.pause();\n        el.src = emptyWaveData;\n        el.currentTime = 0;\n        player.node.disconnect();\n    }\n}\nexport function _streamPlayerResume(player) {\n    player.el.play().then(function () {\n        log(\"started stream player\");\n    }).catch(function (reason) {\n        error(\"error on play stream\", reason);\n    });\n}\nvar players = [];\nvar playersMaxCount = 4;\nexport function getNextStreamPlayer(src) {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        if (StreamPlayer_isFree(player)) {\n            player.el.src = src;\n            return player;\n        }\n    }\n    if (players.length < playersMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var mes = StreamPlayer_create(ctx, src);\n            players.push(mes);\n            return mes;\n        }\n    }\n    return null;\n}\nexport function destroyStreamPlayersPool() {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        StreamPlayer_stop(player);\n        player.el.src = \"\";\n    }\n    players.length = 0;\n}\nexport function getStreamPlayersCount() {\n    var count = 0;\n    for (var i = 0; i < players.length; ++i) {\n        if (!StreamPlayer_isFree(players[i])) {\n            ++count;\n        }\n    }\n    return count;\n}\n//# sourceMappingURL=StreamPlayer.js.map","import { iMask, tMask, vIncr, vMask } from \"../protocol/interface\";\nexport function nextHandle(h) {\n    return ((h + vIncr) & vMask) | (h & (tMask | iMask));\n}\n//# sourceMappingURL=common.js.map","import { _streamPlayerResume, StreamPlayer_stop } from \"./StreamPlayer\";\nimport { getContext } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nimport { nextHandle } from \"./common\";\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan, index) {\n        var _this = this;\n        this.gain = gain;\n        this.pan = pan;\n        // handle passport\n        this.h = 0;\n        // Control Flags\n        this.s = 0;\n        this._gain = Unit;\n        this._pan = Unit;\n        this._rate = Unit;\n        this.data = 0;\n        this.bus = 0;\n        this.stream = null;\n        // buffer playback\n        this._started = false;\n        this.buffer = null;\n        // common nodes\n        this.target = null;\n        this._e = function (e) {\n            // maybe check is useless\n            if (_this.buffer === e.target) {\n                _voiceStop(_this);\n            }\n        };\n        this.h = 805306368 /* Voice */ | index;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function _voiceNew(ctx, index) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan, index);\n}\nexport function _voiceChangeDestination(v, target) {\n    if (target !== v.target) {\n        var gain = v.gain;\n        if (v.target) {\n            gain.disconnect(v.target);\n        }\n        v.target = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function _voiceResetDestination(v) {\n    if (v.target) {\n        v.gain.disconnect(v.target);\n        v.target = null;\n    }\n}\nexport function _voiceStop(v) {\n    // stop stream\n    if (v.stream) {\n        StreamPlayer_stop(v.stream);\n        v.stream = null;\n    }\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.s & 2 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.disconnect();\n        v.buffer = null;\n    }\n    _voiceResetDestination(v);\n    v.data = 0;\n    v.bus = 0;\n    v.s = 0;\n    v.h = nextHandle(v.h);\n}\nexport function _voiceStartBuffer(v) {\n    var source = v.buffer;\n    if (source && !v._started) {\n        //source.addEventListener(\"ended\", v._e, {once: true});\n        source.onended = v._e;\n        source.loop = (v.s & 4 /* Loop */) !== 0;\n        source.start();\n        v._started = true;\n    }\n}\nexport function _voicePrepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n    v._started = false;\n}\nexport function _voiceSetLoop(v, value) {\n    var current = (v.s & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.s ^= 4 /* Loop */;\n        if (v.stream) {\n            v.stream.el.loop = value;\n        }\n        else if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function _voiceSetRunning(v, value) {\n    var current = !!(v.s & 2 /* Running */);\n    if (value !== current) {\n        v.s ^= 2 /* Running */;\n        if (v.stream) {\n            if (value) {\n                _streamPlayerResume(v.stream);\n            }\n            else {\n                v.stream.el.pause();\n            }\n        }\n        else if (v.buffer) {\n            v.buffer.playbackRate.value = value ? (v._rate / Unit) : 0.0;\n            if (value) {\n                // restart if play called in pause mode\n                _voiceStartBuffer(v);\n            }\n        }\n    }\n}\nexport function _voiceSetPitch(v, value) {\n    if (v._rate !== value) {\n        v._rate = value;\n        if (v.stream) {\n            v.stream.el.playbackRate = value / Unit;\n        }\n        else if (v.buffer) {\n            if ((v.s & 2 /* Running */) !== 0) {\n                v.buffer.playbackRate.value = value / Unit;\n            }\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.h === handle) ? obj : null;\n}\nexport function createVoiceObj() {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.s === 0) {\n            return v.h;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var v = _voiceNew(ctx, index);\n            v.h = 805306368 /* Voice */ | index;\n            voicePool.push(v);\n            return v.h;\n        }\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","import { getAudioContextObject } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain) {\n        this.gain = gain;\n        this.h = 0;\n        this.s = 1 /* Active */ | 2 /* Running */;\n        this._gain = Unit;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nexport var busLine = [];\nexport function createBusObj(ctx) {\n    var next = busLine.length;\n    var obj = new BusObj(ctx.createGain());\n    obj.h = next | 268435456 /* Bus */;\n    busLine.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = createBusObj(ctx).gain;\n    master.connect(ctx.destination);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busLine.length; ++i) {\n        busLine[i].gain.disconnect();\n    }\n    busLine.length = 0;\n}\nexport function _getBus(bus) {\n    var obj = busLine[bus & iMask];\n    return (obj && obj.h === bus) ? obj : null;\n}\nexport function _getBusGain(handle) {\n    var obj = _getBus(handle);\n    return obj ? obj.gain : undefined;\n}\nexport function _setBusConnected(bus, connected) {\n    var flag = !!(bus.s & 2 /* Running */);\n    if (flag !== connected) {\n        var master = busLine[0];\n        var dest = bus === master ? getAudioContextObject().destination : master.gain;\n        if (connected) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.s ^= 2 /* Running */;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { iMask } from \"../protocol/interface\";\nimport { error, log, measure } from \"./debug\";\nimport { getContext } from \"./Mixer\";\nimport { nextHandle } from \"./common\";\nvar BufferObj = /** @class */ (function () {\n    function BufferObj(index) {\n        // State Flags\n        this.s = 0;\n        this.data = null;\n        this.h = index | 536870912 /* Buffer */;\n    }\n    return BufferObj;\n}());\nexport { BufferObj };\nexport var buffers = [null];\nvar buffersMaxCount = 128;\nexport function getNextBufferObj() {\n    for (var i = 1; i < buffers.length; ++i) {\n        var buffer = buffers[i];\n        if (buffer.s === 0) {\n            return buffer.h;\n        }\n    }\n    var next = buffers.length;\n    if (next < buffersMaxCount) {\n        var b = new BufferObj(next);\n        buffers.push(b);\n        return b.h;\n    }\n    return 0;\n}\nexport function _bufferDestroy(obj) {\n    if ((obj.s & 4 /* Stream */) !== 0 && obj.data) {\n        URL.revokeObjectURL(obj.data);\n    }\n    obj.s = 0;\n    obj.h = nextHandle(obj.h);\n    obj.data = null;\n}\nexport function _getBufferObj(buffer) {\n    var obj = buffers[buffer & iMask];\n    if (obj && obj.h === buffer) {\n        return obj;\n    }\n    return null;\n}\nfunction _fetchURL(filepath, cb) {\n    return fetch(new Request(filepath)).then(cb);\n}\nexport function _bufferLoad(obj, filepath, flags) {\n    obj.s |= 1 /* Active */;\n    if (flags & 4 /* Stream */) {\n        obj.s |= 4 /* Stream */;\n        _fetchURL(filepath, function (response) { return response.blob(); }).then(function (blob) {\n            obj.data = URL.createObjectURL(blob);\n            obj.s |= 2 /* Loaded */;\n        }).catch(function (reason) {\n            error(\"can't load audio stream data \" + filepath, reason);\n        });\n    }\n    else {\n        var timeDecoding_1 = 0;\n        _fetchURL(filepath, function (response) { return response.arrayBuffer(); }).then(function (buffer) {\n            var ctx = getContext();\n            if (ctx) {\n                timeDecoding_1 = measure(0);\n                return ctx.decodeAudioData(buffer);\n            }\n            return null;\n        }).then(function (buffer) {\n            obj.data = buffer;\n            if (buffer) {\n                log(\"decoding time: \" + (measure(timeDecoding_1) | 0) + \" ms.\");\n                obj.s |= 2 /* Loaded */;\n            }\n        }).catch(function (reason) {\n            error(\"can't load audio buffer from \" + filepath, reason);\n        });\n    }\n}\n//# sourceMappingURL=Buffer.js.map","import { _streamPlayerResume, destroyStreamPlayersPool, getNextStreamPlayer } from \"./StreamPlayer\";\nimport { _setAudioParam, audioContextPause, audioContextResume, closeContext, getAudioContextObject, getContext, getContextState, initContext } from \"./Mixer\";\nimport { _getVoiceObj, _voiceChangeDestination, _voicePrepareBuffer, _voiceSetLoop, _voiceSetPitch, _voiceSetRunning, _voiceStartBuffer, _voiceStop, createVoiceObj, voicePool } from \"./Voice\";\nimport { _getBus, _getBusGain, _setBusConnected, busLine, initBusPool, termBusPool } from \"./Bus\";\nimport { error, log, warn } from \"./debug\";\nimport { DefaultBus, iMask, Mixer, tMask, Unit } from \"../protocol/interface\";\nimport { _bufferDestroy, _bufferLoad, _getBufferObj, buffers, getNextBufferObj } from \"./Buffer\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        buffers.length = 1;\n        destroyStreamPlayersPool();\n        closeContext(ctx);\n    }\n}\nexport function load(filepath, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var obj = buffers[handle & iMask];\n        _bufferLoad(obj, filepath, flags);\n    }\n    return handle;\n}\nexport function unload(name) {\n    var obj = _getBufferObj(name);\n    if (obj) {\n        stop(name);\n        _bufferDestroy(obj);\n    }\n}\n/***\n *\n * @param buffer\n * @param gain\n * @param pan\n * @param rate\n * @param flags\n * @param bus\n */\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    // arguments check debug\n    if (flags & ~(2 /* Running */ | 4 /* Loop */)) {\n        error(\"Bad flags\");\n    }\n    ///\n    var ctx = getContext();\n    if (!ctx) {\n        return 0;\n    }\n    var bufferObj = _getBufferObj(buffer);\n    if (!bufferObj) {\n        warn(\"audio source not found\");\n        return 0;\n    }\n    if (!(bufferObj.s & 2 /* Loaded */)) {\n        warn(\"audio source is not loaded yet\");\n        return 0;\n    }\n    if (!bufferObj.data) {\n        warn(\"nothing to play, no audio data\");\n        return 0;\n    }\n    var targetNode = _getBusGain(bus ? bus : DefaultBus);\n    if (!targetNode) {\n        warn(\"invalid target bus!\");\n        return 0;\n    }\n    var voice = createVoiceObj();\n    if (voice === 0) {\n        log(\"no more free voices!\");\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    voiceObj.s = 1 /* Active */ | flags;\n    voiceObj.data = buffer;\n    voiceObj._rate = rate;\n    voiceObj._gain = gain;\n    voiceObj._pan = pan;\n    voiceObj.gain.gain.value = gain / Unit;\n    voiceObj.pan.pan.value = pan / Unit - 1;\n    if (bufferObj.s & 4 /* Stream */) {\n        var mes = getNextStreamPlayer(bufferObj.data);\n        if (!mes) {\n            log(\"no more free media stream elements!\");\n            return 0;\n        }\n        voiceObj.stream = mes;\n        mes.el.loop = !!(flags & 4 /* Loop */);\n        mes.node.connect(voiceObj.pan);\n        if (flags & 2 /* Running */) {\n            _streamPlayerResume(mes);\n        }\n    }\n    else {\n        _voicePrepareBuffer(voiceObj, ctx, bufferObj.data);\n        if (flags & 2 /* Running */) {\n            _voiceStartBuffer(voiceObj);\n        }\n    }\n    // maybe we need to set target before `startBuffer()`\n    _voiceChangeDestination(voiceObj, targetNode);\n    _voiceSetPitch(voiceObj, rate);\n    return voice;\n}\nexport function stop(name) {\n    if (name === 0) {\n        return;\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            _voiceStop(obj);\n        }\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            for (var i = 1; i < voicePool.length; ++i) {\n                var v = voicePool[i];\n                if (v.data === name) {\n                    _voiceStop(v);\n                }\n            }\n        }\n        else {\n            warn(\"invalid buffer reference\");\n        }\n    }\n}\nexport function set(name, param, value) {\n    if (name === 0) {\n        return;\n    }\n    if (name === Mixer && (param & 128 /* Flags */) && (param & 2 /* Running */)) {\n        var ctx = getContext();\n        if (ctx) {\n            if (value && ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n            }\n            else if (!value && ctx.state === \"running\") {\n                audioContextPause(ctx);\n            }\n        }\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                var enabled = value !== 0;\n                if (param & 2 /* Running */) {\n                    _voiceSetRunning(obj, enabled);\n                }\n                else if (param & 4 /* Loop */) {\n                    _voiceSetLoop(obj, enabled);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            obj._gain = value;\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    case 2 /* Pan */:\n                        if (obj._pan !== value) {\n                            obj._pan = value;\n                            _setAudioParam(obj.pan.pan, value / Unit - 1);\n                        }\n                        break;\n                    case 3 /* Rate */:\n                        _voiceSetPitch(obj, value);\n                        break;\n                    case 4 /* CurrentTime */:\n                        // TODO:\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                if (param & 2 /* Running */) {\n                    _setBusConnected(obj, !!value);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n}\nexport function get(name, param) {\n    if (name === Mixer) {\n        var ctx = getAudioContextObject();\n        if (ctx) {\n            if (param === 0 /* State */) {\n                return getContextState(ctx);\n            }\n            else if (param === 5 /* SampleRate */) {\n                return ctx.sampleRate | 0;\n            }\n        }\n        return 0;\n    }\n    var type = name & tMask;\n    if ((param & 256 /* Count */) && !(name & iMask)) {\n        var stateMask = param & 127 /* StateMask */;\n        if (type === 805306368 /* Voice */) {\n            return _countObjectsWithFlags(voicePool, stateMask);\n        }\n        else if (type === 268435456 /* Bus */) {\n            return _countObjectsWithFlags(busLine, stateMask);\n        }\n        else if (type === 536870912 /* Buffer */) {\n            return _countObjectsWithFlags(buffers, stateMask);\n        }\n        return 0;\n    }\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                case 2 /* Pan */:\n                    return obj._pan;\n                case 3 /* Rate */:\n                    return obj._rate;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        d = obj.buffer.buffer.duration * Unit;\n                    }\n                    else if (obj.stream) {\n                        d = obj.stream.el.duration * Unit;\n                    }\n                    return (d * Unit) | 0;\n                }\n                case 4 /* CurrentTime */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        // TODO: :(\n                    }\n                    else if (obj.stream) {\n                        d = obj.stream.el.currentTime;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(\"not supported\");\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                default:\n                    warn(\"not supported\");\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.s & 4 /* Stream */) {\n                        // TODO: :(\n                        warn(\"not supported\");\n                    }\n                    else if (obj.data) {\n                        d = obj.data.duration;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(\"param not supported\");\n                    break;\n            }\n        }\n        return 0;\n    }\n    return 0;\n}\n/** private helpers **/\nfunction _countObjectsWithFlags(arr, mask) {\n    var cnt = 0;\n    for (var i = 1; i < arr.length; ++i) {\n        var obj = arr[i];\n        if (obj && (obj.s & mask) === mask) {\n            ++cnt;\n        }\n    }\n    return cnt;\n}\n//# sourceMappingURL=index.js.map","import { Mixer, Unit } from \"./protocol/interface\";\nimport * as Null from \"./null/index\";\nimport * as Browser from \"./webaudio/index\";\nfunction loadDriver() {\n    if (typeof process !== \"undefined\") {\n        return require(\"auph/nodejs/index.js\");\n    }\n    else if (typeof auwa !== \"undefined\") {\n        return auwa;\n    }\n    else if (typeof AudioContext !== \"undefined\") {\n        //  || typeof webkitAudioContext !== \"undefined\"\n        window.auwa = Browser;\n        return Browser;\n    }\n    return Null;\n}\nvar _ = loadDriver();\nexport * from \"./protocol/static\";\nexport var init = _.init;\nexport var shutdown = _.shutdown;\nexport var set = _.set;\nexport var get = _.get;\nexport var load = _.load;\nexport var unload = _.unload;\nexport var stop = _.stop;\nexport function pause(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, true);\n}\nexport function resume(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, false);\n}\nexport function play(buffer, gain, pan, rate, loop, paused, bus) {\n    if (gain === void 0) { gain = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (rate === void 0) { rate = 1.0; }\n    var flags = 0;\n    if (!!loop)\n        flags |= 4 /* Loop */;\n    if (!paused)\n        flags |= 2 /* Running */;\n    return _.voice(buffer, f2u(gain), f2u(+pan + 1), f2u(rate), flags, 0 | bus);\n}\nexport function getMixerStateString(state) {\n    return [\"closed\", \"paused\", \"\", \"running\"][state & 3];\n}\nexport function getBufferStateString(state) {\n    return [\"free\", \"loading\", \"\", \"loaded\"][state & 0x3] + [\"\", \" streaming\"][(state >>> 2) & 0x1];\n}\nexport function setGain(busOrVoice, value) {\n    set(busOrVoice, 1 /* Gain */, f2u(value));\n}\nexport function getGain(busOrVoice) {\n    return get(busOrVoice, 1 /* Gain */) / Unit;\n}\nexport function setPan(voice, pan) {\n    set(voice, 2 /* Pan */, f2u(+pan + 1));\n}\nexport function setRate(voice, rate) {\n    set(voice, 3 /* Rate */, f2u(rate));\n}\nexport function setPause(name, value) {\n    set(name, 128 /* Flags */ | 2 /* Running */, 0 | !value);\n}\nexport function setLoop(voice, value) {\n    set(voice, 128 /* Flags */ | 4 /* Loop */, 0 | value);\n}\nexport function getPan(voice) {\n    return get(voice, 2 /* Pan */) / Unit - 1;\n}\nexport function getRate(voice) {\n    return get(voice, 3 /* Rate */) / Unit;\n}\nexport function getPause(voice) {\n    return !(get(voice, 0 /* State */) & 2 /* Running */);\n}\nexport function getLoop(voice) {\n    return !!(get(voice, 0 /* State */) & 4 /* Loop */);\n}\nexport function getCurrentTime(voice) {\n    return get(voice, 4 /* CurrentTime */) / Unit;\n}\nexport function isActive(name) {\n    return !!(get(name, 0 /* State */) & 1 /* Active */);\n}\nexport function getDuration(name) {\n    return get(name, 6 /* Duration */) / Unit;\n}\nfunction f2u(x) {\n    return (x * Unit) | 0;\n}\n//# sourceMappingURL=index.js.map","import { Mixer } from \"./interface\";\n/** Export Constants only for pre-bundled usage **/\nexport var SAMPLE_RATE = 5 /* SampleRate */;\nexport var STATE = 0 /* State */;\nexport var COUNT = 256 /* Count */;\nexport var ACTIVE = 1 /* Active */;\nexport var RUNNING = 2 /* Running */;\nexport var STREAM = 4 /* Stream */;\nexport var LOOP = 4 /* Loop */;\nexport var MIXER = Mixer;\nexport var BUS = 268435456 /* Bus */;\nexport var VOICE = 805306368 /* Voice */;\nexport var BUFFER = 536870912 /* Buffer */;\nexport var BUS_MASTER = 268435456 /* Bus */ | 0;\nexport var BUS_SFX = 268435456 /* Bus */ | 1;\nexport var BUS_MUSIC = 268435456 /* Bus */ | 2;\nexport var BUS_SPEECH = 268435456 /* Bus */ | 3;\n//# sourceMappingURL=static.js.map"],"names":["tMask","iMask","Unit","filepath","flags","name","buffer","gain","pan","rate","bus","param","value","TAG","warn","message","console","error","reason","ctx","unlockEvents","unlocked","getContext","state","getAudioContextObject","audioContextResume","resume","then","catch","addEventListener","document","i","length","unlock","setupUnlockHandler","audioContextPause","suspend","removeEventListener","initContext","AudioContext","latencyHint","sampleRate","baseLatency","closeContext","_notNullCtx","close","_setAudioParam","emptyWaveData","StreamPlayer","el","node","this","StreamPlayer_isFree","player","src","StreamPlayer_stop","pause","currentTime","disconnect","_streamPlayerResume","play","players","getNextStreamPlayer","mes","url","Audio","preload","createMediaElementSource","StreamPlayer_create","push","nextHandle","h","VoiceObj","index","_this","s","_gain","_pan","_rate","data","stream","_started","target","_e","e","_voiceStop","v","stop","_voiceResetDestination","_voiceStartBuffer","source","onended","loop","start","_voiceSetPitch","playbackRate","voicePool","_getVoiceObj","handle","obj","createVoiceObj","createGain","createStereoPanner","connect","_voiceNew","BusObj","busLine","createBusObj","next","_getBus","BufferObj","buffers","_getBufferObj","_fetchURL","cb","fetch","Request","type","_countObjectsWithFlags","arr","mask","cnt","master","destination","initBusPool","termBusPool","destroyStreamPlayersPool","b","getNextBufferObj","response","blob","URL","createObjectURL","arrayBuffer","decodeAudioData","_bufferLoad","revokeObjectURL","_bufferDestroy","bufferObj","targetNode","undefined","voice","voiceObj","audioBuffer","createBufferSource","_voicePrepareBuffer","_voiceChangeDestination","enabled","_voiceSetRunning","_voiceSetLoop","connected","dest","_setBusConnected","getContextState","stateMask","d","duration","_","process","require","auwa","window","Browser","Null","init","shutdown","set","get","load","unload","setPause","f2u","x","busOrVoice","paused"],"mappings":"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"}