{"version":3,"file":"auph.js","sources":["../module/protocol/interface.js","../module/null/index.js","../module/webaudio/debug.js","../module/webaudio/StreamPlayer.js","../module/webaudio/Mixer.js","../module/webaudio/common.js","../module/webaudio/Voice.js","../module/webaudio/Bus.js","../module/webaudio/Buffer.js","../module/webaudio/index.js","../module/index.js","../module/protocol/static.js"],"sourcesContent":["/**\n * Object Name Identifier Layout: [00tt 0000 | vvvv vvvv | vvvv vvvv | iiii iiii]\n */\nexport var tMask = 0x30000000;\nexport var vMask = 0x00FFFF00;\nexport var vIncr = 0x00000100;\nexport var iMask = 0x000000FF;\nexport var Mixer = 0x00000001;\n// used for integer to float params conversion\nexport var Unit = 1024;\nexport var DefaultBus = 1 /* Sound */ | 268435456 /* Bus */;\n//# sourceMappingURL=interface.js.map","export function init() {\n}\nexport function shutdown() {\n}\nexport function load(filepath, flags) {\n    return 0;\n}\nexport function loadMemory(data, flags) {\n    return 0;\n}\nexport function unload(name) {\n}\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    return 0;\n}\nexport function stop(name) {\n}\nexport function set(name, param, value) {\n}\nexport function get(name, param) {\n    return 0;\n}\n//# sourceMappingURL=index.js.map","var TAG = \"[AUPH]\";\nvar lastStatus = 0;\nexport function log(message) {\n    if (process.env.NODE_ENV !== \"production\") {\n        console.log(TAG, message);\n    }\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function setError(status, context) {\n    if (process.env.NODE_ENV !== \"production\") {\n        error(status, context);\n    }\n    lastStatus = status;\n}\nexport function measure(ts) {\n    if (process.env.NODE_ENV !== \"production\") {\n        return performance.now() - ts;\n    }\n    else {\n        return 0;\n    }\n}\n//# sourceMappingURL=debug.js.map","import { error, log } from \"./debug\";\nvar emptyWaveData = \"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=\";\nvar StreamPlayer = /** @class */ (function () {\n    function StreamPlayer(el, node) {\n        this.el = el;\n        this.node = node;\n    }\n    return StreamPlayer;\n}());\nexport { StreamPlayer };\nexport function StreamPlayer_create(ctx, url) {\n    var el = new Audio(url);\n    el.preload = \"metadata\";\n    el[\"preservesPitch\"] = false;\n    return new StreamPlayer(el, ctx.createMediaElementSource(el));\n}\nexport function StreamPlayer_isFree(player) {\n    return player.el.src === emptyWaveData;\n}\nexport function StreamPlayer_stop(player) {\n    var el = player.el;\n    if (el.src !== emptyWaveData) {\n        el.onended = null;\n        el.pause();\n        el.src = emptyWaveData;\n        el.currentTime = 0;\n        player.node.disconnect();\n    }\n}\nexport function _streamPlayerResume(player) {\n    player.el.play().then(function () {\n        log(\"started stream player\");\n    }).catch(function (reason) {\n        error(\"error on play stream\", reason);\n    });\n}\nvar players = [];\nvar playersMaxCount = 4;\nexport function getNextStreamPlayer(ctx, src) {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        if (StreamPlayer_isFree(player)) {\n            player.el.src = src;\n            return player;\n        }\n    }\n    if (players.length < playersMaxCount) {\n        var mes = StreamPlayer_create(ctx, src);\n        players.push(mes);\n        return mes;\n    }\n    return null;\n}\nexport function destroyStreamPlayersPool() {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        StreamPlayer_stop(player);\n        player.el.src = \"\";\n    }\n    players.length = 0;\n}\nexport function getStreamPlayersCount() {\n    var count = 0;\n    for (var i = 0; i < players.length; ++i) {\n        if (!StreamPlayer_isFree(players[i])) {\n            ++count;\n        }\n    }\n    return count;\n}\n//# sourceMappingURL=StreamPlayer.js.map","import { error, log, warn } from \"./debug\";\nvar ctx = null;\n// \"touchstart\", \"touchend\", \"mousedown\", \"pointerdown\"\nvar unlockEvents = [\"click\", \"keydown\"];\nvar unlocked = false;\nexport function getContext() {\n    if (!ctx || ctx.state === \"closed\") {\n        warn(2 /* InvalidState */);\n        return null;\n    }\n    return ctx;\n}\nexport function getAudioContextObject() {\n    return ctx;\n}\nexport function getContextState(ctx) {\n    var state = 0;\n    if (ctx.state !== \"closed\") {\n        state |= 1 /* Active */;\n        if (ctx.state === \"running\") {\n            state |= 2 /* Running */;\n        }\n    }\n    return state;\n}\nexport function audioContextResume(ctx) {\n    log(3 /* DeviceResuming */);\n    ctx.resume().then(function () {\n        log(4 /* DeviceResumed */);\n    }).catch(function (reason) {\n        error(5 /* DeviceResumeError */, reason);\n    });\n}\nexport function audioContextPause(ctx) {\n    log(6 /* DevicePausing */);\n    ctx.suspend().then(function () {\n        log(7 /* DevicePaused */);\n    }).catch(function (reason) {\n        error(8 /* DevicePauseError */, reason);\n    });\n}\nfunction unlock() {\n    unlocked = true;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        document.removeEventListener(unlockEvents[i], unlock, true);\n    }\n    if (ctx && ctx.state === \"suspended\") {\n        audioContextResume(ctx);\n    }\n}\nfunction setupUnlockHandler() {\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        document.addEventListener(unlockEvents[i], unlock, true);\n    }\n}\nfunction newAudioContext(options) {\n    try {\n        var scope = window;\n        var audioContext = scope.AudioContext || scope.webkitAudioContext;\n        return new audioContext(options);\n    }\n    catch (_a) {\n        error(1 /* NotSupported */);\n    }\n    return null;\n}\nexport function initContext() {\n    if (ctx) {\n        warn(14 /* Warning_AlreadyInitialized */);\n        return ctx;\n    }\n    ctx = newAudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: 22050\n    });\n    if (ctx && ctx.state === \"suspended\") {\n        log(18 /* UserInteractionRequiredToStart */);\n        setupUnlockHandler();\n    }\n    return ctx;\n}\nexport function closeContext(_notNullCtx) {\n    log(9 /* DeviceClosing */);\n    _notNullCtx.close().then(function () {\n        log(10 /* DeviceClosed */);\n    }).catch(function (reason) {\n        error(11 /* DeviceCloseError */, reason);\n    });\n    ctx = null;\n}\nexport function _setAudioParam(param, value) {\n    if (param.value !== value) {\n        param.value = value;\n    }\n}\n//# sourceMappingURL=Mixer.js.map","import { iMask, tMask, vIncr, vMask } from \"../protocol/interface\";\nexport function nextHandle(h) {\n    return ((h + vIncr) & vMask) | (h & (tMask | iMask));\n}\n//# sourceMappingURL=common.js.map","import { _streamPlayerResume, StreamPlayer_stop } from \"./StreamPlayer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nimport { nextHandle } from \"./common\";\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan, index) {\n        var _this = this;\n        this.gain = gain;\n        this.pan = pan;\n        // handle passport\n        this.h = 0;\n        // Control Flags\n        this.s = 0;\n        this._gain = Unit;\n        this._pan = Unit;\n        this._rate = Unit;\n        this.data = 0;\n        this.bus = 0;\n        this.stream = null;\n        // static buffer playback\n        this._started = false;\n        this.buffer = null;\n        // common nodes\n        this.target = null;\n        this._e = function () {\n            // maybe check is useful\n            //if (this.buffer === e.target || (this.stream && this.stream.el === e.target)) {\n            _voiceStop(_this);\n            //}\n        };\n        this.h = 805306368 /* Voice */ | index;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function _voiceNew(ctx, index) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan, index);\n}\nexport function _voiceChangeDestination(v, target) {\n    if (target !== v.target) {\n        var gain = v.gain;\n        if (v.target) {\n            gain.disconnect(v.target);\n        }\n        v.target = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function _voiceResetDestination(v) {\n    if (v.target) {\n        v.gain.disconnect(v.target);\n        v.target = null;\n    }\n}\nexport function _voiceStop(v) {\n    // stop stream\n    if (v.stream) {\n        StreamPlayer_stop(v.stream);\n        v.stream = null;\n    }\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.s & 2 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.disconnect();\n        v.buffer = null;\n    }\n    _voiceResetDestination(v);\n    v.data = 0;\n    v.bus = 0;\n    v.s = 0;\n    v.h = nextHandle(v.h);\n}\nexport function _voiceStartBuffer(v) {\n    var source = v.buffer;\n    if (source && !v._started) {\n        //source.addEventListener(\"ended\", v._e, {once: true});\n        source.onended = v._e;\n        source.loop = (v.s & 4 /* Loop */) !== 0;\n        source.start();\n        v._started = true;\n    }\n}\nexport function _voicePrepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n    v._started = false;\n}\nexport function _voiceSetLoop(v, value) {\n    var current = (v.s & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.s ^= 4 /* Loop */;\n        if (v.stream) {\n            v.stream.el.loop = value;\n        }\n        else if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function _voiceSetRunning(v, value) {\n    var current = !!(v.s & 2 /* Running */);\n    if (value !== current) {\n        v.s ^= 2 /* Running */;\n        if (v.stream) {\n            if (value) {\n                _streamPlayerResume(v.stream);\n            }\n            else {\n                v.stream.el.pause();\n            }\n        }\n        else if (v.buffer) {\n            v.buffer.playbackRate.value = value ? (v._rate / Unit) : 0.0;\n            if (value) {\n                // restart if play called in pause mode\n                _voiceStartBuffer(v);\n            }\n        }\n    }\n}\nexport function _voiceSetPitch(v, value) {\n    if (v._rate !== value) {\n        v._rate = value;\n        if (v.stream) {\n            v.stream.el.playbackRate = value / Unit;\n        }\n        else if (v.buffer) {\n            if ((v.s & 2 /* Running */) !== 0) {\n                v.buffer.playbackRate.value = value / Unit;\n            }\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.h === handle) ? obj : null;\n}\nexport function createVoiceObj(ctx) {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.s === 0) {\n            return v.h;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var v = _voiceNew(ctx, index);\n        v.h = 805306368 /* Voice */ | index;\n        voicePool.push(v);\n        return v.h;\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","import { getAudioContextObject } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain) {\n        this.gain = gain;\n        this.h = 0;\n        this.s = 1 /* Active */ | 2 /* Running */;\n        this._gain = Unit;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nexport var busLine = [];\nexport function createBusObj(ctx) {\n    var next = busLine.length;\n    var obj = new BusObj(ctx.createGain());\n    obj.h = next | 268435456 /* Bus */;\n    busLine.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = createBusObj(ctx).gain;\n    master.connect(ctx.destination);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busLine.length; ++i) {\n        busLine[i].gain.disconnect();\n    }\n    busLine.length = 0;\n}\nexport function _getBus(bus) {\n    var obj = busLine[bus & iMask];\n    return (obj && obj.h === bus) ? obj : null;\n}\nexport function _getBusGain(handle) {\n    var obj = _getBus(handle);\n    return obj ? obj.gain : undefined;\n}\nexport function _setBusConnected(bus, connected) {\n    var flag = !!(bus.s & 2 /* Running */);\n    if (flag !== connected) {\n        var master = busLine[0];\n        var dest = bus === master ? getAudioContextObject().destination : master.gain;\n        if (connected) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.s ^= 2 /* Running */;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { iMask } from \"../protocol/interface\";\nimport { error, log, measure } from \"./debug\";\nimport { getContext } from \"./Mixer\";\nimport { nextHandle } from \"./common\";\nvar BufferObj = /** @class */ (function () {\n    function BufferObj(index) {\n        // State Flags\n        this.s = 0;\n        this.data = null;\n        this.h = index | 536870912 /* Buffer */;\n    }\n    return BufferObj;\n}());\nexport { BufferObj };\nexport var buffers = [null];\nvar buffersMaxCount = 128;\nexport function getNextBufferObj() {\n    for (var i = 1; i < buffers.length; ++i) {\n        var buffer = buffers[i];\n        if (buffer.s === 0) {\n            return buffer.h;\n        }\n    }\n    var next = buffers.length;\n    if (next < buffersMaxCount) {\n        var b = new BufferObj(next);\n        buffers.push(b);\n        return b.h;\n    }\n    return 0;\n}\nexport function _bufferDestroy(obj) {\n    if ((obj.s & 4 /* Stream */) !== 0 && obj.data) {\n        URL.revokeObjectURL(obj.data);\n    }\n    obj.s = 0;\n    obj.h = nextHandle(obj.h);\n    obj.data = null;\n}\nexport function _getBufferObj(buffer) {\n    var obj = buffers[buffer & iMask];\n    if (obj && obj.h === buffer) {\n        return obj;\n    }\n    return null;\n}\nfunction _fetchURL(filepath, cb) {\n    return fetch(new Request(filepath)).then(cb);\n}\nexport function _bufferMemory(obj, data, flags) {\n    obj.s |= 1 /* Active */;\n    var buffer = data.buffer.slice(data.byteOffset, data.byteOffset + data.byteLength);\n    if (flags & 4 /* Stream */) {\n        obj.s |= 4 /* Stream */;\n        obj.data = URL.createObjectURL(new Blob([buffer]));\n        obj.s |= 2 /* Loaded */;\n    }\n    else {\n        var ctx = getContext();\n        if (ctx) {\n            ctx.decodeAudioData(buffer).then(function (audioBuffer) {\n                obj.data = audioBuffer;\n                obj.s |= 2 /* Loaded */;\n            }).catch(function (reason) {\n                error(\"Error decode audio buffer\", reason);\n            });\n        }\n    }\n}\nexport function _bufferLoad(obj, filepath, flags) {\n    obj.s |= 1 /* Active */;\n    if (flags & 4 /* Stream */) {\n        obj.s |= 4 /* Stream */;\n        _fetchURL(filepath, function (response) { return response.blob(); }).then(function (blob) {\n            obj.data = URL.createObjectURL(blob);\n            obj.s |= 2 /* Loaded */;\n        }).catch(function (reason) {\n            error(\"can't load audio stream data \" + filepath, reason);\n        });\n    }\n    else {\n        var timeDecoding_1 = 0;\n        _fetchURL(filepath, function (response) { return response.arrayBuffer(); }).then(function (buffer) {\n            var ctx = getContext();\n            if (ctx) {\n                timeDecoding_1 = measure(0);\n                return ctx.decodeAudioData(buffer);\n            }\n            return null;\n        }).then(function (buffer) {\n            obj.data = buffer;\n            if (buffer) {\n                log(\"decoding time: \" + (measure(timeDecoding_1) | 0) + \" ms.\");\n                obj.s |= 2 /* Loaded */;\n            }\n        }).catch(function (reason) {\n            error(\"Error decoding audio buffer\", reason);\n        });\n    }\n}\n//# sourceMappingURL=Buffer.js.map","import { _streamPlayerResume, destroyStreamPlayersPool, getNextStreamPlayer } from \"./StreamPlayer\";\nimport { _setAudioParam, audioContextPause, audioContextResume, closeContext, getAudioContextObject, getContext, getContextState, initContext } from \"./Mixer\";\nimport { _getVoiceObj, _voiceChangeDestination, _voicePrepareBuffer, _voiceSetLoop, _voiceSetPitch, _voiceSetRunning, _voiceStartBuffer, _voiceStop, createVoiceObj, voicePool } from \"./Voice\";\nimport { _getBus, _getBusGain, _setBusConnected, busLine, initBusPool, termBusPool } from \"./Bus\";\nimport { setError, warn } from \"./debug\";\nimport { DefaultBus, iMask, Mixer, tMask, Unit } from \"../protocol/interface\";\nimport { _bufferDestroy, _bufferLoad, _bufferMemory, _getBufferObj, buffers, getNextBufferObj } from \"./Buffer\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        buffers.length = 1;\n        destroyStreamPlayersPool();\n        closeContext(ctx);\n    }\n}\nexport function load(filepath, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var obj = buffers[handle & iMask];\n        _bufferLoad(obj, filepath, flags);\n    }\n    return handle;\n}\nexport function loadMemory(data, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var obj = buffers[handle & iMask];\n        _bufferMemory(obj, data, flags);\n    }\n    return handle;\n}\nexport function unload(name) {\n    var obj = _getBufferObj(name);\n    if (obj) {\n        stop(name);\n        _bufferDestroy(obj);\n    }\n}\n/***\n *\n * @param buffer\n * @param gain\n * @param pan\n * @param rate\n * @param flags\n * @param bus\n */\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    // arguments check debug\n    if (flags & ~(2 /* Running */ | 4 /* Loop */)) {\n        setError(20 /* InvalidArguments */);\n        return 0;\n    }\n    ///\n    var ctx = getAudioContextObject();\n    if (!ctx || ctx.state !== \"running\") {\n        setError(21 /* InvalidMixerState */, ctx === null || ctx === void 0 ? void 0 : ctx.state);\n        return 0;\n    }\n    var bufferObj = _getBufferObj(buffer);\n    if (!bufferObj) {\n        setError(15 /* BufferNotFound */);\n        return 0;\n    }\n    if (!(bufferObj.s & 2 /* Loaded */)) {\n        setError(16 /* BufferIsNotLoaded */);\n        return 0;\n    }\n    if (!bufferObj.data) {\n        setError(17 /* BufferNoData */);\n        return 0;\n    }\n    var targetNode = _getBusGain(bus ? bus : DefaultBus);\n    if (!targetNode) {\n        setError(19 /* BusNotFound */);\n        return 0;\n    }\n    var voice = createVoiceObj(ctx);\n    if (voice === 0) {\n        setError(12 /* Warning_NoFreeVoices */);\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    voiceObj.s = 1 /* Active */ | flags;\n    voiceObj.data = buffer;\n    voiceObj._rate = rate;\n    voiceObj._gain = gain;\n    voiceObj._pan = pan;\n    voiceObj.gain.gain.value = gain / Unit;\n    voiceObj.pan.pan.value = pan / Unit - 1;\n    if (bufferObj.s & 4 /* Stream */) {\n        var mes = getNextStreamPlayer(ctx, bufferObj.data);\n        if (!mes) {\n            setError(13 /* Warning_NoFreeStreamPlayers */);\n            return 0;\n        }\n        voiceObj.stream = mes;\n        mes.el.loop = !!(flags & 4 /* Loop */);\n        mes.node.connect(voiceObj.pan);\n        mes.el.onended = voiceObj._e;\n        if (flags & 2 /* Running */) {\n            _streamPlayerResume(mes);\n        }\n    }\n    else {\n        _voicePrepareBuffer(voiceObj, ctx, bufferObj.data);\n        if (flags & 2 /* Running */) {\n            _voiceStartBuffer(voiceObj);\n        }\n    }\n    // maybe we need to set target before `startBuffer()`\n    _voiceChangeDestination(voiceObj, targetNode);\n    _voiceSetPitch(voiceObj, rate);\n    return voice;\n}\nexport function stop(name) {\n    if (name === 0) {\n        return;\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            _voiceStop(obj);\n        }\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            for (var i = 1; i < voicePool.length; ++i) {\n                var v = voicePool[i];\n                if (v.data === name) {\n                    _voiceStop(v);\n                }\n            }\n        }\n        else {\n            setError(15 /* BufferNotFound */);\n        }\n    }\n}\nexport function set(name, param, value) {\n    if (name === 0) {\n        return;\n    }\n    if (name === Mixer && (param & 128 /* Flags */) && (param & 2 /* Running */)) {\n        var ctx = getContext();\n        if (ctx) {\n            if (value && ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n            }\n            else if (!value && ctx.state === \"running\") {\n                audioContextPause(ctx);\n            }\n        }\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                var enabled = value !== 0;\n                if (param & 2 /* Running */) {\n                    _voiceSetRunning(obj, enabled);\n                }\n                else if (param & 4 /* Loop */) {\n                    _voiceSetLoop(obj, enabled);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            obj._gain = value;\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    case 2 /* Pan */:\n                        if (obj._pan !== value) {\n                            obj._pan = value;\n                            _setAudioParam(obj.pan.pan, value / Unit - 1);\n                        }\n                        break;\n                    case 3 /* Rate */:\n                        _voiceSetPitch(obj, value);\n                        break;\n                    case 4 /* CurrentTime */:\n                        // TODO:\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                if (param & 2 /* Running */) {\n                    _setBusConnected(obj, !!value);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n}\nexport function get(name, param) {\n    if (name === Mixer) {\n        var ctx = getAudioContextObject();\n        if (ctx) {\n            if (param === 0 /* State */) {\n                return getContextState(ctx);\n            }\n            else if (param === 5 /* SampleRate */) {\n                return ctx.sampleRate | 0;\n            }\n        }\n        return 0;\n    }\n    var type = name & tMask;\n    if ((param & 256 /* Count */) && !(name & iMask)) {\n        var stateMask = param & 127 /* StateMask */;\n        if (type === 805306368 /* Voice */) {\n            return _countObjectsWithFlags(voicePool, stateMask);\n        }\n        else if (type === 268435456 /* Bus */) {\n            return _countObjectsWithFlags(busLine, stateMask);\n        }\n        else if (type === 536870912 /* Buffer */) {\n            return _countObjectsWithFlags(buffers, stateMask);\n        }\n        return 0;\n    }\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                case 2 /* Pan */:\n                    return obj._pan;\n                case 3 /* Rate */:\n                    return obj._rate;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        d = obj.buffer.buffer.duration * Unit;\n                    }\n                    else if (obj.stream) {\n                        d = obj.stream.el.duration * Unit;\n                    }\n                    return (d * Unit) | 0;\n                }\n                case 4 /* CurrentTime */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        // TODO: :(\n                    }\n                    else if (obj.stream) {\n                        d = obj.stream.el.currentTime;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(1 /* NotSupported */);\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                default:\n                    warn(1 /* NotSupported */);\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.s & 4 /* Stream */) {\n                        // TODO: :(\n                        warn(1 /* NotSupported */);\n                    }\n                    else if (obj.data) {\n                        d = obj.data.duration;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(1 /* NotSupported */);\n                    break;\n            }\n        }\n        return 0;\n    }\n    return 0;\n}\n/** private helpers **/\nfunction _countObjectsWithFlags(arr, mask) {\n    var cnt = 0;\n    for (var i = 1; i < arr.length; ++i) {\n        var obj = arr[i];\n        if (obj && (obj.s & mask) === mask) {\n            ++cnt;\n        }\n    }\n    return cnt;\n}\n//# sourceMappingURL=index.js.map","import { Mixer, Unit } from \"./protocol/interface\";\nimport * as Null from \"./null/index\";\nimport * as Browser from \"./webaudio/index\";\nfunction haveWebAudio() {\n    return typeof window !== \"undefined\" && !!(window.AudioContext || window.webkitAudioContext);\n}\nfunction loadDriver() {\n    if (typeof process !== \"undefined\") {\n        return require(\"bindings\")(\"auph\");\n    }\n    if (haveWebAudio()) {\n        return Browser;\n    }\n    return Null;\n}\nvar _ = loadDriver();\nexport * from \"./protocol/static\";\nexport var init = _.init;\nexport var shutdown = _.shutdown;\nexport var set = _.set;\nexport var get = _.get;\nexport var load = _.load;\nexport var loadMemory = _.loadMemory;\nexport var unload = _.unload;\nexport var stop = _.stop;\nexport function pause(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, true);\n}\nexport function resume(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, false);\n}\nexport function play(buffer, gain, pan, rate, loop, paused, bus) {\n    if (gain === void 0) { gain = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (rate === void 0) { rate = 1.0; }\n    var flags = 0;\n    if (!!loop)\n        flags |= 4 /* Loop */;\n    if (!paused)\n        flags |= 2 /* Running */;\n    return _.voice(buffer, f2u(gain), f2u(+pan + 1), f2u(rate), flags, 0 | bus);\n}\nexport function getMixerStateString(state) {\n    return [\"closed\", \"paused\", \"\", \"running\"][state & 3];\n}\nexport function getBufferStateString(state) {\n    return [\"free\", \"loading\", \"\", \"loaded\"][state & 0x3] + [\"\", \" streaming\"][(state >>> 2) & 0x1];\n}\nexport function setGain(busOrVoice, value) {\n    set(busOrVoice, 1 /* Gain */, f2u(value));\n}\nexport function getGain(busOrVoice) {\n    return get(busOrVoice, 1 /* Gain */) / Unit;\n}\nexport function setPan(voice, pan) {\n    set(voice, 2 /* Pan */, f2u(+pan + 1));\n}\nexport function setRate(voice, rate) {\n    set(voice, 3 /* Rate */, f2u(rate));\n}\nexport function setPause(name, value) {\n    set(name, 128 /* Flags */ | 2 /* Running */, 0 | !value);\n}\nexport function setLoop(voice, value) {\n    set(voice, 128 /* Flags */ | 4 /* Loop */, 0 | value);\n}\nexport function getPan(voice) {\n    return get(voice, 2 /* Pan */) / Unit - 1;\n}\nexport function getRate(voice) {\n    return get(voice, 3 /* Rate */) / Unit;\n}\nexport function getPause(voice) {\n    return !(get(voice, 0 /* State */) & 2 /* Running */);\n}\nexport function getLoop(voice) {\n    return !!(get(voice, 0 /* State */) & 4 /* Loop */);\n}\nexport function getCurrentTime(voice) {\n    return get(voice, 4 /* CurrentTime */) / Unit;\n}\nexport function isActive(name) {\n    return !!(get(name, 0 /* State */) & 1 /* Active */);\n}\nexport function isBufferLoaded(name) {\n    var mask = 1 /* Active */ | 2 /* Loaded */;\n    return (get(name, 0 /* State */) & mask) === mask;\n}\nexport function getDuration(name) {\n    return get(name, 6 /* Duration */) / Unit;\n}\nfunction f2u(x) {\n    return (x * Unit) | 0;\n}\n//# sourceMappingURL=index.js.map","import { Mixer } from \"./interface\";\n/** Export Constants only for pre-bundled usage **/\nexport var SAMPLE_RATE = 5 /* SampleRate */;\nexport var STATE = 0 /* State */;\nexport var COUNT = 256 /* Count */;\nexport var ACTIVE = 1 /* Active */;\nexport var RUNNING = 2 /* Running */;\nexport var STREAM = 4 /* Stream */;\nexport var LOOP = 4 /* Loop */;\nexport var MIXER = Mixer;\nexport var BUS = 268435456 /* Bus */;\nexport var VOICE = 805306368 /* Voice */;\nexport var BUFFER = 536870912 /* Buffer */;\nexport var BUS_MASTER = 268435456 /* Bus */ | 0;\nexport var BUS_SFX = 268435456 /* Bus */ | 1;\nexport var BUS_MUSIC = 268435456 /* Bus */ | 2;\nexport var BUS_SPEECH = 268435456 /* Bus */ | 3;\n//# sourceMappingURL=static.js.map"],"names":["tMask","iMask","Unit","filepath","flags","data","name","buffer","gain","pan","rate","bus","param","value","TAG","warn","message","console","error","reason","emptyWaveData","StreamPlayer","el","node","this","StreamPlayer_isFree","player","src","StreamPlayer_stop","onended","pause","currentTime","disconnect","_streamPlayerResume","play","then","catch","players","getNextStreamPlayer","ctx","i","length","mes","url","Audio","preload","createMediaElementSource","StreamPlayer_create","push","unlockEvents","getContext","state","getAudioContextObject","audioContextResume","resume","unlock","document","removeEventListener","initContext","options","scope","window","AudioContext","webkitAudioContext","_a","newAudioContext","latencyHint","sampleRate","addEventListener","setupUnlockHandler","closeContext","_notNullCtx","close","_setAudioParam","nextHandle","h","VoiceObj","index","_this","s","_gain","_pan","_rate","stream","_started","target","_e","_voiceStop","v","stop","_voiceResetDestination","_voiceStartBuffer","source","loop","start","_voiceSetPitch","playbackRate","voicePool","_getVoiceObj","handle","obj","createVoiceObj","createGain","createStereoPanner","connect","_voiceNew","BusObj","busLine","createBusObj","next","_getBus","BufferObj","buffers","getNextBufferObj","b","_getBufferObj","_fetchURL","cb","fetch","Request","type","_countObjectsWithFlags","arr","mask","cnt","master","destination","initBusPool","termBusPool","destroyStreamPlayersPool","response","blob","URL","createObjectURL","arrayBuffer","decodeAudioData","_bufferLoad","slice","byteOffset","byteLength","Blob","audioBuffer","_bufferMemory","revokeObjectURL","_bufferDestroy","bufferObj","targetNode","undefined","voice","voiceObj","createBufferSource","_voicePrepareBuffer","_voiceChangeDestination","suspend","audioContextPause","enabled","_voiceSetRunning","_voiceSetLoop","connected","dest","_setBusConnected","getContextState","stateMask","d","duration","_","process","require","Browser","Null","init","shutdown","set","get","load","loadMemory","unload","setPause","f2u","x","busOrVoice","paused"],"mappings":"kCAGO,IAAIA,EAAQ,UAGRC,EAAQ,IAGRC,EAAO,8CCTX,sBAEA,kBAEA,SAAcC,EAAUC,GAC3B,OAAO,cAEJ,SAAoBC,EAAMD,GAC7B,OAAO,UAEJ,SAAgBE,WAEhB,SAAeC,EAAQC,EAAMC,EAAKC,EAAMN,EAAOO,GAClD,OAAO,QAEJ,SAAcL,SAEd,SAAaA,EAAMM,EAAOC,SAE1B,SAAaP,EAAMM,GACtB,OAAO,KCpBPE,EAAM,SAOH,SAASC,EAAKC,GACjBC,QAAQF,KAAKD,EAAKE,GAEf,SAASE,EAAMF,EAASG,GAC3BF,QAAQC,MAAMJ,EAAKE,EAASG,GCVhC,IAAIC,EAAgB,qFAChBC,EACA,SAAsBC,EAAIC,GACtBC,KAAKF,GAAKA,EACVE,KAAKD,KAAOA,GAWb,SAASE,EAAoBC,GAChC,OAAOA,EAAOJ,GAAGK,MAAQP,EAEtB,SAASQ,EAAkBF,GAC9B,IAAIJ,EAAKI,EAAOJ,GACZA,EAAGK,MAAQP,IACXE,EAAGO,QAAU,KACbP,EAAGQ,QACHR,EAAGK,IAAMP,EACTE,EAAGS,YAAc,EACjBL,EAAOH,KAAKS,cAGb,SAASC,EAAoBP,GAChCA,EAAOJ,GAAGY,OAAOC,MAAK,eAEnBC,OAAM,SAAUjB,GACfD,EAAM,uBAAwBC,MAGtC,IAAIkB,EAAU,GAEP,SAASC,EAAoBC,EAAKZ,GACrC,IAAK,IAAIa,EAAI,EAAGA,EAAIH,EAAQI,SAAUD,EAAG,CACrC,IAAId,EAASW,EAAQG,GACrB,GAAIf,EAAoBC,GAEpB,OADAA,EAAOJ,GAAGK,IAAMA,EACTD,EAGf,GAAIW,EAAQI,OATM,EASoB,CAClC,IAAIC,EArCL,SAA6BH,EAAKI,GACrC,IAAIrB,EAAK,IAAIsB,MAAMD,GAGnB,OAFArB,EAAGuB,QAAU,WACbvB,EAAmB,gBAAI,EAChB,IAAID,EAAaC,EAAIiB,EAAIO,yBAAyBxB,IAiC3CyB,CAAoBR,EAAKZ,GAEnC,OADAU,EAAQW,KAAKN,GACNA,EAEX,OAAO,KClDX,IAAIH,EAAM,KAENU,EAAe,CAAC,QAAS,WAEtB,SAASC,IACZ,OAAKX,GAAqB,WAAdA,EAAIY,MAITZ,GAHHxB,EAAK,GACE,MAIR,SAASqC,IACZ,OAAOb,EAYJ,SAASc,EAAmBd,GAE/BA,EAAIe,SAASnB,MAAK,eAEfC,OAAM,SAAUjB,GACfD,EAAM,EAA2BC,MAWzC,SAASoC,IAEL,IAAK,IAAIf,EAAI,EAAGA,EAAIS,EAAaR,SAAUD,EACvCgB,SAASC,oBAAoBR,EAAaT,GAAIe,GAAQ,GAEtDhB,GAAqB,cAAdA,EAAIY,OACXE,EAAmBd,GAmBpB,SAASmB,IACZ,OAAInB,GACAxB,EAAK,IACEwB,KAEXA,EAhBJ,SAAyBoB,GACrB,IACI,IAAIC,EAAQC,OAEZ,OAAO,IADYD,EAAME,cAAgBF,EAAMG,oBACvBJ,GAE5B,MAAOK,GACH9C,EAAM,GAEV,OAAO,KAOD+C,CAAgB,CAClBC,YAAa,cACbC,WAAY,UAES,cAAd5B,EAAIY,OAzBnB,WACI,IAAK,IAAIX,EAAI,EAAGA,EAAIS,EAAaR,SAAUD,EACvCgB,SAASY,iBAAiBnB,EAAaT,GAAIe,GAAQ,GAyBnDc,GAEG9B,GAEJ,SAAS+B,EAAaC,GAEzBA,EAAYC,QAAQrC,MAAK,eAEtBC,OAAM,SAAUjB,GACfD,EAAM,GAA2BC,MAErCoB,EAAM,KAEH,SAASkC,EAAe7D,EAAOC,GAC9BD,EAAMC,QAAUA,IAChBD,EAAMC,MAAQA,GC3Ff,SAAS6D,EAAWC,GACvB,OAASA,ELGM,IADA,mBKFiBA,ECCpC,IAAIC,EACA,SAAkBpE,EAAMC,EAAKoE,GACzB,IAAIC,EAAQtD,KACZA,KAAKhB,KAAOA,EACZgB,KAAKf,IAAMA,EAEXe,KAAKmD,EAAI,EAETnD,KAAKuD,EAAI,EACTvD,KAAKwD,MAAQ9E,EACbsB,KAAKyD,KAAO/E,EACZsB,KAAK0D,MAAQhF,EACbsB,KAAKnB,KAAO,EACZmB,KAAKb,IAAM,EACXa,KAAK2D,OAAS,KAEd3D,KAAK4D,UAAW,EAChB5D,KAAKjB,OAAS,KAEdiB,KAAK6D,OAAS,KACd7D,KAAK8D,GAAK,WAGNC,EAAWT,IAGftD,KAAKmD,EAAI,UAAwBE,GA6BlC,SAASU,EAAWC,GAEnBA,EAAEL,SACFvD,EAAkB4D,EAAEL,QACpBK,EAAEL,OAAS,MAGf,IAAI5E,EAASiF,EAAEjF,OACXA,IACgC,IAArB,EAANiF,EAAET,IACHxE,EAAOkF,OAEXlF,EAAOyB,aACPwD,EAAEjF,OAAS,MAnBZ,SAAgCiF,GAC/BA,EAAEH,SACFG,EAAEhF,KAAKwB,WAAWwD,EAAEH,QACpBG,EAAEH,OAAS,MAkBfK,CAAuBF,GACvBA,EAAEnF,KAAO,EACTmF,EAAE7E,IAAM,EACR6E,EAAET,EAAI,EACNS,EAAEb,EAAID,EAAWc,EAAEb,GAEhB,SAASgB,EAAkBH,GAC9B,IAAII,EAASJ,EAAEjF,OACXqF,IAAWJ,EAAEJ,WAEbQ,EAAO/D,QAAU2D,EAAEF,GACnBM,EAAOC,KAAgC,IAAlB,EAANL,EAAET,GACjBa,EAAOE,QACPN,EAAEJ,UAAW,GA2Cd,SAASW,EAAeP,EAAG3E,GAC1B2E,EAAEN,QAAUrE,IACZ2E,EAAEN,MAAQrE,EACN2E,EAAEL,OACFK,EAAEL,OAAO7D,GAAG0E,aAAenF,EAAQX,EAE9BsF,EAAEjF,QACyB,IAArB,EAANiF,EAAET,KACHS,EAAEjF,OAAOyF,aAAanF,MAAQA,EAAQX,IAK/C,IAAI+F,EAAY,CAAC,MAEjB,SAASC,EAAaC,GACzB,IAAIC,EAAMH,EAAUE,EAASlG,GAC7B,OAAQmG,GAAOA,EAAIzB,IAAMwB,EAAUC,EAAM,KAEtC,SAASC,EAAe9D,GAC3B,IAAK,IAAIC,EAAI,EAAGA,EAAIyD,EAAUxD,SAAUD,EAAG,CAEvC,GAAY,KADRgD,EAAIS,EAAUzD,IACZuC,EACF,OAAOS,EAAEb,EAGjB,IAEQa,EAFJX,EAAQoB,EAAUxD,OACtB,OAAIoC,EAba,KAcTW,EA3HL,SAAmBjD,EAAKsC,GAC3B,IAAIrE,EAAO+B,EAAI+D,aACX7F,EAAM8B,EAAIgE,qBAEd,OADA9F,EAAI+F,QAAQhG,GACL,IAAIoE,EAASpE,EAAMC,EAAKoE,GAuHnB4B,CAAUlE,EAAKsC,IACrBF,EAAI,UAAwBE,EAC9BoB,EAAUjD,KAAKwC,GACRA,EAAEb,GAEN,EChKX,IAAI+B,EACA,SAAgBlG,GACZgB,KAAKhB,KAAOA,EACZgB,KAAKmD,EAAI,EACTnD,KAAKuD,EAAI,EACTvD,KAAKwD,MAAQ9E,GAKVyG,EAAU,GACd,SAASC,EAAarE,GACzB,IAAIsE,EAAOF,EAAQlE,OACf2D,EAAM,IAAIM,EAAOnE,EAAI+D,cAGzB,OAFAF,EAAIzB,EAAW,UAAPkC,EACRF,EAAQ3D,KAAKoD,GACNA,EAeJ,SAASU,EAAQnG,GACpB,IAAIyF,EAAMO,EAAQhG,EAAMV,GACxB,OAAQmG,GAAOA,EAAIzB,IAAMhE,EAAOyF,EAAM,KC/B1C,IAAIW,EACA,SAAmBlC,GAEfrD,KAAKuD,EAAI,EACTvD,KAAKnB,KAAO,KACZmB,KAAKmD,EAAY,UAARE,GAKNmC,EAAU,CAAC,MAEf,SAASC,IACZ,IAAK,IAAIzE,EAAI,EAAGA,EAAIwE,EAAQvE,SAAUD,EAAG,CACrC,IAAIjC,EAASyG,EAAQxE,GACrB,GAAiB,IAAbjC,EAAOwE,EACP,OAAOxE,EAAOoE,EAGtB,IAAIkC,EAAOG,EAAQvE,OACnB,GAAIoE,EATc,IASU,CACxB,IAAIK,EAAI,IAAIH,EAAUF,GAEtB,OADAG,EAAQhE,KAAKkE,GACNA,EAAEvC,EAEb,OAAO,EAUJ,SAASwC,EAAc5G,GAC1B,IAAI6F,EAAMY,EAAQzG,EAASN,GAC3B,OAAImG,GAAOA,EAAIzB,IAAMpE,EACV6F,EAEJ,KAEX,SAASgB,EAAUjH,EAAUkH,GACzB,OAAOC,MAAM,IAAIC,QAAQpH,IAAWgC,KAAKkF,GC4EtC,SAAS5B,EAAKnF,GACjB,GAAa,IAATA,EAAJ,CAGA,IAAIkH,EAAOlH,EAAON,EAClB,GAAa,YAATwH,GACIpB,EAAMF,EAAa5F,KAEnBiF,EAAWa,QAGd,GAAa,YAAToB,EAAiC,CACtC,IAAIpB,EACJ,GADIA,EAAMe,EAAc7G,GAEpB,IAAK,IAAIkC,EAAI,EAAGA,EAAIyD,EAAUxD,SAAUD,EAAG,CACvC,IAAIgD,EAAIS,EAAUzD,GACdgD,EAAEnF,OAASC,GACXiF,EAAWC,MAiM/B,SAASiC,EAAuBC,EAAKC,GAEjC,IADA,IAAIC,EAAM,EACDpF,EAAI,EAAGA,EAAIkF,EAAIjF,SAAUD,EAAG,CACjC,IAAI4D,EAAMsB,EAAIlF,GACV4D,IAAQA,EAAIrB,EAAI4C,KAAUA,KACxBC,EAGV,OAAOA,2CA9UJ,WACH,IAAIrF,EAAMmB,IACNnB,GFWD,SAAqBA,GACxB,IAAIsF,EAASjB,EAAarE,GAAK/B,KAC/BqH,EAAOrB,QAAQjE,EAAIuF,aACnBlB,EAAarE,GAAK/B,KAAKgG,QAAQqB,GAC/BjB,EAAarE,GAAK/B,KAAKgG,QAAQqB,GAC/BjB,EAAarE,GAAK/B,KAAKgG,QAAQqB,GEf3BE,CAAYxF,aAGb,WACH,IAAIA,EAAMW,IACNX,KFYD,WACH,IAAK,IAAIC,EAAI,EAAGA,EAAImE,EAAQlE,SAAUD,EAClCmE,EAAQnE,GAAGhC,KAAKwB,aAEpB2E,EAAQlE,OAAS,EEfbuF,GACA/B,EAAUxD,OAAS,EACnBuE,EAAQvE,OAAS,ENmClB,WACH,IAAK,IAAID,EAAI,EAAGA,EAAIH,EAAQI,SAAUD,EAAG,CACrC,IAAId,EAASW,EAAQG,GACrBZ,EAAkBF,GAClBA,EAAOJ,GAAGK,IAAM,GAEpBU,EAAQI,OAAS,EMxCbwF,GACA3D,EAAa/B,UAGd,SAAcpC,EAAUC,GAC3B,IAAI+F,EAASc,IAKb,OAJId,GD4CD,SAAqBC,EAAKjG,EAAUC,GACvCgG,EAAIrB,GAAK,EACG,EAAR3E,GACAgG,EAAIrB,GAAK,EACTqC,EAAUjH,GAAU,SAAU+H,GAAY,OAAOA,EAASC,UAAWhG,MAAK,SAAUgG,GAChF/B,EAAI/F,KAAO+H,IAAIC,gBAAgBF,GAC/B/B,EAAIrB,GAAK,KACV3C,OAAM,SAAUjB,GACfD,EAAM,gCAAkCf,EAAUgB,OAKtDiG,EAAUjH,GAAU,SAAU+H,GAAY,OAAOA,EAASI,iBAAkBnG,MAAK,SAAU5B,GACvF,IAAIgC,EAAMW,IACV,OAAIX,EAEOA,EAAIgG,gBAAgBhI,GAExB,QACR4B,MAAK,SAAU5B,GACd6F,EAAI/F,KAAOE,EACPA,IAEA6F,EAAIrB,GAAK,MAEd3C,OAAM,SAAUjB,GACfD,EAAM,8BAA+BC,MCrEzCqH,CADUxB,EAAQb,EAASlG,GACVE,EAAUC,GAExB+F,cAEJ,SAAoB9F,EAAMD,GAC7B,IAAI+F,EAASc,IAKb,OAJId,GDgBD,SAAuBC,EAAK/F,EAAMD,GACrCgG,EAAIrB,GAAK,EACT,IAAIxE,EAASF,EAAKE,OAAOkI,MAAMpI,EAAKqI,WAAYrI,EAAKqI,WAAarI,EAAKsI,YACvE,GAAY,EAARvI,EACAgG,EAAIrB,GAAK,EACTqB,EAAI/F,KAAO+H,IAAIC,gBAAgB,IAAIO,KAAK,CAACrI,KACzC6F,EAAIrB,GAAK,MAER,CACD,IAAIxC,EAAMW,IACNX,GACAA,EAAIgG,gBAAgBhI,GAAQ4B,MAAK,SAAU0G,GACvCzC,EAAI/F,KAAOwI,EACXzC,EAAIrB,GAAK,KACV3C,OAAM,SAAUjB,GACfD,EAAM,4BAA6BC,OC7B3C2H,CADU9B,EAAQb,EAASlG,GACRI,EAAMD,GAEtB+F,UAEJ,SAAgB7F,GACnB,IAAI8F,EAAMe,EAAc7G,GACpB8F,IACAX,EAAKnF,GDXN,SAAwB8F,GACM,IAApB,EAARA,EAAIrB,IAA6BqB,EAAI/F,MACtC+H,IAAIW,gBAAgB3C,EAAI/F,MAE5B+F,EAAIrB,EAAI,EACRqB,EAAIzB,EAAID,EAAW0B,EAAIzB,GACvByB,EAAI/F,KAAO,KCMP2I,CAAe5C,WAYhB,SAAe7F,EAAQC,EAAMC,EAAKC,EAAMN,EAAOO,GAElD,IAAY,EAARP,EAEA,OAAO,EAGX,IAAImC,EAAMa,IACV,IAAKb,GAAqB,YAAdA,EAAIY,MAEZ,OADqCZ,MAAAA,GAA0CA,EAAIY,MAC5E,EAEX,IAAI8F,EAAY9B,EAAc5G,GAC9B,IAAK0I,EAED,OAAO,EAEX,KAAoB,EAAdA,EAAUlE,GAEZ,OAAO,EAEX,IAAKkE,EAAU5I,KAEX,OAAO,EAEX,IF1CI+F,EE0CA8C,GF1CA9C,EAAMU,EE0CmBnG,GTtET,YO6BPyF,EAAI5F,UAAO2I,EE0CxB,IAAKD,EAED,OAAO,EAEX,IAAIE,EAAQ/C,EAAe9D,GAC3B,GAAc,IAAV6G,EAEA,OAAO,EAEX,IAAIC,EAAWnD,EAAakD,GAQ5B,GAPAC,EAAStE,EAAI,EAAiB3E,EAC9BiJ,EAAShJ,KAAOE,EAChB8I,EAASnE,MAAQxE,EACjB2I,EAASrE,MAAQxE,EACjB6I,EAASpE,KAAOxE,EAChB4I,EAAS7I,KAAKA,KAAKK,MAAQL,EAAON,EAClCmJ,EAAS5I,IAAIA,IAAII,MAAQJ,EAAMP,EAAO,EACpB,EAAd+I,EAAUlE,EAAoB,CAC9B,IAAIrC,EAAMJ,EAAoBC,EAAK0G,EAAU5I,MAC7C,IAAKqC,EAED,OAAO,EAEX2G,EAASlE,OAASzC,EAClBA,EAAIpB,GAAGuE,QAAkB,EAARzF,GACjBsC,EAAInB,KAAKiF,QAAQ6C,EAAS5I,KAC1BiC,EAAIpB,GAAGO,QAAUwH,EAAS/D,GACd,EAARlF,GACA6B,EAAoBS,QHpBzB,SAA6B8C,EAAGjD,EAAKsG,GACxC,IAAIjD,EAASrD,EAAI+G,qBACjB1D,EAAOrF,OAASsI,EAChBjD,EAAOY,QAAQhB,EAAE/E,KACjB+E,EAAEjF,OAASqF,EACXJ,EAAEJ,UAAW,EGmBTmE,CAAoBF,EAAU9G,EAAK0G,EAAU5I,MACjC,EAARD,GACAuF,EAAkB0D,GAM1B,OHjFG,SAAiC7D,EAAGH,GACvC,GAAIA,IAAWG,EAAEH,OAAQ,CACrB,IAAI7E,EAAOgF,EAAEhF,KACTgF,EAAEH,QACF7E,EAAKwB,WAAWwD,EAAEH,QAEtBG,EAAEH,OAASA,EACPA,GACA7E,EAAKgG,QAAQnB,IGuErBmE,CAAwBH,EAAUH,GAClCnD,EAAesD,EAAU3I,GAClB0I,cA4BJ,SAAa9I,EAAMM,EAAOC,GAC7B,GAAa,IAATP,EAAJ,CAGA,GTlJe,ISkJXA,GAA2B,IAARM,GAAqC,EAARA,EAA0B,CAC1E,IAAI2B,EAAMW,IACNX,IACI1B,GAAuB,cAAd0B,EAAIY,MACbE,EAAmBd,GAEb1B,GAAuB,YAAd0B,EAAIY,OL9H5B,SAA2BZ,GAE9BA,EAAIkH,UAAUtH,MAAK,eAEhBC,OAAM,SAAUjB,GACfD,EAAM,EAA0BC,MK0HxBuI,CAAkBnH,IAI9B,IAAIiF,EAAOlH,EAAON,EAClB,GAAa,YAATwH,GAEA,GADIpB,EAAMF,EAAa5F,GAEnB,GAAY,IAARM,EAAyB,CACzB,IAAI+I,EAAoB,IAAV9I,EACF,EAARD,EH9Db,SAA0B4E,EAAG3E,GAE5BA,OADmB,EAAN2E,EAAET,KAEfS,EAAET,GAAK,EACHS,EAAEL,OACEtE,EACAoB,EAAoBuD,EAAEL,QAGtBK,EAAEL,OAAO7D,GAAGQ,QAGX0D,EAAEjF,SACPiF,EAAEjF,OAAOyF,aAAanF,MAAQA,EAAS2E,EAAEN,MAAQhF,EAAQ,EACrDW,GAEA8E,EAAkBH,KG+CdoE,CAAiBxD,EAAKuD,GAET,EAAR/I,GH7ElB,SAAuB4E,EAAG3E,GAEzBA,KADmC,IAAlB,EAAN2E,EAAET,MAEbS,EAAET,GAAK,EACHS,EAAEL,OACFK,EAAEL,OAAO7D,GAAGuE,KAAOhF,EAEd2E,EAAEjF,SACPiF,EAAEjF,OAAOsF,KAAOhF,IGsERgJ,CAAczD,EAAKuD,QAIvB,OAAQ/I,GACJ,KAAK,EACGwF,EAAIpB,QAAUnE,IACduF,EAAIpB,MAAQnE,EACZ4D,EAAe2B,EAAI5F,KAAKA,KAAMK,EAAQX,IAE1C,MACJ,KAAK,EACGkG,EAAInB,OAASpE,IACbuF,EAAInB,KAAOpE,EACX4D,EAAe2B,EAAI3F,IAAIA,IAAKI,EAAQX,EAAO,IAE/C,MACJ,KAAK,EACD6F,EAAeK,EAAKvF,SAWnC,GAAa,YAAT2G,EAA8B,CACnC,IAAIpB,EACJ,GADIA,EAAMU,EAAQxG,GAEd,GAAY,IAARM,EACY,EAARA,GFtKb,SAA0BD,EAAKmJ,GAElC,MADsB,EAARnJ,EAAIoE,KACL+E,EAAW,CACpB,IAAIjC,EAASlB,EAAQ,GACjBoD,EAAOpJ,IAAQkH,EAASzE,IAAwB0E,YAAcD,EAAOrH,KACrEsJ,EACAnJ,EAAIH,KAAKgG,QAAQuD,GAGjBpJ,EAAIH,KAAKwB,WAAW+H,GAExBpJ,EAAIoE,GAAK,GE4JGiF,CAAiB5D,IAAOvF,QAI5B,OAAQD,GACJ,KAAK,EACGwF,EAAIpB,QAAUnE,GACd4D,EAAe2B,EAAI5F,KAAKA,KAAMK,EAAQX,WAU3D,SAAaI,EAAMM,GACtB,GT3Ne,IS2NXN,EAAgB,CAChB,IAAIiC,EAAMa,IACV,GAAIb,EAAK,CACL,GAAc,IAAV3B,EACA,OLvNT,SAAyB2B,GAC5B,IAAIY,EAAQ,EAOZ,MANkB,WAAdZ,EAAIY,QACJA,GAAS,EACS,YAAdZ,EAAIY,QACJA,GAAS,IAGVA,EK+MY8G,CAAgB1H,GAEtB,GAAc,IAAV3B,EACL,OAAwB,EAAjB2B,EAAI4B,WAGnB,OAAO,EAEX,IAAIqD,EAAOlH,EAAON,EAClB,GAAa,IAARY,KAA8BN,EAAOL,GAAQ,CAC9C,IAAIiK,EAAoB,IAARtJ,EAChB,OAAa,YAAT4G,EACOC,EAAuBxB,EAAWiE,GAE3B,YAAT1C,EACEC,EAAuBd,EAASuD,GAEzB,YAAT1C,EACEC,EAAuBT,EAASkD,GAEpC,EAEX,GAAa,YAAT1C,EAAgC,CAEhC,GADIpB,EAAMF,EAAa5F,GAEnB,OAAQM,GACJ,KAAK,EACD,OAAOwF,EAAIrB,EACf,KAAK,EACD,OAAOqB,EAAIpB,MACf,KAAK,EACD,OAAOoB,EAAInB,KACf,KAAK,EACD,OAAOmB,EAAIlB,MACf,KAAK,EACD,IAAIiF,EAAI,EAOR,OANI/D,EAAI7F,QAAU6F,EAAI7F,OAAOA,OACzB4J,EAAI/D,EAAI7F,OAAOA,OAAO6J,SAAWlK,EAE5BkG,EAAIjB,SACTgF,EAAI/D,EAAIjB,OAAO7D,GAAG8I,SAAWlK,GAEzBiK,EAAIjK,EAAQ,EAExB,KAAK,EACGiK,EAAI,EAOR,OANI/D,EAAI7F,QAAU6F,EAAI7F,OAAOA,QAGpB6F,EAAIjB,SACTgF,EAAI/D,EAAIjB,OAAO7D,GAAGS,aAEdoI,EAAIjK,EAAQ,EAExB,QACIa,EAAK,GAIjB,OAAO,EAEN,GAAa,YAATyG,EAA8B,CAEnC,GADIpB,EAAMU,EAAQxG,GAEd,OAAQM,GACJ,KAAK,EACD,OAAOwF,EAAIrB,EACf,KAAK,EACD,OAAOqB,EAAIpB,MACf,QACIjE,EAAK,GAIjB,OAAO,EAEN,GAAa,YAATyG,EAAiC,CACtC,IAAIpB,EACJ,GADIA,EAAMe,EAAc7G,GAEpB,OAAQM,GACJ,KAAK,EACD,OAAOwF,EAAIrB,EACf,KAAK,EACGoF,EAAI,EAQR,OAPY,EAAR/D,EAAIrB,EAEJhE,EAAK,GAEAqF,EAAI/F,OACT8J,EAAI/D,EAAI/F,KAAK+J,UAETD,EAAIjK,EAAQ,EAExB,QACIa,EAAK,GAIjB,OAAO,EAEX,OAAO,KC3TX,IAAIsJ,EARuB,oBAAZC,QACAC,QAAQ,WAARA,CAAoB,QAJN,oBAAX1G,SAA6BA,OAAOC,cAAgBD,OAAOE,oBAO9DyG,EAEJC,EAIAC,EAAOL,EAAEK,KACTC,EAAWN,EAAEM,SACbC,EAAMP,EAAEO,IACRC,EAAMR,EAAEQ,IACRC,EAAOT,EAAES,KACTC,EAAaV,EAAEU,WACfC,EAASX,EAAEW,OACXvF,EAAO4E,EAAE5E,KAsCb,SAASwF,EAAS3K,EAAMO,GAC3B+J,EAAItK,EAAM,IAAmC,GAAKO,GA8BtD,SAASqK,GAAIC,GACT,OAAQA,EAAIjL,EAAQ,kBCzFJ,WAOA,gBAFH,uBAGO,sBAED,oBADF,uBAEG,kBAZL,WAID,UXDC,YWDE,gBAJI,UACN,WAIC,UAID,yCDoCZ,SAA8BiD,GACjC,MAAO,CAAC,OAAQ,UAAW,GAAI,UAAkB,EAARA,GAAe,CAAC,GAAI,cAAeA,IAAU,EAAK,qBAgCxF,SAAwBiG,GAC3B,OAAOyB,EAAIzB,EAAO,GAAuBlJ,iBAStC,SAAqBI,GACxB,OAAOuK,EAAIvK,EAAM,GAAoBJ,aAtClC,SAAiBkL,GACpB,OAAOP,EAAIO,EAAY,GAAgBlL,aAuBpC,SAAiBkJ,GACpB,SAAsC,EAA5ByB,EAAIzB,EAAO,2BAlClB,SAA6BjG,GAChC,MAAO,CAAC,SAAU,SAAU,GAAI,WAAmB,EAARA,aAuBxC,SAAgBiG,GACnB,OAAOyB,EAAIzB,EAAO,GAAelJ,EAAO,cAKrC,SAAkBkJ,GACrB,QAAqC,EAA5ByB,EAAIzB,EAAO,eAJjB,SAAiBA,GACpB,OAAOyB,EAAIzB,EAAO,GAAgBlJ,uBAW/B,SAAkBI,GACrB,SAAqC,EAA3BuK,EAAIvK,EAAM,sBAEjB,SAAwBA,GAE3B,OADW,IAAA,EACHuK,EAAIvK,EAAM,qCA/Df,SAAeA,QACL,IAATA,IAAmBA,EVnBR,GUoBf2K,EAAS3K,GAAM,WAMZ,SAAcC,EAAQC,EAAMC,EAAKC,EAAMmF,EAAMwF,EAAQ1K,QAC3C,IAATH,IAAmBA,EAAO,QAClB,IAARC,IAAkBA,EAAM,QACf,IAATC,IAAmBA,EAAO,GAC9B,IAAIN,EAAQ,EAKZ,OAJMyF,IACFzF,GAAS,GACRiL,IACDjL,GAAS,GACNiK,EAAEjB,MAAM7I,EAAQ2K,GAAI1K,GAAO0K,IAAKzK,EAAM,GAAIyK,GAAIxK,GAAON,EAAO,EAAIO,aAbpE,SAAgBL,QACN,IAATA,IAAmBA,EVvBR,GUwBf2K,EAAS3K,GAAM,sBAmBZ,SAAiB8K,EAAYvK,GAChC+J,EAAIQ,EAAY,EAAcF,GAAIrK,eAc/B,SAAiBuI,EAAOvI,GAC3B+J,EAAIxB,EAAO,IAAgC,EAAIvI,aAV5C,SAAgBuI,EAAO3I,GAC1BmK,EAAIxB,EAAO,EAAa8B,IAAKzK,EAAM,4BAEhC,SAAiB2I,EAAO1I,GAC3BkK,EAAIxB,EAAO,EAAc8B,GAAIxK"}