{"version":3,"file":"auph.js","sources":["../module/protocol/interface.js","../module/null/index.js","../module/webaudio/debug.js","../module/webaudio/Mixer.js","../module/webaudio/Unlock.js","../module/webaudio/common.js","../module/webaudio/Voice.js","../module/webaudio/Bus.js","../module/webaudio/Buffer.js","../module/webaudio/index.js","../module/index.js","../module/protocol/static.js"],"sourcesContent":["/**\n * Object Name Identifier Layout: [00tt 0000 | vvvv vvvv | vvvv vvvv | iiii iiii]\n */\nexport var tMask = 0x30000000;\nexport var vMask = 0x00FFFF00;\nexport var vIncr = 0x00000100;\nexport var iMask = 0x000000FF;\nexport var Mixer = 0x00000001;\n// used for integer to float params conversion\nexport var Unit = 1024;\nexport var DefaultBus = 1 /* Sound */ | 268435456 /* Bus */;\n//# sourceMappingURL=interface.js.map","export function init() {\n}\nexport function shutdown() {\n}\nexport function load(filepath, flags) {\n    return 0;\n}\nexport function loadMemory(data, flags) {\n    return 0;\n}\nexport function unload(name) {\n}\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    return 0;\n}\nexport function stop(name) {\n}\nexport function set(name, param, value) {\n}\nexport function get(name, param) {\n    return 0;\n}\n//# sourceMappingURL=index.js.map","var TAG = \"[AUPH]\";\nvar lastStatus = 0;\nexport function log(message) {\n    if (process.env.NODE_ENV !== \"production\") {\n        console.log(TAG, message);\n    }\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function setError(status, context) {\n    if (process.env.NODE_ENV !== \"production\") {\n        error(status, context);\n    }\n    lastStatus = status;\n}\nexport function measure(ts) {\n    if (process.env.NODE_ENV !== \"production\") {\n        return performance.now() - ts;\n    }\n    else {\n        return 0;\n    }\n}\n//# sourceMappingURL=debug.js.map","import { error, log, warn } from \"./debug\";\nimport { unlock } from \"./Unlock\";\nvar ctx = null;\nexport var emptyAudioBuffer = null;\nvar defaultSampleRate = 22050;\nexport function getContext() {\n    if (!ctx || ctx.state === \"closed\") {\n        warn(2 /* InvalidState */);\n        return null;\n    }\n    return ctx;\n}\nexport function getAudioContextObject() {\n    return ctx;\n}\nexport function getContextState(ctx) {\n    var state = 0;\n    if (ctx.state !== \"closed\") {\n        state |= 1 /* Active */;\n        if (ctx.state === \"running\") {\n            state |= 2 /* Running */;\n        }\n    }\n    return state;\n}\nexport function audioContextResume(ctx) {\n    log(3 /* DeviceResuming */);\n    ctx.resume().then(function () {\n        log(4 /* DeviceResumed */);\n    }).catch(function (reason) {\n        error(5 /* DeviceResumeError */, reason);\n    });\n}\nexport function audioContextPause(ctx) {\n    log(6 /* DevicePausing */);\n    ctx.suspend().then(function () {\n        log(7 /* DevicePaused */);\n    }).catch(function (reason) {\n        error(8 /* DevicePauseError */, reason);\n    });\n}\nfunction newAudioContext(options) {\n    try {\n        var scope = window;\n        var audioContext = scope.AudioContext || scope.webkitAudioContext;\n        return new audioContext(options);\n    }\n    catch (_a) {\n        error(1 /* NotSupported */);\n    }\n    return null;\n}\nexport function initContext() {\n    if (ctx) {\n        warn(14 /* Warning_AlreadyInitialized */);\n        return ctx;\n    }\n    ctx = newAudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: defaultSampleRate\n    });\n    if (ctx) {\n        if (!emptyAudioBuffer) {\n            emptyAudioBuffer = ctx.createBuffer(1, 1, defaultSampleRate);\n        }\n        unlock(function () {\n            if (ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n                return false;\n            }\n            return true;\n        });\n    }\n    return ctx;\n}\nexport function closeContext(context) {\n    log(9 /* DeviceClosing */);\n    context.close().then(function () {\n        log(10 /* DeviceClosed */);\n    }).catch(function (reason) {\n        error(11 /* DeviceCloseError */, reason);\n    });\n    ctx = null;\n}\nexport function _setAudioParam(param, value) {\n    if (param.value !== value) {\n        param.value = value;\n    }\n}\n//# sourceMappingURL=Mixer.js.map","export function unlock(unlocked) {\n    // \"touchstart\", \"touchend\", \"mousedown\", \"pointerdown\"\n    var events = [\"touchstart\", \"touchend\", \"mousedown\", \"click\", \"keydown\"];\n    var num = events.length;\n    var doc = document;\n    var handle = function () {\n        if (unlocked()) {\n            for (var i = 0; i < num; ++i) {\n                doc.removeEventListener(events[i], handle, true);\n            }\n        }\n    };\n    for (var i = 0; i < num; ++i) {\n        doc.addEventListener(events[i], handle, true);\n    }\n}\n//# sourceMappingURL=Unlock.js.map","import { iMask, tMask, vIncr, vMask } from \"../protocol/interface\";\nexport function nextHandle(h) {\n    return ((h + vIncr) & vMask) | (h & (tMask | iMask));\n}\n//# sourceMappingURL=common.js.map","import { iMask, Unit } from \"../protocol/interface\";\nimport { nextHandle } from \"./common\";\nimport { emptyAudioBuffer } from \"./Mixer\";\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan, index) {\n        var _this = this;\n        this.gain = gain;\n        this.pan = pan;\n        // handle passport\n        this.h = 0;\n        // Control Flags\n        this.s = 0;\n        this._gain = Unit;\n        this._pan = Unit;\n        this._rate = Unit;\n        this.data = 0;\n        this.bus = 0;\n        // static buffer playback\n        this._started = false;\n        this.buffer = null;\n        // connected destination audio node\n        this.out = null;\n        this._e = function () {\n            // maybe check is useful\n            //if (this.buffer === e.target || (this.stream && this.stream.el === e.target)) {\n            _voiceStop(_this);\n            //}\n        };\n        this.h = 805306368 /* Voice */ | index;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function _voiceNew(ctx, index) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan, index);\n}\nexport function _voiceChangeDestination(v, target) {\n    if (target !== v.out) {\n        var gain = v.gain;\n        if (v.out) {\n            gain.disconnect(v.out);\n        }\n        v.out = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function _voiceResetDestination(v) {\n    if (v.out) {\n        v.gain.disconnect(v.out);\n        v.out = null;\n    }\n}\nexport function _voiceStop(v) {\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.s & 2 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.onended = null;\n        buffer.disconnect();\n        try {\n            buffer.buffer = emptyAudioBuffer;\n        }\n        catch (_a) {\n        }\n        v.buffer = null;\n    }\n    _voiceResetDestination(v);\n    v.data = 0;\n    v.bus = 0;\n    v.s = 0;\n    v.h = nextHandle(v.h);\n}\nexport function _voiceStartBuffer(v) {\n    var source = v.buffer;\n    if (source && !v._started) {\n        //source.addEventListener(\"ended\", v._e, {once: true});\n        source.onended = v._e;\n        source.loop = (v.s & 4 /* Loop */) !== 0;\n        source.start();\n        v._started = true;\n    }\n}\nexport function _voicePrepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n    v._started = false;\n}\nexport function _voiceSetLoop(v, value) {\n    var current = (v.s & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.s ^= 4 /* Loop */;\n        if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function _voiceSetRunning(v, value) {\n    var current = !!(v.s & 2 /* Running */);\n    if (value !== current) {\n        v.s ^= 2 /* Running */;\n        var playbackRate = value ? (v._rate / Unit) : 0.0;\n        if (v.buffer) {\n            v.buffer.playbackRate.value = playbackRate;\n            if (value) {\n                // restart if play called in pause mode\n                _voiceStartBuffer(v);\n            }\n        }\n    }\n}\nexport function _voiceApplyPitch(v, value) {\n    if ((v.s & 2 /* Running */) !== 0) {\n        var playbackRate = value / Unit;\n        if (v.buffer) {\n            v.buffer.playbackRate.value = playbackRate;\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.h === handle) ? obj : null;\n}\nexport function createVoiceObj(ctx) {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.s === 0) {\n            return v.h;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var v = _voiceNew(ctx, index);\n        v.h = 805306368 /* Voice */ | index;\n        voicePool.push(v);\n        return v.h;\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","import { getAudioContextObject } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain) {\n        this.gain = gain;\n        this.h = 0;\n        this.s = 1 /* Active */ | 2 /* Running */;\n        this._gain = Unit;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nexport var busLine = [];\nexport function createBusObj(ctx) {\n    var next = busLine.length;\n    var obj = new BusObj(ctx.createGain());\n    obj.h = next | 268435456 /* Bus */;\n    busLine.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = createBusObj(ctx).gain;\n    master.connect(ctx.destination);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busLine.length; ++i) {\n        busLine[i].gain.disconnect();\n    }\n    busLine.length = 0;\n}\nexport function _getBus(bus) {\n    var obj = busLine[bus & iMask];\n    return (obj && obj.h === bus) ? obj : null;\n}\nexport function _getBusGain(handle) {\n    var obj = _getBus(handle);\n    return obj ? obj.gain : undefined;\n}\nexport function _setBusConnected(bus, connected) {\n    var flag = !!(bus.s & 2 /* Running */);\n    if (flag !== connected) {\n        var master = busLine[0];\n        var dest = bus === master ? getAudioContextObject().destination : master.gain;\n        if (connected) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.s ^= 2 /* Running */;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { iMask } from \"../protocol/interface\";\nimport { error, log, measure } from \"./debug\";\nimport { nextHandle } from \"./common\";\nvar BufferObj = /** @class */ (function () {\n    function BufferObj(h, s, b) {\n        this.h = h;\n        this.s = s;\n        this.b = b;\n    }\n    return BufferObj;\n}());\nexport { BufferObj };\nexport var buffers = [null];\nvar buffersMaxCount = 128;\nexport function getNextBufferObj() {\n    for (var i = 1; i < buffers.length; ++i) {\n        var buffer = buffers[i];\n        if (buffer.s === 0) {\n            return buffer.h;\n        }\n    }\n    var next = buffers.length;\n    if (next < buffersMaxCount) {\n        var b = new BufferObj(next | 536870912 /* Buffer */, 0, null);\n        buffers.push(b);\n        return b.h;\n    }\n    return 0;\n}\nexport function _bufferDestroy(obj) {\n    // TODO:\n    // if ((obj.s & Flag.Stream) !== 0 && obj.data) {\n    //     URL.revokeObjectURL(obj.b as string);\n    // }\n    obj.h = nextHandle(obj.h);\n    obj.s = 0;\n    obj.b = null;\n}\nexport function _getBufferObj(buffer) {\n    var obj = buffers[buffer & iMask];\n    if (obj && obj.h === buffer) {\n        return obj;\n    }\n    return null;\n}\nfunction _fetchURL(filepath, cb) {\n    return fetch(new Request(filepath)).then(cb);\n}\nexport function _bufferMemory(obj, ctx, data, flags) {\n    obj.s |= 1 /* Active */;\n    var buffer = data.buffer.slice(data.byteOffset, data.byteOffset + data.byteLength);\n    // TODO:\n    // if (flags & Flag.Stream) {\n    //     obj.s |= Flag.Stream;\n    ctx.decodeAudioData(buffer).then(function (audioBuffer) {\n        obj.s |= 2 /* Loaded */;\n        obj.b = audioBuffer;\n    }).catch(function (reason) {\n        error(\"Error decode audio buffer\", reason);\n    });\n}\nexport function _bufferLoad(obj, ctx, filepath, flags) {\n    obj.s |= 1 /* Active */;\n    // TODO:\n    //if (flags & Flag.Stream) {\n    //obj.s |= Flag.Stream;\n    var timeDecoding = 0;\n    _fetchURL(filepath, function (response) { return response.arrayBuffer(); }).then(function (buffer) {\n        timeDecoding = measure(0);\n        return ctx.decodeAudioData(buffer);\n    }).then(function (buffer) {\n        obj.b = buffer;\n        if (buffer) {\n            log(\"decoding time: \" + (measure(timeDecoding) | 0) + \" ms.\");\n            obj.s |= 2 /* Loaded */;\n        }\n    }).catch(function (reason) {\n        error(\"Error decoding audio buffer\", reason);\n    });\n}\n//# sourceMappingURL=Buffer.js.map","import { _setAudioParam, audioContextPause, audioContextResume, closeContext, getAudioContextObject, getContext, getContextState, initContext } from \"./Mixer\";\nimport { _getVoiceObj, _voiceApplyPitch, _voiceChangeDestination, _voicePrepareBuffer, _voiceSetLoop, _voiceSetRunning, _voiceStartBuffer, _voiceStop, createVoiceObj, voicePool } from \"./Voice\";\nimport { _getBus, _getBusGain, _setBusConnected, busLine, initBusPool, termBusPool } from \"./Bus\";\nimport { setError, warn } from \"./debug\";\nimport { DefaultBus, iMask, Mixer, tMask, Unit } from \"../protocol/interface\";\nimport { _bufferDestroy, _bufferLoad, _bufferMemory, _getBufferObj, buffers, getNextBufferObj } from \"./Buffer\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        buffers.length = 1;\n        closeContext(ctx);\n    }\n}\nexport function load(filepath, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var ctx = getAudioContextObject();\n        if (!ctx) {\n            setError(22 /* NotInitialized */);\n            return 0;\n        }\n        var obj = buffers[handle & iMask];\n        _bufferLoad(obj, ctx, filepath, flags);\n    }\n    return handle;\n}\nexport function loadMemory(data, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var ctx = getAudioContextObject();\n        if (!ctx) {\n            setError(22 /* NotInitialized */);\n            return 0;\n        }\n        var obj = buffers[handle & iMask];\n        _bufferMemory(obj, ctx, data, flags);\n    }\n    return handle;\n}\nexport function unload(name) {\n    var obj = _getBufferObj(name);\n    if (obj) {\n        stop(name);\n        _bufferDestroy(obj);\n    }\n}\n/***\n *\n * @param buffer\n * @param gain\n * @param pan\n * @param rate\n * @param flags\n * @param bus\n */\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    // arguments check debug\n    if (flags & ~(2 /* Running */ | 4 /* Loop */)) {\n        setError(20 /* InvalidArguments */);\n        return 0;\n    }\n    ///\n    var ctx = getAudioContextObject();\n    if (!ctx || ctx.state !== \"running\") {\n        setError(21 /* InvalidMixerState */, ctx === null || ctx === void 0 ? void 0 : ctx.state);\n        return 0;\n    }\n    var bufferObj = _getBufferObj(buffer);\n    if (!bufferObj) {\n        setError(15 /* BufferNotFound */);\n        return 0;\n    }\n    if (!(bufferObj.s & 2 /* Loaded */)) {\n        setError(16 /* BufferIsNotLoaded */);\n        return 0;\n    }\n    if (!bufferObj.b) {\n        setError(17 /* BufferNoData */);\n        return 0;\n    }\n    var targetNode = _getBusGain(bus ? bus : DefaultBus);\n    if (!targetNode) {\n        setError(19 /* BusNotFound */);\n        return 0;\n    }\n    var voice = createVoiceObj(ctx);\n    if (voice === 0) {\n        setError(12 /* Warning_NoFreeVoices */);\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    voiceObj.s = 1 /* Active */ | flags;\n    voiceObj.data = buffer;\n    voiceObj._gain = gain;\n    voiceObj._pan = pan;\n    voiceObj._rate = rate;\n    voiceObj.gain.gain.value = gain / Unit;\n    voiceObj.pan.pan.value = pan / Unit - 1;\n    // TODO: streamed decoding\n    //if (bufferObj.s & Flag.Stream) {\n    _voicePrepareBuffer(voiceObj, ctx, bufferObj.b);\n    if (flags & 2 /* Running */) {\n        _voiceStartBuffer(voiceObj);\n    }\n    // maybe we need to set target before `startBuffer()`\n    _voiceChangeDestination(voiceObj, targetNode);\n    _voiceApplyPitch(voiceObj, rate);\n    return voice;\n}\nexport function stop(name) {\n    if (name === 0) {\n        return;\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            _voiceStop(obj);\n        }\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            for (var i = 1; i < voicePool.length; ++i) {\n                var v = voicePool[i];\n                if (v.data === name) {\n                    _voiceStop(v);\n                }\n            }\n        }\n        else {\n            setError(15 /* BufferNotFound */);\n        }\n    }\n}\nexport function set(name, param, value) {\n    if (name === 0) {\n        return;\n    }\n    if (name === Mixer && (param & 128 /* Flags */) && (param & 2 /* Running */)) {\n        var ctx = getContext();\n        if (ctx) {\n            if (value && ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n            }\n            else if (!value && ctx.state === \"running\") {\n                audioContextPause(ctx);\n            }\n        }\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                var enabled = value !== 0;\n                if (param & 2 /* Running */) {\n                    _voiceSetRunning(obj, enabled);\n                }\n                else if (param & 4 /* Loop */) {\n                    _voiceSetLoop(obj, enabled);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            obj._gain = value;\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    case 2 /* Pan */:\n                        if (obj._pan !== value) {\n                            obj._pan = value;\n                            _setAudioParam(obj.pan.pan, value / Unit - 1);\n                        }\n                        break;\n                    case 3 /* Rate */:\n                        if (obj._rate !== value) {\n                            obj._rate = value;\n                            _voiceApplyPitch(obj, value);\n                        }\n                        break;\n                    case 4 /* CurrentTime */:\n                        // TODO:\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                if (param & 2 /* Running */) {\n                    _setBusConnected(obj, !!value);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n}\nexport function get(name, param) {\n    if (name === Mixer) {\n        var ctx = getAudioContextObject();\n        if (ctx) {\n            if (param === 0 /* State */) {\n                return getContextState(ctx);\n            }\n            else if (param === 5 /* SampleRate */) {\n                return ctx.sampleRate | 0;\n            }\n        }\n        return 0;\n    }\n    var type = name & tMask;\n    if ((param & 256 /* Count */) && !(name & iMask)) {\n        var stateMask = param & 127 /* StateMask */;\n        if (type === 805306368 /* Voice */) {\n            return _countObjectsWithFlags(voicePool, stateMask);\n        }\n        else if (type === 268435456 /* Bus */) {\n            return _countObjectsWithFlags(busLine, stateMask);\n        }\n        else if (type === 536870912 /* Buffer */) {\n            return _countObjectsWithFlags(buffers, stateMask);\n        }\n        return 0;\n    }\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                case 2 /* Pan */:\n                    return obj._pan;\n                case 3 /* Rate */:\n                    return obj._rate;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        d = obj.buffer.buffer.duration * Unit;\n                    }\n                    return (d * Unit) | 0;\n                }\n                case 4 /* CurrentTime */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        // TODO: :(\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(1 /* NotSupported */);\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                default:\n                    warn(1 /* NotSupported */);\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.b) {\n                        d = obj.b.duration;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(1 /* NotSupported */);\n                    break;\n            }\n        }\n        return 0;\n    }\n    return 0;\n}\n/** private helpers **/\nfunction _countObjectsWithFlags(arr, mask) {\n    var cnt = 0;\n    for (var i = 1; i < arr.length; ++i) {\n        var obj = arr[i];\n        if (obj && (obj.s & mask) === mask) {\n            ++cnt;\n        }\n    }\n    return cnt;\n}\n//# sourceMappingURL=index.js.map","import { Mixer, Unit } from \"./protocol/interface\";\nimport * as Null from \"./null/index\";\nimport * as Browser from \"./webaudio/index\";\nfunction haveWebAudio() {\n    return typeof window !== \"undefined\" && !!(window.AudioContext || window.webkitAudioContext);\n}\nfunction loadDriver() {\n    if (typeof process !== \"undefined\") {\n        return require(\"bindings\")(\"auph\");\n    }\n    if (haveWebAudio()) {\n        return Browser;\n    }\n    return Null;\n}\nvar _ = loadDriver();\nexport * from \"./protocol/static\";\nexport var init = _.init;\nexport var shutdown = _.shutdown;\nexport var set = _.set;\nexport var get = _.get;\nexport var load = _.load;\nexport var loadMemory = _.loadMemory;\nexport var unload = _.unload;\nexport var stop = _.stop;\nexport function pause(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, true);\n}\nexport function resume(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, false);\n}\nexport function play(buffer, gain, pan, rate, loop, paused, bus) {\n    if (gain === void 0) { gain = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (rate === void 0) { rate = 1.0; }\n    var flags = 0;\n    if (!!loop)\n        flags |= 4 /* Loop */;\n    if (!paused)\n        flags |= 2 /* Running */;\n    return _.voice(buffer, f2u(gain), f2u(+pan + 1), f2u(rate), flags, 0 | bus);\n}\nexport function getMixerStateString(state) {\n    return [\"closed\", \"paused\", \"\", \"running\"][state & 3];\n}\nexport function getBufferStateString(state) {\n    return [\"free\", \"loading\", \"\", \"loaded\"][state & 0x3] + [\"\", \" streaming\"][(state >>> 2) & 0x1];\n}\nexport function setGain(busOrVoice, value) {\n    set(busOrVoice, 1 /* Gain */, f2u(value));\n}\nexport function getGain(busOrVoice) {\n    return get(busOrVoice, 1 /* Gain */) / Unit;\n}\nexport function setPan(voice, pan) {\n    set(voice, 2 /* Pan */, f2u(+pan + 1));\n}\nexport function setRate(voice, rate) {\n    set(voice, 3 /* Rate */, f2u(rate));\n}\nexport function setPause(name, value) {\n    set(name, 128 /* Flags */ | 2 /* Running */, 0 | !value);\n}\nexport function setLoop(voice, value) {\n    set(voice, 128 /* Flags */ | 4 /* Loop */, 0 | value);\n}\nexport function getPan(voice) {\n    return get(voice, 2 /* Pan */) / Unit - 1;\n}\nexport function getRate(voice) {\n    return get(voice, 3 /* Rate */) / Unit;\n}\nexport function getPause(voice) {\n    return !(get(voice, 0 /* State */) & 2 /* Running */);\n}\nexport function getLoop(voice) {\n    return !!(get(voice, 0 /* State */) & 4 /* Loop */);\n}\nexport function getCurrentTime(voice) {\n    return get(voice, 4 /* CurrentTime */) / Unit;\n}\nexport function isActive(name) {\n    return !!(get(name, 0 /* State */) & 1 /* Active */);\n}\nexport function isBufferLoaded(name) {\n    var mask = 1 /* Active */ | 2 /* Loaded */;\n    return (get(name, 0 /* State */) & mask) === mask;\n}\nexport function getDuration(name) {\n    return get(name, 6 /* Duration */) / Unit;\n}\nfunction f2u(x) {\n    return (x * Unit) | 0;\n}\n//# sourceMappingURL=index.js.map","import { Mixer } from \"./interface\";\n/** Export Constants only for pre-bundled usage **/\nexport var SAMPLE_RATE = 5 /* SampleRate */;\nexport var STATE = 0 /* State */;\nexport var COUNT = 256 /* Count */;\nexport var ACTIVE = 1 /* Active */;\nexport var RUNNING = 2 /* Running */;\nexport var STREAM = 4 /* Stream */;\nexport var LOOP = 4 /* Loop */;\nexport var MIXER = Mixer;\nexport var BUS = 268435456 /* Bus */;\nexport var VOICE = 805306368 /* Voice */;\nexport var BUFFER = 536870912 /* Buffer */;\nexport var BUS_MASTER = 268435456 /* Bus */ | 0;\nexport var BUS_SFX = 268435456 /* Bus */ | 1;\nexport var BUS_MUSIC = 268435456 /* Bus */ | 2;\nexport var BUS_SPEECH = 268435456 /* Bus */ | 3;\n//# sourceMappingURL=static.js.map"],"names":["tMask","iMask","Unit","filepath","flags","data","name","buffer","gain","pan","rate","bus","param","value","TAG","warn","message","console","error","reason","ctx","emptyAudioBuffer","getContext","state","getAudioContextObject","audioContextResume","resume","then","catch","initContext","options","scope","window","AudioContext","webkitAudioContext","_a","newAudioContext","latencyHint","sampleRate","createBuffer","unlocked","events","num","length","doc","document","handle","i","removeEventListener","addEventListener","unlock","closeContext","context","close","_setAudioParam","nextHandle","h","VoiceObj","index","_this","this","s","_gain","_pan","_rate","_started","out","_e","_voiceStop","v","stop","onended","disconnect","_voiceResetDestination","_voiceStartBuffer","source","loop","start","_voiceApplyPitch","playbackRate","voicePool","_getVoiceObj","obj","createVoiceObj","createGain","createStereoPanner","connect","_voiceNew","push","BusObj","busLine","createBusObj","next","_getBus","BufferObj","b","buffers","getNextBufferObj","_getBufferObj","_bufferLoad","cb","fetch","Request","_fetchURL","response","arrayBuffer","decodeAudioData","type","_countObjectsWithFlags","arr","mask","cnt","master","destination","initBusPool","termBusPool","slice","byteOffset","byteLength","audioBuffer","_bufferMemory","_bufferDestroy","bufferObj","targetNode","undefined","voice","voiceObj","createBufferSource","_voicePrepareBuffer","target","_voiceChangeDestination","suspend","audioContextPause","enabled","_voiceSetRunning","_voiceSetLoop","connected","dest","_setBusConnected","getContextState","stateMask","d","duration","_","process","require","Browser","Null","init","shutdown","set","get","load","loadMemory","unload","setPause","f2u","x","busOrVoice","paused"],"mappings":"kCAGO,IAAIA,EAAQ,UAGRC,EAAQ,IAGRC,EAAO,8CCTX,sBAEA,kBAEA,SAAcC,EAAUC,GAC3B,OAAO,cAEJ,SAAoBC,EAAMD,GAC7B,OAAO,UAEJ,SAAgBE,WAEhB,SAAeC,EAAQC,EAAMC,EAAKC,EAAMN,EAAOO,GAClD,OAAO,QAEJ,SAAcL,SAEd,SAAaA,EAAMM,EAAOC,SAE1B,SAAaP,EAAMM,GACtB,OAAO,KCpBPE,EAAM,SAOH,SAASC,EAAKC,GACjBC,QAAQF,KAAKD,EAAKE,GAEf,SAASE,EAAMF,EAASG,GAC3BF,QAAQC,MAAMJ,EAAKE,EAASG,GCThC,IAAIC,EAAM,KACCC,EAAmB,KAEvB,SAASC,IACZ,OAAKF,GAAqB,WAAdA,EAAIG,MAITH,GAHHL,EAAK,GACE,MAIR,SAASS,IACZ,OAAOJ,EAYJ,SAASK,EAAmBL,GAE/BA,EAAIM,SAASC,MAAK,eAEfC,OAAM,SAAUT,GACfD,EAAM,EAA2BC,MAsBlC,SAASU,IACZ,OAAIT,GACAL,EAAK,IACEK,KAEXA,EAhBJ,SAAyBU,GACrB,IACI,IAAIC,EAAQC,OAEZ,OAAO,IADYD,EAAME,cAAgBF,EAAMG,oBACvBJ,GAE5B,MAAOK,GACHjB,EAAM,GAEV,OAAO,KAODkB,CAAgB,CAClBC,YAAa,cACbC,WAvDgB,WA0DXjB,IACDA,EAAmBD,EAAImB,aAAa,EAAG,EA3D3B,QCJjB,SAAgBC,GAYnB,IAVA,IAAIC,EAAS,CAAC,aAAc,WAAY,YAAa,QAAS,WAC1DC,EAAMD,EAAOE,OACbC,EAAMC,SACNC,EAAS,WACT,GAAIN,IACA,IAAK,IAAIO,EAAI,EAAGA,EAAIL,IAAOK,EACvBH,EAAII,oBAAoBP,EAAOM,GAAID,GAAQ,IAI9CC,EAAI,EAAGA,EAAIL,IAAOK,EACvBH,EAAIK,iBAAiBR,EAAOM,GAAID,GAAQ,GDoDxCI,EAAO,WACH,MAAkB,cAAd9B,EAAIG,QACJE,EAAmBL,IACZ,OAKZA,GAEJ,SAAS+B,EAAaC,GAEzBA,EAAQC,QAAQ1B,MAAK,eAElBC,OAAM,SAAUT,GACfD,EAAM,GAA2BC,MAErCC,EAAM,KAEH,SAASkC,EAAe1C,EAAOC,GAC9BD,EAAMC,QAAUA,IAChBD,EAAMC,MAAQA,GErFf,SAAS0C,EAAWC,GACvB,OAASA,ELGM,IADA,mBKFiBA,ECCpC,IAAIC,EACA,SAAkBjD,EAAMC,EAAKiD,GACzB,IAAIC,EAAQC,KACZA,KAAKpD,KAAOA,EACZoD,KAAKnD,IAAMA,EAEXmD,KAAKJ,EAAI,EAETI,KAAKC,EAAI,EACTD,KAAKE,MAAQ5D,EACb0D,KAAKG,KAAO7D,EACZ0D,KAAKI,MAAQ9D,EACb0D,KAAKvD,KAAO,EACZuD,KAAKjD,IAAM,EAEXiD,KAAKK,UAAW,EAChBL,KAAKrD,OAAS,KAEdqD,KAAKM,IAAM,KACXN,KAAKO,GAAK,WAGNC,EAAWT,IAGfC,KAAKJ,EAAI,UAAwBE,GA6BlC,SAASU,EAAWC,GAEvB,IAAI9D,EAAS8D,EAAE9D,OACf,GAAIA,EAAQ,CACwB,IAArB,EAAN8D,EAAER,IACHtD,EAAO+D,OAEX/D,EAAOgE,QAAU,KACjBhE,EAAOiE,aACP,IACIjE,EAAOA,OAASc,EAEpB,MAAOc,IAEPkC,EAAE9D,OAAS,MApBZ,SAAgC8D,GAC/BA,EAAEH,MACFG,EAAE7D,KAAKgE,WAAWH,EAAEH,KACpBG,EAAEH,IAAM,MAmBZO,CAAuBJ,GACvBA,EAAEhE,KAAO,EACTgE,EAAE1D,IAAM,EACR0D,EAAER,EAAI,EACNQ,EAAEb,EAAID,EAAWc,EAAEb,GAEhB,SAASkB,EAAkBL,GAC9B,IAAIM,EAASN,EAAE9D,OACXoE,IAAWN,EAAEJ,WAEbU,EAAOJ,QAAUF,EAAEF,GACnBQ,EAAOC,KAAgC,IAAlB,EAANP,EAAER,GACjBc,EAAOE,QACPR,EAAEJ,UAAW,GAiCd,SAASa,EAAiBT,EAAGxD,GAChC,GAAgC,IAArB,EAANwD,EAAER,GAA4B,CAC/B,IAAIkB,EAAelE,EAAQX,EACvBmE,EAAE9D,SACF8D,EAAE9D,OAAOwE,aAAalE,MAAQkE,IAInC,IAAIC,EAAY,CAAC,MAEjB,SAASC,EAAanC,GACzB,IAAIoC,EAAMF,EAAUlC,EAAS7C,GAC7B,OAAQiF,GAAOA,EAAI1B,IAAMV,EAAUoC,EAAM,KAEtC,SAASC,EAAe/D,GAC3B,IAAK,IAAI2B,EAAI,EAAGA,EAAIiC,EAAUrC,SAAUI,EAAG,CAEvC,GAAY,KADRsB,EAAIW,EAAUjC,IACZc,EACF,OAAOQ,EAAEb,EAGjB,IAEQa,EAFJX,EAAQsB,EAAUrC,OACtB,OAAIe,EAba,KAcTW,EA7GL,SAAmBjD,EAAKsC,GAC3B,IAAIlD,EAAOY,EAAIgE,aACX3E,EAAMW,EAAIiE,qBAEd,OADA5E,EAAI6E,QAAQ9E,GACL,IAAIiD,EAASjD,EAAMC,EAAKiD,GAyGnB6B,CAAUnE,EAAKsC,IACrBF,EAAI,UAAwBE,EAC9BsB,EAAUQ,KAAKnB,GACRA,EAAEb,GAEN,ECjJX,IAAIiC,EACA,SAAgBjF,GACZoD,KAAKpD,KAAOA,EACZoD,KAAKJ,EAAI,EACTI,KAAKC,EAAI,EACTD,KAAKE,MAAQ5D,GAKVwF,EAAU,GACd,SAASC,EAAavE,GACzB,IAAIwE,EAAOF,EAAQ/C,OACfuC,EAAM,IAAIO,EAAOrE,EAAIgE,cAGzB,OAFAF,EAAI1B,EAAW,UAAPoC,EACRF,EAAQF,KAAKN,GACNA,EAeJ,SAASW,EAAQlF,GACpB,IAAIuE,EAAMQ,EAAQ/E,EAAMV,GACxB,OAAQiF,GAAOA,EAAI1B,IAAM7C,EAAOuE,EAAM,KChC1C,IAAIY,EACA,SAAmBtC,EAAGK,EAAGkC,GACrBnC,KAAKJ,EAAIA,EACTI,KAAKC,EAAIA,EACTD,KAAKmC,EAAIA,GAKNC,EAAU,CAAC,MAEf,SAASC,IACZ,IAAK,IAAIlD,EAAI,EAAGA,EAAIiD,EAAQrD,SAAUI,EAAG,CACrC,IAAIxC,EAASyF,EAAQjD,GACrB,GAAiB,IAAbxC,EAAOsD,EACP,OAAOtD,EAAOiD,EAGtB,IAAIoC,EAAOI,EAAQrD,OACnB,GAAIiD,EATc,IASU,CACxB,IAAIG,EAAI,IAAID,EAAiB,UAAPF,EAA+B,EAAG,MAExD,OADAI,EAAQR,KAAKO,GACNA,EAAEvC,EAEb,OAAO,EAWJ,SAAS0C,EAAc3F,GAC1B,IAAI2E,EAAMc,EAAQzF,EAASN,GAC3B,OAAIiF,GAAOA,EAAI1B,IAAMjD,EACV2E,EAEJ,KAkBJ,SAASiB,EAAYjB,EAAK9D,EAAKjB,EAAUC,GAC5C8E,EAAIrB,GAAK,EAjBb,SAAmB1D,EAAUiG,GACzB,OAAOC,MAAM,IAAIC,QAAQnG,IAAWwB,KAAKyE,GAqBzCG,CAAUpG,GAAU,SAAUqG,GAAY,OAAOA,EAASC,iBAAkB9E,MAAK,SAAUpB,GAEvF,OAAOa,EAAIsF,gBAAgBnG,MAC5BoB,MAAK,SAAUpB,GACd2E,EAAIa,EAAIxF,EACJA,IAEA2E,EAAIrB,GAAK,MAEdjC,OAAM,SAAUT,GACfD,EAAM,8BAA+BC,MCwCtC,SAASmD,EAAKhE,GACjB,GAAa,IAATA,EAAJ,CAGA,IAAIqG,EAAOrG,EAAON,EAClB,GAAa,YAAT2G,GACIzB,EAAMD,EAAa3E,KAEnB8D,EAAWc,QAGd,GAAa,YAATyB,EAAiC,CACtC,IAAIzB,EACJ,GADIA,EAAMgB,EAAc5F,GAEpB,IAAK,IAAIyC,EAAI,EAAGA,EAAIiC,EAAUrC,SAAUI,EAAG,CACvC,IAAIsB,EAAIW,EAAUjC,GACdsB,EAAEhE,OAASC,GACX8D,EAAWC,MA0L/B,SAASuC,EAAuBC,EAAKC,GAEjC,IADA,IAAIC,EAAM,EACDhE,EAAI,EAAGA,EAAI8D,EAAIlE,SAAUI,EAAG,CACjC,IAAImC,EAAM2B,EAAI9D,GACVmC,IAAQA,EAAIrB,EAAIiD,KAAUA,KACxBC,EAGV,OAAOA,2CAlUJ,WACH,IAAI3F,EAAMS,IACNT,GFYD,SAAqBA,GACxB,IAAI4F,EAASrB,EAAavE,GAAKZ,KAC/BwG,EAAO1B,QAAQlE,EAAI6F,aACnBtB,EAAavE,GAAKZ,KAAK8E,QAAQ0B,GAC/BrB,EAAavE,GAAKZ,KAAK8E,QAAQ0B,GAC/BrB,EAAavE,GAAKZ,KAAK8E,QAAQ0B,GEhB3BE,CAAY9F,aAGb,WACH,IAAIA,EAAME,IACNF,KFaD,WACH,IAAK,IAAI2B,EAAI,EAAGA,EAAI2C,EAAQ/C,SAAUI,EAClC2C,EAAQ3C,GAAGvC,KAAKgE,aAEpBkB,EAAQ/C,OAAS,EEhBbwE,GACAnC,EAAUrC,OAAS,EACnBqD,EAAQrD,OAAS,EACjBQ,EAAa/B,UAGd,SAAcjB,EAAUC,GAC3B,IAAI0C,EAASmD,IACb,GAAInD,EAAQ,CACR,IAAI1B,EAAMI,IACV,IAAKJ,EAED,OAAO,EAGX+E,EADUH,EAAQlD,EAAS7C,GACVmB,EAAKjB,GAE1B,OAAO2C,cAEJ,SAAoBzC,EAAMD,GAC7B,IAAI0C,EAASmD,IACb,GAAInD,EAAQ,CACR,IAAI1B,EAAMI,IACV,IAAKJ,EAED,OAAO,GDQZ,SAAuB8D,EAAK9D,EAAKf,EAAMD,GAC1C8E,EAAIrB,GAAK,EACT,IAAItD,EAASF,EAAKE,OAAO6G,MAAM/G,EAAKgH,WAAYhH,EAAKgH,WAAahH,EAAKiH,YAIvElG,EAAIsF,gBAAgBnG,GAAQoB,MAAK,SAAU4F,GACvCrC,EAAIrB,GAAK,EACTqB,EAAIa,EAAIwB,KACT3F,OAAM,SAAUT,GACfD,EAAM,4BAA6BC,MCfnCqG,CADUxB,EAAQlD,EAAS7C,GACRmB,EAAKf,GAE5B,OAAOyC,UAEJ,SAAgBxC,GACnB,IAAI4E,EAAMgB,EAAc5F,GACpB4E,IACAZ,EAAKhE,GDrBN,SAAwB4E,GAK3BA,EAAI1B,EAAID,EAAW2B,EAAI1B,GACvB0B,EAAIrB,EAAI,EACRqB,EAAIa,EAAI,KCeJ0B,CAAevC,WAYhB,SAAe3E,EAAQC,EAAMC,EAAKC,EAAMN,EAAOO,GAElD,IAAY,EAARP,EAEA,OAAO,EAGX,IAAIgB,EAAMI,IACV,IAAKJ,GAAqB,YAAdA,EAAIG,MAEZ,OADqCH,MAAAA,GAA0CA,EAAIG,MAC5E,EAEX,IAAImG,EAAYxB,EAAc3F,GAC9B,IAAKmH,EAED,OAAO,EAEX,KAAoB,EAAdA,EAAU7D,GAEZ,OAAO,EAEX,IAAK6D,EAAU3B,EAEX,OAAO,EAEX,IFlDIb,EEkDAyC,GFlDAzC,EAAMW,EEkDmBlF,GT9ET,YO6BPuE,EAAI1E,UAAOoH,EEkDxB,IAAKD,EAED,OAAO,EAEX,IAAIE,EAAQ1C,EAAe/D,GAC3B,GAAc,IAAVyG,EAEA,OAAO,EAEX,IAAIC,EAAW7C,EAAa4C,GAiB5B,OAhBAC,EAASjE,EAAI,EAAiBzD,EAC9B0H,EAASzH,KAAOE,EAChBuH,EAAShE,MAAQtD,EACjBsH,EAAS/D,KAAOtD,EAChBqH,EAAS9D,MAAQtD,EACjBoH,EAAStH,KAAKA,KAAKK,MAAQL,EAAON,EAClC4H,EAASrH,IAAIA,IAAII,MAAQJ,EAAMP,EAAO,EHhBnC,SAA6BmE,EAAGjD,EAAKmG,GACxC,IAAI5C,EAASvD,EAAI2G,qBACjBpD,EAAOpE,OAASgH,EAChB5C,EAAOW,QAAQjB,EAAE5D,KACjB4D,EAAE9D,OAASoE,EACXN,EAAEJ,UAAW,EGcb+D,CAAoBF,EAAU1G,EAAKsG,EAAU3B,GACjC,EAAR3F,GACAsE,EAAkBoD,GHvEnB,SAAiCzD,EAAG4D,GACvC,GAAIA,IAAW5D,EAAEH,IAAK,CAClB,IAAI1D,EAAO6D,EAAE7D,KACT6D,EAAEH,KACF1D,EAAKgE,WAAWH,EAAEH,KAEtBG,EAAEH,IAAM+D,EACJA,GACAzH,EAAK8E,QAAQ2C,IGkErBC,CAAwBJ,EAAUH,GAClC7C,EAAiBgD,EAAUpH,GACpBmH,cA4BJ,SAAavH,EAAMM,EAAOC,GAC7B,GAAa,IAATP,EAAJ,CAGA,GT5Ie,IS4IXA,GAA2B,IAARM,GAAqC,EAARA,EAA0B,CAC1E,IAAIQ,EAAME,IACNF,IACIP,GAAuB,cAAdO,EAAIG,MACbE,EAAmBL,GAEbP,GAAuB,YAAdO,EAAIG,ONxH5B,SAA2BH,GAE9BA,EAAI+G,UAAUxG,MAAK,eAEhBC,OAAM,SAAUT,GACfD,EAAM,EAA0BC,MMoHxBiH,CAAkBhH,IAI9B,IAAIuF,EAAOrG,EAAON,EAClB,GAAa,YAAT2G,GAEA,GADIzB,EAAMD,EAAa3E,GAEnB,GAAY,IAARM,EAAyB,CACzB,IAAIyH,EAAoB,IAAVxH,EACF,EAARD,EH3Db,SAA0ByD,EAAGxD,GAEhC,GAAIA,OADmB,EAANwD,EAAER,GACI,CACnBQ,EAAER,GAAK,EACP,IAAIkB,EAAelE,EAASwD,EAAEL,MAAQ9D,EAAQ,EAC1CmE,EAAE9D,SACF8D,EAAE9D,OAAOwE,aAAalE,MAAQkE,EAC1BlE,GAEA6D,EAAkBL,KGmDdiE,CAAiBpD,EAAKmD,GAET,EAARzH,GHvElB,SAAuByD,EAAGxD,GAEzBA,KADmC,IAAlB,EAANwD,EAAER,MAEbQ,EAAER,GAAK,EACHQ,EAAE9D,SACF8D,EAAE9D,OAAOqE,KAAO/D,IGmER0H,CAAcrD,EAAKmD,QAIvB,OAAQzH,GACJ,KAAK,EACGsE,EAAIpB,QAAUjD,IACdqE,EAAIpB,MAAQjD,EACZyC,EAAe4B,EAAI1E,KAAKA,KAAMK,EAAQX,IAE1C,MACJ,KAAK,EACGgF,EAAInB,OAASlD,IACbqE,EAAInB,KAAOlD,EACXyC,EAAe4B,EAAIzE,IAAIA,IAAKI,EAAQX,EAAO,IAE/C,MACJ,KAAK,EACGgF,EAAIlB,QAAUnD,IACdqE,EAAIlB,MAAQnD,EACZiE,EAAiBI,EAAKrE,UAYzC,GAAa,YAAT8F,EAA8B,CACnC,IAAIzB,EACJ,GADIA,EAAMW,EAAQvF,GAEd,GAAY,IAARM,EACY,EAARA,GFnKb,SAA0BD,EAAK6H,GAElC,MADsB,EAAR7H,EAAIkD,KACL2E,EAAW,CACpB,IAAIxB,EAAStB,EAAQ,GACjB+C,EAAO9H,IAAQqG,EAASxF,IAAwByF,YAAcD,EAAOxG,KACrEgI,EACA7H,EAAIH,KAAK8E,QAAQmD,GAGjB9H,EAAIH,KAAKgE,WAAWiE,GAExB9H,EAAIkD,GAAK,GEyJG6E,CAAiBxD,IAAOrE,QAI5B,OAAQD,GACJ,KAAK,EACGsE,EAAIpB,QAAUjD,GACdyC,EAAe4B,EAAI1E,KAAKA,KAAMK,EAAQX,WAU3D,SAAaI,EAAMM,GACtB,GTxNe,ISwNXN,EAAgB,CAChB,IAAIc,EAAMI,IACV,GAAIJ,EAAK,CACL,GAAc,IAAVR,EACA,ONpNT,SAAyBQ,GAC5B,IAAIG,EAAQ,EAOZ,MANkB,WAAdH,EAAIG,QACJA,GAAS,EACS,YAAdH,EAAIG,QACJA,GAAS,IAGVA,EM4MYoH,CAAgBvH,GAEtB,GAAc,IAAVR,EACL,OAAwB,EAAjBQ,EAAIkB,WAGnB,OAAO,EAEX,IAAIqE,EAAOrG,EAAON,EAClB,GAAa,IAARY,KAA8BN,EAAOL,GAAQ,CAC9C,IAAI2I,EAAoB,IAARhI,EAChB,OAAa,YAAT+F,EACOC,EAAuB5B,EAAW4D,GAE3B,YAATjC,EACEC,EAAuBlB,EAASkD,GAEzB,YAATjC,EACEC,EAAuBZ,EAAS4C,GAEpC,EAEX,GAAa,YAATjC,EAAgC,CAEhC,GADIzB,EAAMD,EAAa3E,GAEnB,OAAQM,GACJ,KAAK,EACD,OAAOsE,EAAIrB,EACf,KAAK,EACD,OAAOqB,EAAIpB,MACf,KAAK,EACD,OAAOoB,EAAInB,KACf,KAAK,EACD,OAAOmB,EAAIlB,MACf,KAAK,EACD,IAAI6E,EAAI,EAIR,OAHI3D,EAAI3E,QAAU2E,EAAI3E,OAAOA,SACzBsI,EAAI3D,EAAI3E,OAAOA,OAAOuI,SAAW5I,GAE7B2I,EAAI3I,EAAQ,EAExB,KAAK,EACG2I,EAAI,EAIR,OAHI3D,EAAI3E,QAAU2E,EAAI3E,OAAOA,OAGrBsI,EAAI3I,EAAQ,EAExB,QACIa,EAAK,GAIjB,OAAO,EAEN,GAAa,YAAT4F,EAA8B,CAEnC,GADIzB,EAAMW,EAAQvF,GAEd,OAAQM,GACJ,KAAK,EACD,OAAOsE,EAAIrB,EACf,KAAK,EACD,OAAOqB,EAAIpB,MACf,QACI/C,EAAK,GAIjB,OAAO,EAEN,GAAa,YAAT4F,EAAiC,CACtC,IAAIzB,EACJ,GADIA,EAAMgB,EAAc5F,GAEpB,OAAQM,GACJ,KAAK,EACD,OAAOsE,EAAIrB,EACf,KAAK,EACGgF,EAAI,EAIR,OAHI3D,EAAIa,IACJ8C,EAAI3D,EAAIa,EAAE+C,UAEND,EAAI3I,EAAQ,EAExB,QACIa,EAAK,GAIjB,OAAO,EAEX,OAAO,KC9SX,IAAIgI,EARuB,oBAAZC,QACAC,QAAQ,WAARA,CAAoB,QAJN,oBAAXjH,SAA6BA,OAAOC,cAAgBD,OAAOE,oBAO9DgH,EAEJC,EAIAC,EAAOL,EAAEK,KACTC,EAAWN,EAAEM,SACbC,EAAMP,EAAEO,IACRC,EAAMR,EAAEQ,IACRC,EAAOT,EAAES,KACTC,EAAaV,EAAEU,WACfC,EAASX,EAAEW,OACXpF,EAAOyE,EAAEzE,KAsCb,SAASqF,EAASrJ,EAAMO,GAC3ByI,EAAIhJ,EAAM,IAAmC,GAAKO,GA8BtD,SAAS+I,EAAIC,GACT,OAAQA,EAAI3J,EAAQ,kBCzFJ,WAOA,gBAFH,uBAGO,sBAED,oBADF,uBAEG,kBAZL,WAID,UXDC,YWDE,gBAJI,UACN,WAIC,UAID,yCDoCZ,SAA8BqB,GACjC,MAAO,CAAC,OAAQ,UAAW,GAAI,UAAkB,EAARA,GAAe,CAAC,GAAI,cAAeA,IAAU,EAAK,qBAgCxF,SAAwBsG,GAC3B,OAAO0B,EAAI1B,EAAO,GAAuB3H,iBAStC,SAAqBI,GACxB,OAAOiJ,EAAIjJ,EAAM,GAAoBJ,aAtClC,SAAiB4J,GACpB,OAAOP,EAAIO,EAAY,GAAgB5J,aAuBpC,SAAiB2H,GACpB,SAAsC,EAA5B0B,EAAI1B,EAAO,2BAlClB,SAA6BtG,GAChC,MAAO,CAAC,SAAU,SAAU,GAAI,WAAmB,EAARA,aAuBxC,SAAgBsG,GACnB,OAAO0B,EAAI1B,EAAO,GAAe3H,EAAO,cAKrC,SAAkB2H,GACrB,QAAqC,EAA5B0B,EAAI1B,EAAO,eAJjB,SAAiBA,GACpB,OAAO0B,EAAI1B,EAAO,GAAgB3H,uBAW/B,SAAkBI,GACrB,SAAqC,EAA3BiJ,EAAIjJ,EAAM,sBAEjB,SAAwBA,GAE3B,OADW,IAAA,EACHiJ,EAAIjJ,EAAM,qCA/Df,SAAeA,QACL,IAATA,IAAmBA,EVnBR,GUoBfqJ,EAASrJ,GAAM,WAMZ,SAAcC,EAAQC,EAAMC,EAAKC,EAAMkE,EAAMmF,EAAQpJ,QAC3C,IAATH,IAAmBA,EAAO,QAClB,IAARC,IAAkBA,EAAM,QACf,IAATC,IAAmBA,EAAO,GAC9B,IAAIN,EAAQ,EAKZ,OAJMwE,IACFxE,GAAS,GACR2J,IACD3J,GAAS,GACN2I,EAAElB,MAAMtH,EAAQqJ,EAAIpJ,GAAOoJ,GAAKnJ,EAAM,GAAImJ,EAAIlJ,GAAON,EAAO,EAAIO,aAbpE,SAAgBL,QACN,IAATA,IAAmBA,EVvBR,GUwBfqJ,EAASrJ,GAAM,sBAmBZ,SAAiBwJ,EAAYjJ,GAChCyI,EAAIQ,EAAY,EAAcF,EAAI/I,eAc/B,SAAiBgH,EAAOhH,GAC3ByI,EAAIzB,EAAO,IAAgC,EAAIhH,aAV5C,SAAgBgH,EAAOpH,GAC1B6I,EAAIzB,EAAO,EAAa+B,GAAKnJ,EAAM,4BAEhC,SAAiBoH,EAAOnH,GAC3B4I,EAAIzB,EAAO,EAAc+B,EAAIlJ"}