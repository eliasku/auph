{"version":3,"file":"auph.js","sources":["../module/protocol/interface.js","../module/webaudio/Mixer.js","../module/null/index.js","../module/webaudio/common.js","../module/webaudio/Unlock.js","../module/webaudio/Voice.js","../module/webaudio/Bus.js","../module/webaudio/Buffer.js","../module/webaudio/index.js","../module/index.js","../module/protocol/static.js"],"sourcesContent":["/**\n * Object Name Identifier Layout: [00tt 0000 | vvvv vvvv | vvvv vvvv | iiii iiii]\n */\nexport var tMask = 0x30000000;\nexport var vMask = 0x00FFFF00;\nexport var vIncr = 0x00000100;\nexport var iMask = 0x000000FF;\nexport var Mixer = 0x00000001;\n// used for integer to float params conversion\nexport var Unit = 1024;\nexport var DefaultBus = 1 /* Sound */ | 268435456 /* Bus */;\n//# sourceMappingURL=interface.js.map","import { error, log, warn } from \"./debug\";\nimport { unlock } from \"./Unlock\";\nvar ctx;\nexport var emptyAudioBuffer;\nvar defaultSampleRate = 22050;\nexport function getContext() {\n    if (ctx && ctx.state !== \"closed\") {\n        return ctx;\n    }\n    warn(2 /* InvalidState */);\n}\nexport function getAudioContextObject() {\n    return ctx;\n}\nexport function getContextState(ctx) {\n    var state = 0;\n    if (ctx.state !== \"closed\") {\n        state |= 1 /* Active */;\n        if (ctx.state === \"running\") {\n            state |= 2 /* Running */;\n        }\n    }\n    return state;\n}\nexport function audioContextResume(ctx) {\n    log(3 /* DeviceResuming */);\n    ctx.resume().then(function () {\n        log(4 /* DeviceResumed */);\n    }).catch(function (reason) {\n        error(5 /* DeviceResumeError */, reason);\n    });\n}\nexport function audioContextPause(ctx) {\n    log(6 /* DevicePausing */);\n    ctx.suspend().then(function () {\n        log(7 /* DevicePaused */);\n    }).catch(function (reason) {\n        error(8 /* DevicePauseError */, reason);\n    });\n}\nfunction newAudioContext(options) {\n    var scope = window;\n    var audioContext = scope.AudioContext || scope.webkitAudioContext;\n    // TODO: set sample rate could lead to wrong playback on safari mobile (maybe it should be recreated after unlock?)\n    //try {\n    //    return new audioContext(options);\n    //} catch (err) {\n    //    error(Message.WebAudio_TryDefaultOptions, err);\n    //}\n    try {\n        return new audioContext();\n    }\n    catch (err) {\n        error(1 /* NotSupported */, err);\n    }\n}\nexport function initContext() {\n    if (ctx) {\n        warn(14 /* Warning_AlreadyInitialized */);\n        return ctx;\n    }\n    ctx = newAudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: defaultSampleRate\n    });\n    if (ctx) {\n        emptyAudioBuffer = ctx.createBuffer(1, 1, defaultSampleRate);\n        unlock(function () {\n            if (ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n                return false;\n            }\n            return true;\n        });\n    }\n    return ctx;\n}\nexport function closeContext(context) {\n    log(9 /* DeviceClosing */);\n    context.close().then(function () {\n        log(10 /* DeviceClosed */);\n    }).catch(function (reason) {\n        error(11 /* DeviceCloseError */, reason);\n    });\n    ctx = undefined;\n}\n//# sourceMappingURL=Mixer.js.map","export function init() {\n}\nexport function shutdown() {\n}\nexport function load(filepath, flags) {\n    return 0;\n}\nexport function loadMemory(data, flags) {\n    return 0;\n}\nexport function unload(name) {\n}\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    return 0;\n}\nexport function stop(name) {\n}\nexport function set(name, param, value) {\n}\nexport function get(name, param) {\n    return 0;\n}\nexport function vibrate(duration) {\n    return 1;\n}\n//# sourceMappingURL=index.js.map","import { iMask, tMask, vIncr, vMask } from \"../protocol/interface\";\nexport function nextHandle(h) {\n    return ((h + vIncr) & vMask) | (h & (tMask | iMask));\n}\nexport function connectAudioNode(node, dest) {\n    node.connect(dest);\n}\nexport function disconnectAudioNode(node, dest) {\n    node.disconnect(dest);\n}\nexport function setAudioParamValue(param, value) {\n    param.value = value;\n}\nexport function len(a) {\n    return a.length;\n}\nexport function resize(a, length) {\n    a.length = length;\n}\nexport function add(a, e) {\n    a.push(e);\n}\n//# sourceMappingURL=common.js.map","import { len } from \"./common\";\nexport function unlock(unlocked) {\n    // \"touchstart\", \"touchend\", \"mousedown\", \"pointerdown\"\n    var events = [\"touchstart\", \"touchend\", \"mousedown\", \"click\", \"keydown\"];\n    var num = len(events);\n    var doc = document;\n    var handle = function () {\n        if (unlocked()) {\n            for (var i = 0; i < num; ++i) {\n                doc.removeEventListener(events[i], handle, true);\n            }\n        }\n    };\n    for (var i = 0; i < num; ++i) {\n        doc.addEventListener(events[i], handle, true);\n    }\n}\n//# sourceMappingURL=Unlock.js.map","import { iMask, Unit } from \"../protocol/interface\";\nimport { connectAudioNode, disconnectAudioNode, len, nextHandle, setAudioParamValue } from \"./common\";\nimport { emptyAudioBuffer } from \"./Mixer\";\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(g, p, index) {\n        var _this = this;\n        this.g = g;\n        this.p = p;\n        // handle passport\n        this.h = 0;\n        // Control Flags\n        this.s = 0;\n        // Gain\n        this.G = Unit;\n        // Pan\n        this.P = Unit;\n        // Rate\n        this.R = Unit;\n        // Source auph Buffer\n        this.bf = 0;\n        // Destination auph Bus\n        this.bs = 0;\n        // is source-node started: static buffer playback\n        this._s = 0;\n        // Source-Node\n        this.sn = null;\n        // Destination-Node: connected destination audio node\n        this.dn = null;\n        this._e = function () {\n            // maybe check is useful\n            //if (this.buffer === e.target || (this.stream && this.stream.el === e.target)) {\n            _voiceStop(_this);\n            //}\n        };\n        this.h = 805306368 /* Voice */ | index;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function _voiceNew(ctx, index) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    connectAudioNode(pan, gain);\n    return new VoiceObj(gain, pan, index);\n}\nexport function _voiceChangeDestination(v, target) {\n    if (target !== v.dn) {\n        var gain = v.g;\n        if (v.dn) {\n            disconnectAudioNode(gain, v.dn);\n        }\n        v.dn = target;\n        if (target) {\n            connectAudioNode(gain, target);\n        }\n    }\n}\nexport function _voiceResetDestination(v) {\n    if (v.dn) {\n        disconnectAudioNode(v.g, v.dn);\n        v.dn = null;\n    }\n}\nexport function _voiceStop(v) {\n    // stop buffer\n    var buffer = v.sn;\n    if (buffer) {\n        if ((v.s & 2 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.onended = null;\n        disconnectAudioNode(buffer);\n        try {\n            buffer.buffer = emptyAudioBuffer;\n        }\n        catch (_a) {\n        }\n        v.sn = null;\n    }\n    _voiceResetDestination(v);\n    v.bf = 0;\n    v.bs = 0;\n    v.s = 0;\n    v.h = nextHandle(v.h);\n}\nexport function _voiceStartBuffer(v) {\n    var source = v.sn;\n    if (source && !v._s) {\n        //source.addEventListener(\"ended\", v._e, {once: true});\n        source.onended = v._e;\n        source.loop = (v.s & 4 /* Loop */) !== 0;\n        source.start();\n        v._s = 1;\n    }\n}\nexport function _voicePrepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    connectAudioNode(source, v.p);\n    v.sn = source;\n    v._s = 0;\n}\nexport function _voiceSetLoop(v, value) {\n    var current = (v.s & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.s ^= 4 /* Loop */;\n        if (v.sn) {\n            v.sn.loop = value;\n        }\n    }\n}\nexport function _voiceSetRunning(v, value) {\n    var current = !!(v.s & 2 /* Running */);\n    if (value !== current) {\n        v.s ^= 2 /* Running */;\n        var playbackRate = value ? (v.R / Unit) : 0.0;\n        if (v.sn) {\n            setAudioParamValue(v.sn.playbackRate, playbackRate);\n            if (value) {\n                // restart if play called in pause mode\n                _voiceStartBuffer(v);\n            }\n        }\n    }\n}\nexport function _voiceApplyPitch(v, value) {\n    if (!!(v.s & 2 /* Running */)) {\n        if (v.sn) {\n            setAudioParamValue(v.sn.playbackRate, value / Unit);\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.h === handle) ? obj : null;\n}\nexport function createVoiceObj(ctx) {\n    var next = len(voicePool);\n    for (var i = 1; i < next; ++i) {\n        var v = voicePool[i];\n        if (v.s === 0) {\n            return v.h;\n        }\n    }\n    if (next < voicesMaxCount) {\n        var v = _voiceNew(ctx, next);\n        v.h = 805306368 /* Voice */ | next;\n        voicePool.push(v);\n        return v.h;\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","import { getAudioContextObject } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nimport { add, connectAudioNode, disconnectAudioNode, len, resize } from \"./common\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(g) {\n        this.g = g;\n        this.h = 0;\n        this.s = 1 /* Active */ | 2 /* Running */;\n        this.G = Unit;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nexport var busLine = [];\nexport function createBusObj(ctx) {\n    var next = len(busLine);\n    var obj = new BusObj(ctx.createGain());\n    obj.h = next | 268435456 /* Bus */;\n    add(busLine, obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = createBusObj(ctx).g;\n    connectAudioNode(master, ctx.destination);\n    connectAudioNode(createBusObj(ctx).g, master);\n    connectAudioNode(createBusObj(ctx).g, master);\n    connectAudioNode(createBusObj(ctx).g, master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < len(busLine); ++i) {\n        disconnectAudioNode(busLine[i].g);\n    }\n    resize(busLine, 0);\n}\nexport function _getBus(bus) {\n    var obj = busLine[bus & iMask];\n    return (obj && obj.h === bus) ? obj : null;\n}\nexport function _getBusGain(handle) {\n    var obj = _getBus(handle);\n    return obj ? obj.g : undefined;\n}\nexport function _setBusConnected(bus, connected) {\n    var flag = !!(bus.s & 2 /* Running */);\n    if (flag !== connected) {\n        var master = busLine[0];\n        var dest = bus === master ? getAudioContextObject().destination : master.g;\n        if (connected) {\n            connectAudioNode(bus.g, dest);\n        }\n        else {\n            disconnectAudioNode(bus.g, dest);\n        }\n        bus.s ^= 2 /* Running */;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { iMask } from \"../protocol/interface\";\nimport { error } from \"./debug\";\nimport { add, len, nextHandle } from \"./common\";\nvar BufferObj = /** @class */ (function () {\n    function BufferObj(h, s, b) {\n        this.h = h;\n        this.s = s;\n        this.b = b;\n    }\n    return BufferObj;\n}());\nexport { BufferObj };\nexport var buffers = [null];\nvar buffersMaxCount = 128;\nexport function getNextBufferObj() {\n    var next = len(buffers);\n    for (var i = 1; i < next; ++i) {\n        var buffer = buffers[i];\n        if (buffer.s === 0) {\n            return buffer.h;\n        }\n    }\n    if (next < buffersMaxCount) {\n        var b = new BufferObj(next | 536870912 /* Buffer */, 0, null);\n        add(buffers, b);\n        return b.h;\n    }\n    return 0;\n}\nexport function _bufferDestroy(obj) {\n    // TODO:\n    // if ((obj.s & Flag.Stream) !== 0 && obj.data) {\n    //     URL.revokeObjectURL(obj.b as string);\n    // }\n    obj.h = nextHandle(obj.h);\n    obj.s = 0;\n    obj.b = null;\n}\nexport function _getBufferObj(buffer) {\n    var obj = buffers[buffer & iMask];\n    if (obj && obj.h === buffer) {\n        return obj;\n    }\n    return null;\n}\nfunction _decodeAudioData(ctx, obj, buffer) {\n    var success = function (audioBuffer) {\n        obj.s |= 2 /* Loaded */;\n        obj.b = audioBuffer;\n    };\n    var fail = function (err) {\n        error(18 /* BufferDecodeError */, err);\n        _bufferDestroy(obj);\n    };\n    // TODO: maybe callbacks will be deprecated?\n    ctx.decodeAudioData(buffer, success, fail);\n}\nexport function _bufferMemory(obj, ctx, data, flags) {\n    obj.s |= 1 /* Active */;\n    var buffer = data.buffer.slice(data.byteOffset, data.byteOffset + data.byteLength);\n    // TODO: streaming\n    // if (flags & Flag.Stream) {\n    //     obj.s |= Flag.Stream;\n    _decodeAudioData(ctx, obj, buffer);\n}\nexport function _bufferLoad(obj, ctx, filepath, flags) {\n    obj.s |= 1 /* Active */;\n    // TODO: streaming\n    //if (flags & Flag.Stream) {\n    //obj.s |= Flag.Stream;\n    fetch(new Request(filepath))\n        .then(function (response) { return response.arrayBuffer(); })\n        .then(function (buffer) { return _decodeAudioData(ctx, obj, buffer); })\n        .catch(function (reason) {\n        error(19 /* BufferLoadError */, reason);\n        _bufferDestroy(obj);\n    });\n}\n//# sourceMappingURL=Buffer.js.map","import { audioContextPause, audioContextResume, closeContext, getAudioContextObject, getContext, getContextState, initContext } from \"./Mixer\";\nimport { _getVoiceObj, _voiceApplyPitch, _voiceChangeDestination, _voicePrepareBuffer, _voiceSetLoop, _voiceSetRunning, _voiceStartBuffer, _voiceStop, createVoiceObj, voicePool } from \"./Voice\";\nimport { _getBus, _getBusGain, _setBusConnected, busLine, initBusPool, termBusPool } from \"./Bus\";\nimport { setError, warn } from \"./debug\";\nimport { DefaultBus, iMask, Mixer, tMask, Unit } from \"../protocol/interface\";\nimport { _bufferDestroy, _bufferLoad, _bufferMemory, _getBufferObj, buffers, getNextBufferObj } from \"./Buffer\";\nimport { len, resize, setAudioParamValue } from \"./common\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        resize(voicePool, 1);\n        resize(buffers, 1);\n        closeContext(ctx);\n    }\n}\nexport function load(filepath, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var ctx = getAudioContextObject();\n        if (!ctx) {\n            setError(24 /* NotInitialized */);\n            return 0;\n        }\n        var obj = buffers[handle & iMask];\n        _bufferLoad(obj, ctx, filepath, flags);\n    }\n    return handle;\n}\nexport function loadMemory(data, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var ctx = getAudioContextObject();\n        if (!ctx) {\n            setError(24 /* NotInitialized */);\n            return 0;\n        }\n        var obj = buffers[handle & iMask];\n        _bufferMemory(obj, ctx, data, flags);\n    }\n    return handle;\n}\nexport function unload(name) {\n    var obj = _getBufferObj(name);\n    if (obj) {\n        stop(name);\n        _bufferDestroy(obj);\n    }\n}\n/***\n *\n * @param buffer\n * @param gain\n * @param pan\n * @param rate\n * @param flags\n * @param bus\n */\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    // arguments check debug\n    if (flags & ~(2 /* Running */ | 4 /* Loop */)) {\n        setError(22 /* InvalidArguments */);\n        return 0;\n    }\n    ///\n    var ctx = getAudioContextObject();\n    if (!ctx || ctx.state !== \"running\") {\n        setError(23 /* InvalidMixerState */, ctx === null || ctx === void 0 ? void 0 : ctx.state);\n        return 0;\n    }\n    var bufferObj = _getBufferObj(buffer);\n    if (!bufferObj) {\n        setError(15 /* BufferNotFound */);\n        return 0;\n    }\n    if (!(bufferObj.s & 2 /* Loaded */)) {\n        setError(16 /* BufferIsNotLoaded */);\n        return 0;\n    }\n    if (!bufferObj.b) {\n        setError(17 /* BufferNoData */);\n        return 0;\n    }\n    var targetNode = _getBusGain(bus ? bus : DefaultBus);\n    if (!targetNode) {\n        setError(21 /* BusNotFound */);\n        return 0;\n    }\n    var voice = createVoiceObj(ctx);\n    if (voice === 0) {\n        setError(12 /* Warning_NoFreeVoices */);\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    voiceObj.s = 1 /* Active */ | flags;\n    voiceObj.bf = buffer;\n    voiceObj.G = gain;\n    voiceObj.P = pan;\n    voiceObj.R = rate;\n    setAudioParamValue(voiceObj.g.gain, gain / Unit);\n    setAudioParamValue(voiceObj.p.pan, pan / Unit - 1);\n    // TODO: streamed decoding\n    //if (bufferObj.s & Flag.Stream) {\n    _voicePrepareBuffer(voiceObj, ctx, bufferObj.b);\n    if (flags & 2 /* Running */) {\n        _voiceStartBuffer(voiceObj);\n    }\n    // maybe we need to set target before `startBuffer()`\n    _voiceChangeDestination(voiceObj, targetNode);\n    _voiceApplyPitch(voiceObj, rate);\n    return voice;\n}\nexport function stop(name) {\n    if (name === 0) {\n        return;\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            _voiceStop(obj);\n        }\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            for (var i = 1; i < len(voicePool); ++i) {\n                var v = voicePool[i];\n                if (v.bf === name) {\n                    _voiceStop(v);\n                }\n            }\n        }\n        else {\n            setError(15 /* BufferNotFound */);\n        }\n    }\n}\nexport function set(name, param, value) {\n    if (name === 0) {\n        return;\n    }\n    if (name === Mixer && (param & 128 /* Flags */) && (param & 2 /* Running */)) {\n        var ctx = getContext();\n        if (ctx) {\n            if (value && ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n            }\n            else if (!value && ctx.state === \"running\") {\n                audioContextPause(ctx);\n            }\n        }\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                var enabled = value !== 0;\n                if (param & 2 /* Running */) {\n                    _voiceSetRunning(obj, enabled);\n                }\n                else if (param & 4 /* Loop */) {\n                    _voiceSetLoop(obj, enabled);\n                }\n            }\n            else {\n                if (param === 1 /* Gain */) {\n                    if (obj.G !== value) {\n                        obj.G = value;\n                        setAudioParamValue(obj.g.gain, value / Unit);\n                    }\n                }\n                else if (param === 2 /* Pan */) {\n                    if (obj.P !== value) {\n                        obj.P = value;\n                        setAudioParamValue(obj.p.pan, value / Unit - 1);\n                    }\n                }\n                else if (param === 3 /* Rate */) {\n                    if (obj.R !== value) {\n                        obj.R = value;\n                        _voiceApplyPitch(obj, value);\n                    }\n                }\n                else if (param === 4 /* CurrentTime */) {\n                    // TODO:\n                }\n            }\n        }\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                if (param & 2 /* Running */) {\n                    _setBusConnected(obj, !!value);\n                }\n            }\n            else {\n                if (param === 1 /* Gain */) {\n                    if (obj.G !== value) {\n                        setAudioParamValue(obj.g.gain, value / Unit);\n                        obj.G = value;\n                    }\n                }\n                else {\n                }\n            }\n        }\n    }\n}\nexport function get(name, param) {\n    var result = 0;\n    if (name === Mixer) {\n        var ctx = getAudioContextObject();\n        if (ctx) {\n            if (param === 0 /* State */) {\n                result = getContextState(ctx);\n            }\n            else if (param === 5 /* SampleRate */) {\n                result = ctx.sampleRate | 0;\n            }\n        }\n        return result;\n    }\n    var type = name & tMask;\n    if ((param & 256 /* Count */) && !(name & iMask)) {\n        var stateMask = param & 127 /* StateMask */;\n        if (type === 805306368 /* Voice */) {\n            result = _countObjectsWithFlags(voicePool, stateMask);\n        }\n        else if (type === 268435456 /* Bus */) {\n            result = _countObjectsWithFlags(busLine, stateMask);\n        }\n        else if (type === 536870912 /* Buffer */) {\n            result = _countObjectsWithFlags(buffers, stateMask);\n        }\n        return result;\n    }\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            if (param === 0 /* State */) {\n                result = obj.s;\n            }\n            else if (param === 1 /* Gain */) {\n                result = obj.G;\n            }\n            else if (param === 2 /* Pan */) {\n                result = obj.P;\n            }\n            else if (param === 3 /* Rate */) {\n                result = obj.R;\n            }\n            else if (param === 6 /* Duration */) {\n                if (obj.sn && obj.sn.buffer) {\n                    result = (obj.sn.buffer.duration * Unit) | 0;\n                }\n            }\n            else if (param === 4 /* CurrentTime */) {\n                if (obj.sn && obj.sn.buffer) {\n                    // TODO: :(\n                }\n            }\n            else {\n                warn(1 /* NotSupported */);\n            }\n        }\n        return result;\n    }\n    if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            if (param === 0 /* State */) {\n                result = obj.s;\n            }\n            else if (param === 1 /* Gain */) {\n                result = obj.G;\n            }\n            else {\n                warn(1 /* NotSupported */);\n            }\n        }\n        return result;\n    }\n    if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            if (param === 0 /* State */) {\n                result = obj.s;\n            }\n            else if (param === 6 /* Duration */) {\n                if (obj.b) {\n                    result = (obj.b.duration * Unit) | 0;\n                }\n            }\n            else {\n                warn(1 /* NotSupported */);\n            }\n        }\n    }\n    return result;\n}\nexport function vibrate(durationMillis) {\n    try {\n        if (navigator.vibrate) {\n            return navigator.vibrate(durationMillis) ? 0 : 1;\n        }\n    }\n    catch (_a) {\n    }\n    return 1;\n}\n/** private helpers **/\nfunction _countObjectsWithFlags(arr, mask) {\n    var cnt = 0;\n    var size = len(arr);\n    for (var i = 1; i < size; ++i) {\n        var obj = arr[i];\n        if (obj && (obj.s & mask) === mask) {\n            ++cnt;\n        }\n    }\n    return cnt;\n}\n//# sourceMappingURL=index.js.map","import { Mixer, Unit } from \"./protocol/interface\";\nimport * as Null from \"./null/index\";\nimport * as Browser from \"./webaudio/index\";\nfunction haveWebAudio() {\n    return typeof window !== \"undefined\" && !!(window.AudioContext || window.webkitAudioContext);\n}\nfunction loadDriver() {\n    if (typeof process !== \"undefined\") {\n        return require(\"bindings\")(\"auph\");\n    }\n    if (haveWebAudio()) {\n        return Browser;\n    }\n    return Null;\n}\nvar _ = loadDriver();\nexport * from \"./protocol/static\";\nexport var init = _.init;\nexport var shutdown = _.shutdown;\nexport var set = _.set;\nexport var get = _.get;\nexport var load = _.load;\nexport var loadMemory = _.loadMemory;\nexport var unload = _.unload;\nexport var stop = _.stop;\nexport var vibrate = _.vibrate;\nexport function pause(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, true);\n}\nexport function resume(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, false);\n}\nexport function play(buffer, gain, pan, rate, loop, paused, bus) {\n    if (gain === void 0) { gain = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (rate === void 0) { rate = 1.0; }\n    var flags = 0;\n    if (!!loop)\n        flags |= 4 /* Loop */;\n    if (!paused)\n        flags |= 2 /* Running */;\n    return _.voice(buffer, f2u(gain), f2u(+pan + 1), f2u(rate), flags, 0 | bus);\n}\nexport function getMixerStateString(state) {\n    return [\"closed\", \"paused\", \"\", \"running\"][state & 3];\n}\nexport function getBufferStateString(state) {\n    return [\"free\", \"loading\", \"\", \"loaded\"][state & 0x3] + [\"\", \" streaming\"][(state >>> 2) & 0x1];\n}\nexport function setGain(busOrVoice, value) {\n    set(busOrVoice, 1 /* Gain */, f2u(value));\n}\nexport function getGain(busOrVoice) {\n    return get(busOrVoice, 1 /* Gain */) / Unit;\n}\nexport function setPan(voice, pan) {\n    set(voice, 2 /* Pan */, f2u(+pan + 1));\n}\nexport function setRate(voice, rate) {\n    set(voice, 3 /* Rate */, f2u(rate));\n}\nexport function setPause(name, value) {\n    set(name, 128 /* Flags */ | 2 /* Running */, 0 | !value);\n}\nexport function setLoop(voice, value) {\n    set(voice, 128 /* Flags */ | 4 /* Loop */, 0 | value);\n}\nexport function getPan(voice) {\n    return get(voice, 2 /* Pan */) / Unit - 1;\n}\nexport function getRate(voice) {\n    return get(voice, 3 /* Rate */) / Unit;\n}\nexport function getPause(voice) {\n    return !(get(voice, 0 /* State */) & 2 /* Running */);\n}\nexport function getLoop(voice) {\n    return !!(get(voice, 0 /* State */) & 4 /* Loop */);\n}\nexport function getCurrentTime(voice) {\n    return get(voice, 4 /* CurrentTime */) / Unit;\n}\nexport function isActive(name) {\n    return !!(get(name, 0 /* State */) & 1 /* Active */);\n}\nexport function isBufferLoaded(name) {\n    var mask = 1 /* Active */ | 2 /* Loaded */;\n    return (get(name, 0 /* State */) & mask) === mask;\n}\nexport function getDuration(name) {\n    return get(name, 6 /* Duration */) / Unit;\n}\nfunction f2u(x) {\n    return (x * Unit) | 0;\n}\n//# sourceMappingURL=index.js.map","import { Mixer } from \"./interface\";\n/** Export Constants only for pre-bundled usage **/\nexport var SAMPLE_RATE = 5 /* SampleRate */;\nexport var STATE = 0 /* State */;\nexport var COUNT = 256 /* Count */;\nexport var ACTIVE = 1 /* Active */;\nexport var RUNNING = 2 /* Running */;\nexport var STREAM = 4 /* Stream */;\nexport var LOOP = 4 /* Loop */;\nexport var MIXER = Mixer;\nexport var BUS = 268435456 /* Bus */;\nexport var VOICE = 805306368 /* Voice */;\nexport var BUFFER = 536870912 /* Buffer */;\nexport var BUS_MASTER = 268435456 /* Bus */ | 0;\nexport var BUS_SFX = 268435456 /* Bus */ | 1;\nexport var BUS_MUSIC = 268435456 /* Bus */ | 2;\nexport var BUS_SPEECH = 268435456 /* Bus */ | 3;\n//# sourceMappingURL=static.js.map"],"names":["tMask","iMask","Unit","ctx","emptyAudioBuffer","filepath","flags","data","name","buffer","gain","pan","rate","bus","param","value","duration","nextHandle","h","connectAudioNode","node","dest","connect","disconnectAudioNode","disconnect","setAudioParamValue","len","a","length","resize","add","e","push","getContext","state","getAudioContextObject","audioContextResume","resume","then","catch","reason","initContext","options","scope","window","audioContext","AudioContext","webkitAudioContext","err","newAudioContext","createBuffer","unlocked","events","num","doc","document","handle","i","removeEventListener","addEventListener","unlock","closeContext","context","close","undefined","VoiceObj","g","p","index","_this","this","s","G","P","R","bf","bs","_s","sn","dn","_e","_voiceStop","v","stop","onended","_a","_voiceResetDestination","_voiceStartBuffer","source","loop","start","_voiceApplyPitch","playbackRate","voicePool","_getVoiceObj","obj","createVoiceObj","next","createGain","createStereoPanner","_voiceNew","BusObj","busLine","createBusObj","_getBus","BufferObj","b","buffers","getNextBufferObj","_bufferDestroy","_getBufferObj","_decodeAudioData","decodeAudioData","audioBuffer","type","_countObjectsWithFlags","arr","mask","cnt","size","master","destination","initBusPool","termBusPool","fetch","Request","response","arrayBuffer","_bufferLoad","slice","byteOffset","byteLength","_bufferMemory","bufferObj","targetNode","voice","voiceObj","createBufferSource","_voicePrepareBuffer","target","_voiceChangeDestination","suspend","audioContextPause","enabled","_voiceSetRunning","_voiceSetLoop","connected","_setBusConnected","result","getContextState","sampleRate","stateMask","durationMillis","navigator","vibrate","_","process","require","Browser","Null","init","shutdown","set","get","load","loadMemory","unload","setPause","f2u","x","busOrVoice","paused"],"mappings":"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"}