var auph=function(n){"use strict";var t=805306368,e=255,r=1024;var u=Object.freeze({__proto__:null,init:function(){},shutdown:function(){},load:function(n,t){return 0},loadMemory:function(n,t){return 0},unload:function(n){},voice:function(n,t,e,r,u,i){return 0},stop:function(n){},set:function(n,t,e){},get:function(n,t){return 0}}),i="[AUPH]";function a(n){console.warn(i,n)}function o(n,t){console.error(i,n,t)}var f=null,c=null;function s(){return f&&"closed"!==f.state?f:(a(2),null)}function l(){return f}function d(n){n.resume().then((function(){})).catch((function(n){o(5,n)}))}function v(){return f?(a(14),f):((f=function(n){var t=window,e=t.AudioContext||t.webkitAudioContext;try{return new e}catch(n){o(1,n)}return null}())&&(c||(c=f.createBuffer(1,1,22050)),function(n){for(var t=["touchstart","touchend","mousedown","click","keydown"],e=t.length,r=document,u=function(){if(n())for(var i=0;i<e;++i)r.removeEventListener(t[i],u,!0)},i=0;i<e;++i)r.addEventListener(t[i],u,!0)}((function(){return"suspended"!==f.state||(d(f),!1)}))),f)}function h(n){n.close().then((function(){})).catch((function(n){o(11,n)})),f=null}function g(n,t){n.value!==t&&(n.value=t)}function b(n){return n+256&16776960|805306623&n}var p=function(n,t,e){var u=this;this.gain=n,this.pan=t,this.h=0,this.s=0,this._gain=r,this._pan=r,this._rate=r,this.data=0,this.bus=0,this._started=!1,this.buffer=null,this.out=null,this._e=function(){_(u)},this.h=805306368|e};function _(n){var t=n.buffer;if(t){0!=(2&n.s)&&t.stop(),t.onended=null,t.disconnect();try{t.buffer=c}catch(n){}n.buffer=null}!function(n){n.out&&(n.gain.disconnect(n.out),n.out=null)}(n),n.data=0,n.bus=0,n.s=0,n.h=b(n.h)}function w(n){var t=n.buffer;t&&!n._started&&(t.onended=n._e,t.loop=0!=(4&n.s),t.start(),n._started=!0)}function S(n,t){if(0!=(2&n.s)){var e=t/r;n.buffer&&(n.buffer.playbackRate.value=e)}}var y=[null];function E(n){var t=y[n&e];return t&&t.h===n?t:null}function A(n){for(var t=1;t<y.length;++t){if(0===(e=y[t]).s)return e.h}var e,r=y.length;return r<64?((e=function(n,t){var e=n.createGain(),r=n.createStereoPanner();return r.connect(e),new p(e,r,t)}(n,r)).h=805306368|r,y.push(e),e.h):0}var m=function(n){this.gain=n,this.h=0,this.s=3,this._gain=r},R=[];function B(n){var t=R.length,e=new m(n.createGain());return e.h=268435456|t,R.push(e),e}function M(n){var t=R[n&e];return t&&t.h===n?t:null}var C=function(n,t,e){this.h=n,this.s=t,this.b=e},P=[null];function U(){for(var n=1;n<P.length;++n){var t=P[n];if(0===t.s)return t.h}var e=P.length;if(e<128){var r=new C(536870912|e,0,null);return P.push(r),r.h}return 0}function O(n){n.h=b(n.h),n.s=0,n.b=null}function k(n){var t=P[n&e];return t&&t.h===n?t:null}function L(n,t,e){n.decodeAudioData(e,(function(n){t.s|=2,t.b=n}),(function(n){o("Error decode audio buffer",n),O(t)}))}function T(n){if(0!==n){var e=n&t;if(805306368===e)(r=E(n))&&_(r);else if(536870912===e){var r;if(r=k(n))for(var u=1;u<y.length;++u){var i=y[u];i.data===n&&_(i)}}}}function x(n,t){for(var e=0,r=1;r<n.length;++r){var u=n[r];u&&(u.s&t)===t&&++e}return e}var G=Object.freeze({__proto__:null,init:function(){var n=v();n&&function(n){var t=B(n).gain;t.connect(n.destination),B(n).gain.connect(t),B(n).gain.connect(t),B(n).gain.connect(t)}(n)},shutdown:function(){var n=s();n&&(!function(){for(var n=0;n<R.length;++n)R[n].gain.disconnect();R.length=0}(),y.length=1,P.length=1,h(n))},load:function(n,t){var r=U();if(r){var u=l();if(!u)return 0;!function(n,t,e,r){n.s|=1,fetch(new Request(e)).then((function(n){return n.arrayBuffer()})).then((function(e){return L(t,n,e)})).catch((function(t){o("Error load file",t),O(n)}))}(P[r&e],u,n)}return r},loadMemory:function(n,t){var r=U();if(r){var u=l();if(!u)return 0;!function(n,t,e,r){n.s|=1,L(t,n,e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}(P[r&e],u,n)}return r},unload:function(n){var t=k(n);t&&(T(n),O(t))},voice:function(n,t,e,u,i,a){if(-7&i)return 0;var o=l();if(!o||"running"!==o.state)return null==o||o.state,0;var f=k(n);if(!f)return 0;if(!(2&f.s))return 0;if(!f.b)return 0;var c,s=(c=M(a||268435457))?c.gain:void 0;if(!s)return 0;var d=A(o);if(0===d)return 0;var v=E(d);return v.s=1|i,v.data=n,v._gain=t,v._pan=e,v._rate=u,v.gain.gain.value=t/r,v.pan.pan.value=e/r-1,function(n,t,e){var r=t.createBufferSource();r.buffer=e,r.connect(n.pan),n.buffer=r,n._started=!1}(v,o,f.b),2&i&&w(v),function(n,t){if(t!==n.out){var e=n.gain;n.out&&e.disconnect(n.out),n.out=t,t&&e.connect(t)}}(v,s),S(v,u),d},stop:T,set:function(n,e,u){if(0!==n){if(1===n&&128&e&&2&e){var i=s();i&&(u&&"suspended"===i.state?d(i):u||"running"!==i.state||function(n){n.suspend().then((function(){})).catch((function(n){o(8,n)}))}(i))}var a=n&t;if(805306368===a){if(c=E(n))if(128&e){var f=0!==u;2&e?function(n,t){if(t!==!!(2&n.s)){n.s^=2;var e=t?n._rate/r:0;n.buffer&&(n.buffer.playbackRate.value=e,t&&w(n))}}(c,f):4&e&&function(n,t){t!==(0!=(4&n.s))&&(n.s^=4,n.buffer&&(n.buffer.loop=t))}(c,f)}else switch(e){case 1:c._gain!==u&&(c._gain=u,g(c.gain.gain,u/r));break;case 2:c._pan!==u&&(c._pan=u,g(c.pan.pan,u/r-1));break;case 3:c._rate!==u&&(c._rate=u,S(c,u))}}else if(268435456===a){var c;if(c=M(n))if(128&e)2&e&&function(n,t){if(!!(2&n.s)!==t){var e=R[0],r=n===e?l().destination:e.gain;t?n.gain.connect(r):n.gain.disconnect(r),n.s^=2}}(c,!!u);else switch(e){case 1:c._gain!==u&&g(c.gain.gain,u/r)}}}},get:function(n,u){if(1===n){var i=l();if(i){if(0===u)return function(n){var t=0;return"closed"!==n.state&&(t|=1,"running"===n.state&&(t|=2)),t}(i);if(5===u)return 0|i.sampleRate}return 0}var o=n&t;if(256&u&&!(n&e)){var f=127&u;return 805306368===o?x(y,f):268435456===o?x(R,f):536870912===o?x(P,f):0}if(805306368===o){if(s=E(n))switch(u){case 0:return s.s;case 1:return s._gain;case 2:return s._pan;case 3:return s._rate;case 6:var c=0;return s.buffer&&s.buffer.buffer&&(c=s.buffer.buffer.duration*r),c*r|0;case 4:c=0;return s.buffer&&s.buffer.buffer,c*r|0;default:a(1)}return 0}if(268435456===o){if(s=M(n))switch(u){case 0:return s.s;case 1:return s._gain;default:a(1)}return 0}if(536870912===o){var s;if(s=k(n))switch(u){case 0:return s.s;case 6:c=0;return s.b&&(c=s.b.duration),c*r|0;default:a(1)}return 0}return 0}});var I="undefined"!=typeof process?require("bindings")("auph"):"undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext)?G:u,N=I.init,j=I.shutdown,F=I.set,q=I.get,z=I.load,D=I.loadMemory,H=I.unload,V=I.stop;function X(n,t){F(n,130,0|!t)}function J(n){return n*r|0}return n.ACTIVE=1,n.BUFFER=536870912,n.BUS=268435456,n.BUS_MASTER=268435456,n.BUS_MUSIC=268435458,n.BUS_SFX=268435457,n.BUS_SPEECH=268435459,n.COUNT=256,n.LOOP=4,n.MIXER=1,n.RUNNING=2,n.SAMPLE_RATE=5,n.STATE=0,n.STREAM=4,n.VOICE=805306368,n.get=q,n.getBufferStateString=function(n){return["free","loading","","loaded"][3&n]+[""," streaming"][n>>>2&1]},n.getCurrentTime=function(n){return q(n,4)/r},n.getDuration=function(n){return q(n,6)/r},n.getGain=function(n){return q(n,1)/r},n.getLoop=function(n){return!!(4&q(n,0))},n.getMixerStateString=function(n){return["closed","paused","","running"][3&n]},n.getPan=function(n){return q(n,2)/r-1},n.getPause=function(n){return!(2&q(n,0))},n.getRate=function(n){return q(n,3)/r},n.init=N,n.isActive=function(n){return!!(1&q(n,0))},n.isBufferLoaded=function(n){return 3==(3&q(n,0))},n.load=z,n.loadMemory=D,n.pause=function(n){void 0===n&&(n=1),X(n,!0)},n.play=function(n,t,e,r,u,i,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=1);var o=0;return u&&(o|=4),i||(o|=2),I.voice(n,J(t),J(+e+1),J(r),o,0|a)},n.resume=function(n){void 0===n&&(n=1),X(n,!1)},n.set=F,n.setGain=function(n,t){F(n,1,J(t))},n.setLoop=function(n,t){F(n,132,0|t)},n.setPan=function(n,t){F(n,2,J(+t+1))},n.setPause=X,n.setRate=function(n,t){F(n,3,J(t))},n.shutdown=j,n.stop=V,n.unload=H,Object.defineProperty(n,"__esModule",{value:!0}),n}({});//# sourceMappingURL=auph.js.map
