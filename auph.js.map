{"version":3,"file":"auph.js","sources":["../module/protocol/interface.js","../module/null/index.js","../module/webaudio/debug.js","../module/webaudio/Mixer.js","../module/webaudio/StreamPlayer.js","../module/webaudio/common.js","../module/webaudio/Voice.js","../module/webaudio/Bus.js","../module/webaudio/Buffer.js","../module/webaudio/index.js","../module/index.js","../module/protocol/static.js"],"sourcesContent":["/**\n * Object Name Identifier Layout: [00tt 0000 | vvvv vvvv | vvvv vvvv | iiii iiii]\n */\nexport var tMask = 0x30000000;\nexport var vMask = 0x00FFFF00;\nexport var vIncr = 0x00000100;\nexport var iMask = 0x000000FF;\nexport var Mixer = 0x00000001;\n// used for integer to float params conversion\nexport var Unit = 1024;\nexport var DefaultBus = 1 /* Sound */ | 268435456 /* Bus */;\n//# sourceMappingURL=interface.js.map","export function init() {\n}\nexport function shutdown() {\n}\nexport function load(filepath, flags) {\n    return 0;\n}\nexport function loadMemory(data, flags) {\n    return 0;\n}\nexport function unload(name) {\n}\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    return 0;\n}\nexport function stop(name) {\n}\nexport function set(name, param, value) {\n}\nexport function get(name, param) {\n    return 0;\n}\n//# sourceMappingURL=index.js.map","var TAG = \"[AUPH]\";\nexport function log(message) {\n    if (process.env.NODE_ENV !== \"production\") {\n        console.log(TAG, message);\n    }\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function measure(ts) {\n    if (process.env.NODE_ENV !== \"production\") {\n        return performance.now() - ts;\n    }\n    else {\n        return 0;\n    }\n}\n//# sourceMappingURL=debug.js.map","import { error, log, warn } from \"./debug\";\nvar ctx = null;\nvar unlockEvents = [\"mousedown\", \"pointerdown\", \"touchstart\"];\nvar unlocked = false;\nexport function getContext() {\n    if (!ctx) {\n        warn(\"not initialized\");\n        return null;\n    }\n    if (ctx.state === \"closed\") {\n        error(\"invalid state:\", \"Context is closed\");\n        return null;\n    }\n    return ctx;\n}\nexport function getAudioContextObject() {\n    return ctx;\n}\nexport function getContextState(ctx) {\n    var state = 0;\n    if (ctx.state !== \"closed\") {\n        state |= 1 /* Active */;\n        if (ctx.state === \"running\") {\n            state |= 2 /* Running */;\n        }\n    }\n    return state;\n}\nexport function audioContextResume(ctx) {\n    log(\"resuming...\");\n    ctx.resume().then(function () {\n        log(\"resumed\");\n    }).catch(function (reason) {\n        if (!unlocked) {\n            log(\"cannot resume until user interaction, setup unlock handler...\");\n            setupUnlockHandler();\n        }\n        else {\n            error(\"error resuming AudioContext\", reason);\n        }\n    });\n}\nexport function audioContextPause(ctx) {\n    log(\"AudioContext suspending...\");\n    ctx.suspend().then(function () {\n        log(\"AudioContext suspended\");\n    }).catch(function (reason) {\n        error(\"error suspending AudioContext\", reason);\n    });\n}\nfunction unlock() {\n    unlocked = true;\n    var removeEventListener = document.removeEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        removeEventListener(unlockEvents[i], unlock);\n    }\n    if (ctx && ctx.state === \"suspended\") {\n        audioContextResume(ctx);\n    }\n}\nfunction setupUnlockHandler() {\n    var addEventListener = document.addEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        addEventListener(unlockEvents[i], unlock);\n    }\n}\nexport function initContext() {\n    if (ctx) {\n        warn(\"already initialized\");\n        return ctx;\n    }\n    ctx = new AudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: 22050\n    });\n    if (!ctx) {\n        error(\"error create AudioContext\");\n        return null;\n    }\n    if (ctx.state === \"running\") {\n        audioContextPause(ctx);\n    }\n    log(\"Latency: \" + ctx.baseLatency);\n    log(\"Sample rate: \" + ctx.sampleRate);\n    return ctx;\n}\nexport function closeContext(_notNullCtx) {\n    log(\"shutdown...\");\n    _notNullCtx.close().then(function () {\n        log(\"shutdown completed\");\n    }).catch(function (reason) {\n        error(\"shutdown error\", reason);\n    });\n    ctx = null;\n}\nexport function _setAudioParam(param, value) {\n    if (param.value !== value) {\n        param.value = value;\n    }\n}\n//# sourceMappingURL=Mixer.js.map","import { getContext } from \"./Mixer\";\nimport { error, log } from \"./debug\";\nvar emptyWaveData = \"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=\";\nvar StreamPlayer = /** @class */ (function () {\n    function StreamPlayer(el, node) {\n        this.el = el;\n        this.node = node;\n    }\n    return StreamPlayer;\n}());\nexport { StreamPlayer };\nexport function StreamPlayer_create(ctx, url) {\n    var el = new Audio(url);\n    el.preload = \"metadata\";\n    el[\"preservesPitch\"] = false;\n    return new StreamPlayer(el, ctx.createMediaElementSource(el));\n}\nexport function StreamPlayer_isFree(player) {\n    return player.el.src === emptyWaveData;\n}\nexport function StreamPlayer_stop(player) {\n    var el = player.el;\n    if (el.src !== emptyWaveData) {\n        el.onended = null;\n        el.pause();\n        el.src = emptyWaveData;\n        el.currentTime = 0;\n        player.node.disconnect();\n    }\n}\nexport function _streamPlayerResume(player) {\n    player.el.play().then(function () {\n        log(\"started stream player\");\n    }).catch(function (reason) {\n        error(\"error on play stream\", reason);\n    });\n}\nvar players = [];\nvar playersMaxCount = 4;\nexport function getNextStreamPlayer(src) {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        if (StreamPlayer_isFree(player)) {\n            player.el.src = src;\n            return player;\n        }\n    }\n    if (players.length < playersMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var mes = StreamPlayer_create(ctx, src);\n            players.push(mes);\n            return mes;\n        }\n    }\n    return null;\n}\nexport function destroyStreamPlayersPool() {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        StreamPlayer_stop(player);\n        player.el.src = \"\";\n    }\n    players.length = 0;\n}\nexport function getStreamPlayersCount() {\n    var count = 0;\n    for (var i = 0; i < players.length; ++i) {\n        if (!StreamPlayer_isFree(players[i])) {\n            ++count;\n        }\n    }\n    return count;\n}\n//# sourceMappingURL=StreamPlayer.js.map","import { iMask, tMask, vIncr, vMask } from \"../protocol/interface\";\nexport function nextHandle(h) {\n    return ((h + vIncr) & vMask) | (h & (tMask | iMask));\n}\n//# sourceMappingURL=common.js.map","import { _streamPlayerResume, StreamPlayer_stop } from \"./StreamPlayer\";\nimport { getContext } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nimport { nextHandle } from \"./common\";\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan, index) {\n        var _this = this;\n        this.gain = gain;\n        this.pan = pan;\n        // handle passport\n        this.h = 0;\n        // Control Flags\n        this.s = 0;\n        this._gain = Unit;\n        this._pan = Unit;\n        this._rate = Unit;\n        this.data = 0;\n        this.bus = 0;\n        this.stream = null;\n        // static buffer playback\n        this._started = false;\n        this.buffer = null;\n        // common nodes\n        this.target = null;\n        this._e = function () {\n            // maybe check is useful\n            //if (this.buffer === e.target || (this.stream && this.stream.el === e.target)) {\n            _voiceStop(_this);\n            //}\n        };\n        this.h = 805306368 /* Voice */ | index;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function _voiceNew(ctx, index) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan, index);\n}\nexport function _voiceChangeDestination(v, target) {\n    if (target !== v.target) {\n        var gain = v.gain;\n        if (v.target) {\n            gain.disconnect(v.target);\n        }\n        v.target = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function _voiceResetDestination(v) {\n    if (v.target) {\n        v.gain.disconnect(v.target);\n        v.target = null;\n    }\n}\nexport function _voiceStop(v) {\n    // stop stream\n    if (v.stream) {\n        StreamPlayer_stop(v.stream);\n        v.stream = null;\n    }\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.s & 2 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.disconnect();\n        v.buffer = null;\n    }\n    _voiceResetDestination(v);\n    v.data = 0;\n    v.bus = 0;\n    v.s = 0;\n    v.h = nextHandle(v.h);\n}\nexport function _voiceStartBuffer(v) {\n    var source = v.buffer;\n    if (source && !v._started) {\n        //source.addEventListener(\"ended\", v._e, {once: true});\n        source.onended = v._e;\n        source.loop = (v.s & 4 /* Loop */) !== 0;\n        source.start();\n        v._started = true;\n    }\n}\nexport function _voicePrepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n    v._started = false;\n}\nexport function _voiceSetLoop(v, value) {\n    var current = (v.s & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.s ^= 4 /* Loop */;\n        if (v.stream) {\n            v.stream.el.loop = value;\n        }\n        else if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function _voiceSetRunning(v, value) {\n    var current = !!(v.s & 2 /* Running */);\n    if (value !== current) {\n        v.s ^= 2 /* Running */;\n        if (v.stream) {\n            if (value) {\n                _streamPlayerResume(v.stream);\n            }\n            else {\n                v.stream.el.pause();\n            }\n        }\n        else if (v.buffer) {\n            v.buffer.playbackRate.value = value ? (v._rate / Unit) : 0.0;\n            if (value) {\n                // restart if play called in pause mode\n                _voiceStartBuffer(v);\n            }\n        }\n    }\n}\nexport function _voiceSetPitch(v, value) {\n    if (v._rate !== value) {\n        v._rate = value;\n        if (v.stream) {\n            v.stream.el.playbackRate = value / Unit;\n        }\n        else if (v.buffer) {\n            if ((v.s & 2 /* Running */) !== 0) {\n                v.buffer.playbackRate.value = value / Unit;\n            }\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.h === handle) ? obj : null;\n}\nexport function createVoiceObj() {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.s === 0) {\n            return v.h;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var v = _voiceNew(ctx, index);\n            v.h = 805306368 /* Voice */ | index;\n            voicePool.push(v);\n            return v.h;\n        }\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","import { getAudioContextObject } from \"./Mixer\";\nimport { iMask, Unit } from \"../protocol/interface\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain) {\n        this.gain = gain;\n        this.h = 0;\n        this.s = 1 /* Active */ | 2 /* Running */;\n        this._gain = Unit;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nexport var busLine = [];\nexport function createBusObj(ctx) {\n    var next = busLine.length;\n    var obj = new BusObj(ctx.createGain());\n    obj.h = next | 268435456 /* Bus */;\n    busLine.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = createBusObj(ctx).gain;\n    master.connect(ctx.destination);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n    createBusObj(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busLine.length; ++i) {\n        busLine[i].gain.disconnect();\n    }\n    busLine.length = 0;\n}\nexport function _getBus(bus) {\n    var obj = busLine[bus & iMask];\n    return (obj && obj.h === bus) ? obj : null;\n}\nexport function _getBusGain(handle) {\n    var obj = _getBus(handle);\n    return obj ? obj.gain : undefined;\n}\nexport function _setBusConnected(bus, connected) {\n    var flag = !!(bus.s & 2 /* Running */);\n    if (flag !== connected) {\n        var master = busLine[0];\n        var dest = bus === master ? getAudioContextObject().destination : master.gain;\n        if (connected) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.s ^= 2 /* Running */;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { iMask } from \"../protocol/interface\";\nimport { error, log, measure } from \"./debug\";\nimport { getContext } from \"./Mixer\";\nimport { nextHandle } from \"./common\";\nvar BufferObj = /** @class */ (function () {\n    function BufferObj(index) {\n        // State Flags\n        this.s = 0;\n        this.data = null;\n        this.h = index | 536870912 /* Buffer */;\n    }\n    return BufferObj;\n}());\nexport { BufferObj };\nexport var buffers = [null];\nvar buffersMaxCount = 128;\nexport function getNextBufferObj() {\n    for (var i = 1; i < buffers.length; ++i) {\n        var buffer = buffers[i];\n        if (buffer.s === 0) {\n            return buffer.h;\n        }\n    }\n    var next = buffers.length;\n    if (next < buffersMaxCount) {\n        var b = new BufferObj(next);\n        buffers.push(b);\n        return b.h;\n    }\n    return 0;\n}\nexport function _bufferDestroy(obj) {\n    if ((obj.s & 4 /* Stream */) !== 0 && obj.data) {\n        URL.revokeObjectURL(obj.data);\n    }\n    obj.s = 0;\n    obj.h = nextHandle(obj.h);\n    obj.data = null;\n}\nexport function _getBufferObj(buffer) {\n    var obj = buffers[buffer & iMask];\n    if (obj && obj.h === buffer) {\n        return obj;\n    }\n    return null;\n}\nfunction _fetchURL(filepath, cb) {\n    return fetch(new Request(filepath)).then(cb);\n}\nexport function _bufferMemory(obj, data, flags) {\n    obj.s |= 1 /* Active */;\n    var buffer = data.buffer.slice(data.byteOffset, data.byteOffset + data.byteLength);\n    if (flags & 4 /* Stream */) {\n        obj.s |= 4 /* Stream */;\n        obj.data = URL.createObjectURL(new Blob([buffer]));\n        obj.s |= 2 /* Loaded */;\n    }\n    else {\n        var ctx = getContext();\n        if (ctx) {\n            ctx.decodeAudioData(buffer).then(function (audioBuffer) {\n                obj.data = audioBuffer;\n                obj.s |= 2 /* Loaded */;\n            }).catch(function (reason) {\n                error(\"Error decode audio buffer\", reason);\n            });\n        }\n    }\n}\nexport function _bufferLoad(obj, filepath, flags) {\n    obj.s |= 1 /* Active */;\n    if (flags & 4 /* Stream */) {\n        obj.s |= 4 /* Stream */;\n        _fetchURL(filepath, function (response) { return response.blob(); }).then(function (blob) {\n            obj.data = URL.createObjectURL(blob);\n            obj.s |= 2 /* Loaded */;\n        }).catch(function (reason) {\n            error(\"can't load audio stream data \" + filepath, reason);\n        });\n    }\n    else {\n        var timeDecoding_1 = 0;\n        _fetchURL(filepath, function (response) { return response.arrayBuffer(); }).then(function (buffer) {\n            var ctx = getContext();\n            if (ctx) {\n                timeDecoding_1 = measure(0);\n                return ctx.decodeAudioData(buffer);\n            }\n            return null;\n        }).then(function (buffer) {\n            obj.data = buffer;\n            if (buffer) {\n                log(\"decoding time: \" + (measure(timeDecoding_1) | 0) + \" ms.\");\n                obj.s |= 2 /* Loaded */;\n            }\n        }).catch(function (reason) {\n            error(\"Error decoding audio buffer\", reason);\n        });\n    }\n}\n//# sourceMappingURL=Buffer.js.map","import { _streamPlayerResume, destroyStreamPlayersPool, getNextStreamPlayer } from \"./StreamPlayer\";\nimport { _setAudioParam, audioContextPause, audioContextResume, closeContext, getAudioContextObject, getContext, getContextState, initContext } from \"./Mixer\";\nimport { _getVoiceObj, _voiceChangeDestination, _voicePrepareBuffer, _voiceSetLoop, _voiceSetPitch, _voiceSetRunning, _voiceStartBuffer, _voiceStop, createVoiceObj, voicePool } from \"./Voice\";\nimport { _getBus, _getBusGain, _setBusConnected, busLine, initBusPool, termBusPool } from \"./Bus\";\nimport { error, log, warn } from \"./debug\";\nimport { DefaultBus, iMask, Mixer, tMask, Unit } from \"../protocol/interface\";\nimport { _bufferDestroy, _bufferLoad, _bufferMemory, _getBufferObj, buffers, getNextBufferObj } from \"./Buffer\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        buffers.length = 1;\n        destroyStreamPlayersPool();\n        closeContext(ctx);\n    }\n}\nexport function load(filepath, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var obj = buffers[handle & iMask];\n        _bufferLoad(obj, filepath, flags);\n    }\n    return handle;\n}\nexport function loadMemory(data, flags) {\n    var handle = getNextBufferObj();\n    if (handle) {\n        var obj = buffers[handle & iMask];\n        _bufferMemory(obj, data, flags);\n    }\n    return handle;\n}\nexport function unload(name) {\n    var obj = _getBufferObj(name);\n    if (obj) {\n        stop(name);\n        _bufferDestroy(obj);\n    }\n}\n/***\n *\n * @param buffer\n * @param gain\n * @param pan\n * @param rate\n * @param flags\n * @param bus\n */\nexport function voice(buffer, gain, pan, rate, flags, bus) {\n    // arguments check debug\n    if (flags & ~(2 /* Running */ | 4 /* Loop */)) {\n        error(\"Bad flags\");\n    }\n    ///\n    var ctx = getContext();\n    if (!ctx) {\n        return 0;\n    }\n    var bufferObj = _getBufferObj(buffer);\n    if (!bufferObj) {\n        warn(\"audio source not found\");\n        return 0;\n    }\n    if (!(bufferObj.s & 2 /* Loaded */)) {\n        warn(\"audio source is not loaded yet\");\n        return 0;\n    }\n    if (!bufferObj.data) {\n        warn(\"nothing to play, no audio data\");\n        return 0;\n    }\n    var targetNode = _getBusGain(bus ? bus : DefaultBus);\n    if (!targetNode) {\n        warn(\"invalid target bus!\");\n        return 0;\n    }\n    var voice = createVoiceObj();\n    if (voice === 0) {\n        log(\"no more free voices!\");\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    voiceObj.s = 1 /* Active */ | flags;\n    voiceObj.data = buffer;\n    voiceObj._rate = rate;\n    voiceObj._gain = gain;\n    voiceObj._pan = pan;\n    voiceObj.gain.gain.value = gain / Unit;\n    voiceObj.pan.pan.value = pan / Unit - 1;\n    if (bufferObj.s & 4 /* Stream */) {\n        var mes = getNextStreamPlayer(bufferObj.data);\n        if (!mes) {\n            log(\"no more free media stream elements!\");\n            return 0;\n        }\n        voiceObj.stream = mes;\n        mes.el.loop = !!(flags & 4 /* Loop */);\n        mes.node.connect(voiceObj.pan);\n        mes.el.onended = voiceObj._e;\n        if (flags & 2 /* Running */) {\n            _streamPlayerResume(mes);\n        }\n    }\n    else {\n        _voicePrepareBuffer(voiceObj, ctx, bufferObj.data);\n        if (flags & 2 /* Running */) {\n            _voiceStartBuffer(voiceObj);\n        }\n    }\n    // maybe we need to set target before `startBuffer()`\n    _voiceChangeDestination(voiceObj, targetNode);\n    _voiceSetPitch(voiceObj, rate);\n    return voice;\n}\nexport function stop(name) {\n    if (name === 0) {\n        return;\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            _voiceStop(obj);\n        }\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            for (var i = 1; i < voicePool.length; ++i) {\n                var v = voicePool[i];\n                if (v.data === name) {\n                    _voiceStop(v);\n                }\n            }\n        }\n        else {\n            warn(\"invalid buffer reference\");\n        }\n    }\n}\nexport function set(name, param, value) {\n    if (name === 0) {\n        return;\n    }\n    if (name === Mixer && (param & 128 /* Flags */) && (param & 2 /* Running */)) {\n        var ctx = getContext();\n        if (ctx) {\n            if (value && ctx.state === \"suspended\") {\n                audioContextResume(ctx);\n            }\n            else if (!value && ctx.state === \"running\") {\n                audioContextPause(ctx);\n            }\n        }\n    }\n    var type = name & tMask;\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                var enabled = value !== 0;\n                if (param & 2 /* Running */) {\n                    _voiceSetRunning(obj, enabled);\n                }\n                else if (param & 4 /* Loop */) {\n                    _voiceSetLoop(obj, enabled);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            obj._gain = value;\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    case 2 /* Pan */:\n                        if (obj._pan !== value) {\n                            obj._pan = value;\n                            _setAudioParam(obj.pan.pan, value / Unit - 1);\n                        }\n                        break;\n                    case 3 /* Rate */:\n                        _voiceSetPitch(obj, value);\n                        break;\n                    case 4 /* CurrentTime */:\n                        // TODO:\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            if (param & 128 /* Flags */) {\n                if (param & 2 /* Running */) {\n                    _setBusConnected(obj, !!value);\n                }\n            }\n            else {\n                switch (param) {\n                    case 1 /* Gain */:\n                        if (obj._gain !== value) {\n                            _setAudioParam(obj.gain.gain, value / Unit);\n                        }\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n}\nexport function get(name, param) {\n    if (name === Mixer) {\n        var ctx = getAudioContextObject();\n        if (ctx) {\n            if (param === 0 /* State */) {\n                return getContextState(ctx);\n            }\n            else if (param === 5 /* SampleRate */) {\n                return ctx.sampleRate | 0;\n            }\n        }\n        return 0;\n    }\n    var type = name & tMask;\n    if ((param & 256 /* Count */) && !(name & iMask)) {\n        var stateMask = param & 127 /* StateMask */;\n        if (type === 805306368 /* Voice */) {\n            return _countObjectsWithFlags(voicePool, stateMask);\n        }\n        else if (type === 268435456 /* Bus */) {\n            return _countObjectsWithFlags(busLine, stateMask);\n        }\n        else if (type === 536870912 /* Buffer */) {\n            return _countObjectsWithFlags(buffers, stateMask);\n        }\n        return 0;\n    }\n    if (type === 805306368 /* Voice */) {\n        var obj = _getVoiceObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                case 2 /* Pan */:\n                    return obj._pan;\n                case 3 /* Rate */:\n                    return obj._rate;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        d = obj.buffer.buffer.duration * Unit;\n                    }\n                    else if (obj.stream) {\n                        d = obj.stream.el.duration * Unit;\n                    }\n                    return (d * Unit) | 0;\n                }\n                case 4 /* CurrentTime */: {\n                    var d = 0.0;\n                    if (obj.buffer && obj.buffer.buffer) {\n                        // TODO: :(\n                    }\n                    else if (obj.stream) {\n                        d = obj.stream.el.currentTime;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(\"not supported\");\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 268435456 /* Bus */) {\n        var obj = _getBus(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 1 /* Gain */:\n                    return obj._gain;\n                default:\n                    warn(\"not supported\");\n                    break;\n            }\n        }\n        return 0;\n    }\n    else if (type === 536870912 /* Buffer */) {\n        var obj = _getBufferObj(name);\n        if (obj) {\n            switch (param) {\n                case 0 /* State */:\n                    return obj.s;\n                case 6 /* Duration */: {\n                    var d = 0.0;\n                    if (obj.s & 4 /* Stream */) {\n                        // TODO: :(\n                        warn(\"not supported\");\n                    }\n                    else if (obj.data) {\n                        d = obj.data.duration;\n                    }\n                    return (d * Unit) | 0;\n                }\n                default:\n                    warn(\"param not supported\");\n                    break;\n            }\n        }\n        return 0;\n    }\n    return 0;\n}\n/** private helpers **/\nfunction _countObjectsWithFlags(arr, mask) {\n    var cnt = 0;\n    for (var i = 1; i < arr.length; ++i) {\n        var obj = arr[i];\n        if (obj && (obj.s & mask) === mask) {\n            ++cnt;\n        }\n    }\n    return cnt;\n}\n//# sourceMappingURL=index.js.map","import { Mixer, Unit } from \"./protocol/interface\";\nimport * as Null from \"./null/index\";\nimport * as Browser from \"./webaudio/index\";\nfunction loadDriver() {\n    if (typeof process !== \"undefined\") {\n        //return require(__dirname + \"/../../../nodejs/index\");\n        return require(\"bindings\")(\"auph\");\n    }\n    else if (typeof auwa !== \"undefined\") {\n        return auwa;\n    }\n    else if (typeof AudioContext !== \"undefined\") {\n        //  || typeof webkitAudioContext !== \"undefined\"\n        window.auwa = Browser;\n        return Browser;\n    }\n    return Null;\n}\nvar _ = loadDriver();\nexport * from \"./protocol/static\";\nexport var init = _.init;\nexport var shutdown = _.shutdown;\nexport var set = _.set;\nexport var get = _.get;\nexport var load = _.load;\nexport var loadMemory = _.loadMemory;\nexport var unload = _.unload;\nexport var stop = _.stop;\nexport function pause(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, true);\n}\nexport function resume(name) {\n    if (name === void 0) { name = Mixer; }\n    setPause(name, false);\n}\nexport function play(buffer, gain, pan, rate, loop, paused, bus) {\n    if (gain === void 0) { gain = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (rate === void 0) { rate = 1.0; }\n    var flags = 0;\n    if (!!loop)\n        flags |= 4 /* Loop */;\n    if (!paused)\n        flags |= 2 /* Running */;\n    return _.voice(buffer, f2u(gain), f2u(+pan + 1), f2u(rate), flags, 0 | bus);\n}\nexport function getMixerStateString(state) {\n    return [\"closed\", \"paused\", \"\", \"running\"][state & 3];\n}\nexport function getBufferStateString(state) {\n    return [\"free\", \"loading\", \"\", \"loaded\"][state & 0x3] + [\"\", \" streaming\"][(state >>> 2) & 0x1];\n}\nexport function setGain(busOrVoice, value) {\n    set(busOrVoice, 1 /* Gain */, f2u(value));\n}\nexport function getGain(busOrVoice) {\n    return get(busOrVoice, 1 /* Gain */) / Unit;\n}\nexport function setPan(voice, pan) {\n    set(voice, 2 /* Pan */, f2u(+pan + 1));\n}\nexport function setRate(voice, rate) {\n    set(voice, 3 /* Rate */, f2u(rate));\n}\nexport function setPause(name, value) {\n    set(name, 128 /* Flags */ | 2 /* Running */, 0 | !value);\n}\nexport function setLoop(voice, value) {\n    set(voice, 128 /* Flags */ | 4 /* Loop */, 0 | value);\n}\nexport function getPan(voice) {\n    return get(voice, 2 /* Pan */) / Unit - 1;\n}\nexport function getRate(voice) {\n    return get(voice, 3 /* Rate */) / Unit;\n}\nexport function getPause(voice) {\n    return !(get(voice, 0 /* State */) & 2 /* Running */);\n}\nexport function getLoop(voice) {\n    return !!(get(voice, 0 /* State */) & 4 /* Loop */);\n}\nexport function getCurrentTime(voice) {\n    return get(voice, 4 /* CurrentTime */) / Unit;\n}\nexport function isActive(name) {\n    return !!(get(name, 0 /* State */) & 1 /* Active */);\n}\nexport function getDuration(name) {\n    return get(name, 6 /* Duration */) / Unit;\n}\nfunction f2u(x) {\n    return (x * Unit) | 0;\n}\n//# sourceMappingURL=index.js.map","import { Mixer } from \"./interface\";\n/** Export Constants only for pre-bundled usage **/\nexport var SAMPLE_RATE = 5 /* SampleRate */;\nexport var STATE = 0 /* State */;\nexport var COUNT = 256 /* Count */;\nexport var ACTIVE = 1 /* Active */;\nexport var RUNNING = 2 /* Running */;\nexport var STREAM = 4 /* Stream */;\nexport var LOOP = 4 /* Loop */;\nexport var MIXER = Mixer;\nexport var BUS = 268435456 /* Bus */;\nexport var VOICE = 805306368 /* Voice */;\nexport var BUFFER = 536870912 /* Buffer */;\nexport var BUS_MASTER = 268435456 /* Bus */ | 0;\nexport var BUS_SFX = 268435456 /* Bus */ | 1;\nexport var BUS_MUSIC = 268435456 /* Bus */ | 2;\nexport var BUS_SPEECH = 268435456 /* Bus */ | 3;\n//# sourceMappingURL=static.js.map"],"names":["tMask","iMask","Unit","filepath","flags","data","name","buffer","gain","pan","rate","bus","param","value","TAG","warn","message","console","error","reason","ctx","unlockEvents","unlocked","getContext","state","getAudioContextObject","audioContextResume","resume","then","catch","addEventListener","document","i","length","unlock","setupUnlockHandler","audioContextPause","suspend","removeEventListener","initContext","AudioContext","latencyHint","sampleRate","baseLatency","closeContext","_notNullCtx","close","_setAudioParam","emptyWaveData","StreamPlayer","el","node","this","StreamPlayer_isFree","player","src","StreamPlayer_stop","onended","pause","currentTime","disconnect","_streamPlayerResume","play","players","getNextStreamPlayer","mes","url","Audio","preload","createMediaElementSource","StreamPlayer_create","push","nextHandle","h","VoiceObj","index","_this","s","_gain","_pan","_rate","stream","_started","target","_e","_voiceStop","v","stop","_voiceResetDestination","_voiceStartBuffer","source","loop","start","_voiceSetPitch","playbackRate","voicePool","_getVoiceObj","handle","obj","createVoiceObj","createGain","createStereoPanner","connect","_voiceNew","BusObj","busLine","createBusObj","next","_getBus","BufferObj","buffers","getNextBufferObj","b","_getBufferObj","_fetchURL","cb","fetch","Request","type","_countObjectsWithFlags","arr","mask","cnt","master","destination","initBusPool","termBusPool","destroyStreamPlayersPool","response","blob","URL","createObjectURL","arrayBuffer","decodeAudioData","_bufferLoad","slice","byteOffset","byteLength","Blob","audioBuffer","_bufferMemory","revokeObjectURL","_bufferDestroy","bufferObj","targetNode","undefined","voice","voiceObj","createBufferSource","_voicePrepareBuffer","_voiceChangeDestination","enabled","_voiceSetRunning","_voiceSetLoop","connected","dest","_setBusConnected","getContextState","stateMask","d","duration","_","process","require","auwa","window","Browser","Null","init","shutdown","set","get","load","loadMemory","unload","setPause","f2u","x","busOrVoice","paused"],"mappings":"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"}