{"version":3,"file":"auph.js","sources":["../module/impl/debug.js","../module/impl/Context.js","../module/impl/StreamPlayer.js","../module/impl/Voice.js","../module/impl/AudioSource.js","../module/impl/Bus.js","../module/index.js"],"sourcesContent":["var TAG = \"[AUPH]\";\nexport function log(message) {\n    console.log(TAG, message);\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function measure(ts) {\n    if (ts === void 0) { ts = 0; }\n    return performance.now() - ts;\n}\n//# sourceMappingURL=debug.js.map","import { error, log, warn } from \"./debug\";\nvar ctx = null;\nvar unlockEvents = [\"mousedown\", \"pointerdown\", \"touchstart\"];\nvar unlocked = false;\nexport function getContext() {\n    if (!ctx) {\n        warn(\"not initialized\");\n        return null;\n    }\n    if (ctx.state === \"closed\") {\n        error(\"invalid state:\", \"Context is closed\");\n        return null;\n    }\n    return ctx;\n}\nexport function resumeAudioContext(ctx) {\n    log(\"resuming...\");\n    ctx.resume().then(function () {\n        log(\"resumed\");\n    }).catch(function (reason) {\n        if (!unlocked) {\n            log(\"cannot resume until user interaction, setup unlock handler...\");\n            setupUnlockHandler();\n        }\n        else {\n            error(\"error resuming AudioContext\", reason);\n        }\n    });\n}\nexport function suspendAudioContext(ctx) {\n    log(\"AudioContext suspending...\");\n    ctx.suspend().then(function () {\n        log(\"AudioContext suspended\");\n    }).catch(function (reason) {\n        error(\"error suspending AudioContext\", reason);\n    });\n}\nfunction unlock() {\n    unlocked = true;\n    var removeEventListener = document.removeEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        removeEventListener(unlockEvents[i], unlock);\n    }\n    if (ctx && ctx.state === \"suspended\") {\n        resumeAudioContext(ctx);\n    }\n}\nfunction setupUnlockHandler() {\n    var addEventListener = document.addEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        addEventListener(unlockEvents[i], unlock);\n    }\n}\nexport function initContext() {\n    if (ctx) {\n        warn(\"already initialized\");\n        return ctx;\n    }\n    ctx = new AudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: 22050\n    });\n    if (!ctx) {\n        error(\"error create AudioContext\");\n        return null;\n    }\n    if (ctx.state === \"running\") {\n        suspendAudioContext(ctx);\n    }\n    log(\"Latency: \" + ctx.baseLatency);\n    log(\"Sample rate: \" + ctx.sampleRate);\n    return ctx;\n}\nexport function closeContext(_notNullCtx) {\n    log(\"shutdown...\");\n    _notNullCtx.close().then(function () {\n        log(\"shutdown completed\");\n    }).catch(function (reason) {\n        error(\"shutdown error\", reason);\n    });\n    ctx = null;\n}\n//# sourceMappingURL=Context.js.map","import { getContext } from \"./Context\";\nimport { error, log } from \"./debug\";\nvar emptyWaveData = \"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=\";\nvar StreamPlayer = /** @class */ (function () {\n    function StreamPlayer(el, node) {\n        this.el = el;\n        this.node = node;\n    }\n    return StreamPlayer;\n}());\nexport { StreamPlayer };\nexport function StreamPlayer_create(ctx, url) {\n    var el = new Audio(url);\n    el.preload = \"auto\";\n    el[\"preservesPitch\"] = false;\n    return new StreamPlayer(el, ctx.createMediaElementSource(el));\n}\nexport function StreamPlayer_isFree(player) {\n    return player.el.src === emptyWaveData;\n}\nexport function StreamPlayer_stop(player) {\n    var el = player.el;\n    if (el.src !== emptyWaveData) {\n        el.pause();\n        el.src = emptyWaveData;\n        el.currentTime = 0;\n        player.node.disconnect();\n    }\n}\nexport function StreamPlayer_resume(player) {\n    player.el.play().then(function () {\n        log(\"started stream player\");\n    }).catch(function (reason) {\n        error(\"error on play stream\", reason);\n    });\n}\nvar players = [];\nvar playersMaxCount = 4;\nexport function getNextStreamPlayer(src) {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        if (StreamPlayer_isFree(player)) {\n            player.el.src = src;\n            return player;\n        }\n    }\n    if (players.length < playersMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var mes = StreamPlayer_create(ctx, src);\n            players.push(mes);\n            return mes;\n        }\n    }\n    return null;\n}\nexport function destroyStreamPlayersPool() {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        StreamPlayer_stop(player);\n        player.el.src = \"\";\n    }\n    players.length = 0;\n}\nexport function getStreamPlayersCount() {\n    var count = 0;\n    for (var i = 0; i < players.length; ++i) {\n        if (!StreamPlayer_isFree(players[i])) {\n            ++count;\n        }\n    }\n    return count;\n}\n//# sourceMappingURL=StreamPlayer.js.map","import { StreamPlayer_resume, StreamPlayer_stop } from \"./StreamPlayer\";\nimport { getContext } from \"./Context\";\nvar vMask = 0xFFFF00;\nvar vIncr = 0x000100;\nvar iMask = 0x0000FF;\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan) {\n        this.gain = gain;\n        this.pan = pan;\n        this.stream = null;\n        // buffer playback\n        this.buffer = null;\n        // common nodes\n        // \"Pitch\" / \"Playback Rate\"\n        this.rate = 1.0;\n        // Control Flags\n        this.cf = 0;\n        this.target = null;\n        this.src = 0;\n        // handle version (maybe will add index as well)\n        this.v = 0;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function Voice_create(ctx) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan);\n}\nexport function Voice_changeDestination(v, target) {\n    if (target !== v.target) {\n        var gain = v.gain;\n        if (v.target) {\n            gain.disconnect(v.target);\n        }\n        v.target = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function Voice_resetDestination(v) {\n    if (v.target) {\n        v.gain.disconnect(v.target);\n        v.target = null;\n    }\n}\nexport function Voice_stop(v) {\n    // stop stream\n    if (v.stream) {\n        StreamPlayer_stop(v.stream);\n        v.stream = null;\n    }\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.cf & 1 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.disconnect();\n        v.buffer = null;\n    }\n    Voice_resetDestination(v);\n    v.src = 0;\n    v.cf = 0;\n    v.v = (v.v + vIncr) & vMask;\n}\nexport function Voice_startBuffer(v) {\n    if ((v.cf & 1 /* Running */) === 0) {\n        var source = v.buffer;\n        if (source) {\n            source.addEventListener(\"ended\", function (e) {\n                // maybe check is useless\n                if (v.buffer === e.target) {\n                    Voice_stop(v);\n                }\n            });\n            source.loop = (v.cf & 4 /* Loop */) !== 0;\n            source.start();\n            v.cf |= 1 /* Running */;\n        }\n    }\n}\nexport function Voice_prepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n}\nexport function Voice_loop(v, value) {\n    var current = (v.cf & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.cf ^= 4 /* Loop */;\n        if (v.stream) {\n            v.stream.el.loop = value;\n        }\n        else if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function Voice_pause(v, value) {\n    var paused = (v.cf & 2 /* Paused */) !== 0;\n    if (value !== paused) {\n        v.cf ^= 2 /* Paused */;\n        if (value) {\n            if (v.stream) {\n                v.stream.el.pause();\n            }\n            else if (v.buffer) {\n                v.buffer.playbackRate.value = 0.0;\n            }\n        }\n        else {\n            if (v.stream) {\n                StreamPlayer_resume(v.stream);\n            }\n            else if (v.buffer) {\n                v.buffer.playbackRate.value = v.rate;\n                // restart if play called in pause mode\n                Voice_startBuffer(v);\n            }\n        }\n    }\n}\nexport function Voice_pitch(v, value) {\n    if (v.rate !== value) {\n        v.rate = value;\n        if (v.stream) {\n            v.stream.el.playbackRate = value;\n        }\n        else if (v.buffer) {\n            if (!(v.cf & 2 /* Paused */)) {\n                v.buffer.playbackRate.value = value;\n            }\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _checkVoiceHandle(handle) {\n    var obj = voicePool[handle & iMask];\n    return !!obj && obj.v === (handle & vMask);\n}\nexport function _getVoiceObjAt(index) {\n    return voicePool[index];\n}\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.v === (handle & vMask)) ? obj : null;\n}\nexport function getNextVoice() {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.src === 0) {\n            return i | v.v;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            voicePool.push(Voice_create(ctx));\n            return index;\n        }\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","var AudioSourceObj = /** @class */ (function () {\n    function AudioSourceObj() {\n        this.isFree = true;\n        this.url = null;\n        this.buffer = null;\n    }\n    return AudioSourceObj;\n}());\nexport { AudioSourceObj };\nexport var audioSources = [null];\n//# sourceMappingURL=AudioSource.js.map","import { getContext } from \"./Context\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain, e) {\n        if (e === void 0) { e = true; }\n        this.gain = gain;\n        this.e = e;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nvar busPool = [];\nexport function Bus_create(ctx) {\n    var obj = new BusObj(ctx.createGain());\n    busPool.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = Bus_create(ctx).gain;\n    master.connect(ctx.destination);\n    Bus_create(ctx).gain.connect(master);\n    Bus_create(ctx).gain.connect(master);\n    Bus_create(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busPool.length; ++i) {\n        busPool[i].gain.disconnect();\n    }\n    busPool.length = 0;\n}\nexport function _getBus(handle) {\n    return busPool[handle];\n}\nexport function _getBusGain(handle) {\n    var _a;\n    return (_a = _getBus(handle)) === null || _a === void 0 ? void 0 : _a.gain;\n}\nexport function Bus_enable(bus, enabled) {\n    if (bus.e !== enabled) {\n        var master = busPool[0];\n        var dest = bus === master ? getContext().destination : master.gain;\n        if (enabled) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.e = enabled;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { destroyStreamPlayersPool, getNextStreamPlayer, getStreamPlayersCount, StreamPlayer_resume } from \"./impl/StreamPlayer\";\nimport { closeContext, getContext, initContext, resumeAudioContext } from \"./impl/Context\";\nimport { _checkVoiceHandle, _getVoiceObj, getNextVoice, Voice_changeDestination, Voice_loop, Voice_pause, Voice_pitch, Voice_prepareBuffer, Voice_startBuffer, Voice_stop, voicePool } from \"./impl/Voice\";\nimport { AudioSourceObj, audioSources } from \"./impl/AudioSource\";\nimport { _getBus, _getBusGain, Bus_enable, initBusPool, termBusPool } from \"./impl/Bus\";\nimport { error, log, measure, warn } from \"./impl/debug\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function resume() {\n    var ctx = getContext();\n    if (ctx && ctx.state === \"suspended\") {\n        resumeAudioContext(ctx);\n    }\n}\nexport function pause() {\n    var ctx = getContext();\n    if (ctx && ctx.state === \"running\") {\n        log(\"pausing\");\n        ctx.suspend().then(function () {\n            log(\"paused\");\n        }).catch(function (reason) {\n            error(\"pause error\", reason);\n        });\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        audioSources.length = 1;\n        destroyStreamPlayersPool();\n        closeContext(ctx);\n    }\n}\n/*** Context State ***/\nexport function getInteger(param) {\n    switch (param) {\n        case VOICES_IN_USE: {\n            var count = 0;\n            for (var i = 1; i < voicePool.length; ++i) {\n                if (voicePool[i].buffer) {\n                    ++count;\n                }\n            }\n            return count;\n        }\n        case STREAMS_IN_USE: {\n            return getStreamPlayersCount();\n        }\n        case BUFFERS_LOADED: {\n            return 0;\n        }\n        case STREAMS_LOADED: {\n            return 0;\n        }\n        case SAMPLE_RATE: {\n            var ctx = getContext();\n            return ctx ? ctx.sampleRate : 0;\n        }\n    }\n    return -1;\n}\n/**\n * private function to get native HTMl5 AudioContext\n */\nexport function _getAudioContext() {\n    return getContext();\n}\n/***/\nexport function loadAudioSource(filepath, streaming) {\n    if (!getContext()) {\n        return 0;\n    }\n    var handle = 0;\n    for (var i = 1; i < audioSources.length; ++i) {\n        if (audioSources[i].isFree) {\n            handle = i;\n        }\n    }\n    if (handle === 0) {\n        audioSources.push(new AudioSourceObj());\n        handle = audioSources.length - 1;\n    }\n    var obj = audioSources[handle];\n    obj.isFree = false;\n    if (streaming) {\n        obj.url = filepath;\n    }\n    else {\n        var timeDecoding_1 = 0;\n        fetch(new Request(filepath)).then(function (response) {\n            return response.arrayBuffer();\n        }).then(function (buffer) {\n            var ctx = getContext();\n            if (ctx) {\n                timeDecoding_1 = measure();\n                return ctx.decodeAudioData(buffer);\n            }\n            return null;\n        }).then(function (buffer) {\n            obj.buffer = buffer;\n            if (buffer) {\n                log(\"decoding time: \" + (measure(timeDecoding_1) | 0) + \" ms.\");\n            }\n        }).catch(function (reason) {\n            error(\"can't load audio buffer from \" + filepath, reason);\n        });\n    }\n    return handle;\n}\nexport function destroyAudioSource(source) {\n    if (source === 0) {\n        return;\n    }\n    stopAudioSource(source);\n    var sourceObj = audioSources[source];\n    if (sourceObj) {\n        sourceObj.buffer = null;\n        sourceObj.url = null;\n        sourceObj.isFree = true;\n    }\n}\nexport var INFINITE_LOOPING = 0x40000000; // for SMI optimization we use 31-th bit\n/***\n *\n * @param source\n * @param volume\n * @param pan\n * @param pitch\n * @param paused\n * @param loop\n * @param bus\n */\nexport function play(source, volume, pan, pitch, paused, loop, bus) {\n    if (volume === void 0) { volume = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (pitch === void 0) { pitch = 1.0; }\n    if (paused === void 0) { paused = false; }\n    if (loop === void 0) { loop = false; }\n    if (bus === void 0) { bus = 1; }\n    if (source === 0) {\n        return 0;\n    }\n    var ctx = getContext();\n    if (!ctx) {\n        return 0;\n    }\n    var sourceObj = audioSources[source];\n    if (!sourceObj || sourceObj.isFree) {\n        warn(\"audio source not found\");\n        return 0;\n    }\n    if (!sourceObj.url && !sourceObj.buffer) {\n        warn(\"nothing to play, audio source is empty!\");\n        return 0;\n    }\n    var targetNode = _getBusGain(bus);\n    if (!targetNode) {\n        warn(\"invalid target bus!\");\n        return 0;\n    }\n    var voice = getNextVoice();\n    if (!voice) {\n        warn(\"no more free simple voices!\");\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    if (loop) {\n        voiceObj.cf |= 4 /* Loop */;\n    }\n    if (paused) {\n        voiceObj.cf |= 2 /* Paused */;\n    }\n    voiceObj.rate = 1.0;\n    voiceObj.src = source;\n    voiceObj.gain.gain.value = volume;\n    voiceObj.pan.pan.value = pan;\n    if (sourceObj.url) {\n        var mes = getNextStreamPlayer(sourceObj.url);\n        if (!mes) {\n            warn(\"no more free media stream elements!\");\n            return 0;\n        }\n        voiceObj.stream = mes;\n        mes.el.loop = loop;\n        mes.node.connect(voiceObj.pan);\n        if (!paused) {\n            StreamPlayer_resume(mes);\n            voiceObj.cf |= 1 /* Running */;\n        }\n    }\n    else if (sourceObj.buffer) {\n        Voice_prepareBuffer(voiceObj, ctx, sourceObj.buffer);\n        if (!paused) {\n            Voice_startBuffer(voiceObj);\n        }\n    }\n    // maybe we need to set target before `startBuffer()`\n    Voice_changeDestination(voiceObj, targetNode);\n    Voice_pitch(voiceObj, pitch);\n    return voice;\n}\nexport function stop(voice) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_stop(obj);\n    }\n}\nexport function isVoiceValid(voice) {\n    return _checkVoiceHandle(voice);\n}\nexport function getVoiceState(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.cf : 0;\n}\nexport function setPan(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        obj.pan.pan.value = value;\n    }\n}\nexport function setVolume(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        obj.gain.gain.value = value;\n    }\n}\nexport function setPitch(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_pitch(obj, value);\n    }\n}\nexport function setPause(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_pause(obj, value);\n    }\n}\nexport function setLoop(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_loop(obj, value);\n    }\n}\nexport function getPan(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.pan.pan.value : 0.0;\n}\nexport function getVolume(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.gain.gain.value : 1.0;\n}\nexport function getPitch(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.rate : 1.0;\n}\nexport function getPause(voice) {\n    var obj = _getVoiceObj(voice);\n    return !!obj && (obj.cf & 2 /* Paused */) !== 0;\n}\nexport function getLoop(voice) {\n    var obj = _getVoiceObj(voice);\n    return !!obj && (obj.cf & 4 /* Loop */) !== 0;\n}\nexport function stopAudioSource(source) {\n    if (source === 0) {\n        console.warn(\"invalid source\");\n        return;\n    }\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.src === source) {\n            Voice_stop(v);\n        }\n    }\n}\n/** Bus controls **/\nexport function setBusVolume(bus, value) {\n    var gain = _getBusGain(bus);\n    if (gain) {\n        gain.gain.value = value;\n    }\n}\nexport function getBusVolume(bus) {\n    var gain = _getBusGain(bus);\n    return gain ? gain.gain.value : 0.0;\n}\nexport function setBusEnabled(bus, enabled) {\n    var obj = _getBus(bus);\n    if (obj) {\n        Bus_enable(obj, enabled);\n    }\n}\nexport function getBusEnabled(bus) {\n    var obj = _getBus(bus);\n    return !!obj && obj.e;\n}\n/** length / position **/\nexport function getAudioSourceLength(source) {\n    var d = 0.0;\n    if (source !== 0) {\n        var obj = audioSources[source];\n        if (obj) {\n            if (obj.buffer) {\n                obj.buffer.duration;\n            }\n            else if (obj.url) {\n                // TODO: :(\n            }\n        }\n    }\n    return d;\n}\nexport function getVoiceLength(voice) {\n    var obj = _getVoiceObj(voice);\n    var d = 0.0;\n    if (obj) {\n        if (obj.buffer && obj.buffer.buffer) {\n            d = obj.buffer.buffer.duration;\n        }\n        else if (obj.stream) {\n            d = obj.stream.el.duration;\n        }\n    }\n    return d;\n}\nexport function getVoicePosition(voice) {\n    var obj = _getVoiceObj(voice);\n    var d = 0.0;\n    if (obj) {\n        if (obj.buffer && obj.buffer) {\n            // TODO: :(\n        }\n        else if (obj.stream) {\n            d = obj.stream.el.currentTime;\n        }\n    }\n    return d;\n}\n/** Export Constants only for pre-bundled usage **/\nexport var VOICES_IN_USE = 0 /* VoicesInUse */;\nexport var STREAMS_IN_USE = 1 /* StreamsInUse */;\nexport var BUFFERS_LOADED = 2 /* BuffersLoaded */;\nexport var STREAMS_LOADED = 3 /* StreamsLoaded */;\nexport var SAMPLE_RATE = 4 /* SampleRate */;\n//# sourceMappingURL=index.js.map"],"names":["TAG","log","message","console","warn","error","reason","measure","ts","performance","now","ctx","unlockEvents","unlocked","getContext","state","resumeAudioContext","resume","then","catch","addEventListener","document","i","length","unlock","setupUnlockHandler","removeEventListener","initContext","AudioContext","latencyHint","sampleRate","suspend","suspendAudioContext","baseLatency","closeContext","_notNullCtx","close","emptyWaveData","StreamPlayer","el","node","this","StreamPlayer_isFree","player","src","StreamPlayer_stop","pause","currentTime","disconnect","StreamPlayer_resume","play","players","getNextStreamPlayer","mes","url","Audio","preload","createMediaElementSource","StreamPlayer_create","push","vMask","VoiceObj","gain","pan","stream","buffer","rate","cf","target","v","Voice_stop","stop","Voice_resetDestination","Voice_startBuffer","source","e","loop","start","Voice_pitch","value","playbackRate","voicePool","_getVoiceObj","handle","obj","getNextVoice","index","createGain","createStereoPanner","connect","Voice_create","AudioSourceObj","isFree","audioSources","BusObj","busPool","Bus_create","_getBus","_getBusGain","_a","stopAudioSource","VOICES_IN_USE","STREAMS_IN_USE","BUFFERS_LOADED","STREAMS_LOADED","SAMPLE_RATE","sourceObj","duration","bus","param","count","getStreamPlayersCount","voice","d","master","destination","initBusPool","filepath","streaming","timeDecoding_1","fetch","Request","response","arrayBuffer","decodeAudioData","volume","pitch","paused","targetNode","voiceObj","audioBuffer","createBufferSource","Voice_prepareBuffer","Voice_changeDestination","enabled","dest","Bus_enable","Voice_loop","Voice_pause","termBusPool","destroyStreamPlayersPool"],"mappings":"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"}