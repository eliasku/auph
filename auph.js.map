{"version":3,"file":"auph.js","sources":["../module/impl/debug.js","../module/impl/Context.js","../module/impl/StreamPlayer.js","../module/impl/Voice.js","../module/impl/AudioSource.js","../module/impl/Bus.js","../module/index.js"],"sourcesContent":["var TAG = \"[AUPH]\";\nexport function log(message) {\n    console.log(TAG, message);\n}\nexport function warn(message) {\n    console.warn(TAG, message);\n}\nexport function error(message, reason) {\n    console.error(TAG, message, reason);\n}\nexport function measure(ts) {\n    if (ts === void 0) { ts = 0; }\n    return performance.now() - ts;\n}\n//# sourceMappingURL=debug.js.map","import { error, log, warn } from \"./debug\";\nvar ctx = null;\nvar unlockEvents = [\"mousedown\", \"pointerdown\", \"touchstart\"];\nvar unlocked = false;\nexport function getContext() {\n    if (!ctx) {\n        warn(\"not initialized\");\n        return null;\n    }\n    if (ctx.state === \"closed\") {\n        error(\"invalid state:\", \"Context is closed\");\n        return null;\n    }\n    return ctx;\n}\nexport function getContextState() {\n    var state = 0 /* Invalid */;\n    if (ctx) {\n        if (ctx.state === \"suspended\") {\n            state = 2 /* Paused */;\n        }\n        else if (ctx.state === \"running\") {\n            state = 1 /* Running */;\n        }\n    }\n    return state;\n}\nexport function resumeAudioContext(ctx) {\n    log(\"resuming...\");\n    ctx.resume().then(function () {\n        log(\"resumed\");\n    }).catch(function (reason) {\n        if (!unlocked) {\n            log(\"cannot resume until user interaction, setup unlock handler...\");\n            setupUnlockHandler();\n        }\n        else {\n            error(\"error resuming AudioContext\", reason);\n        }\n    });\n}\nexport function suspendAudioContext(ctx) {\n    log(\"AudioContext suspending...\");\n    ctx.suspend().then(function () {\n        log(\"AudioContext suspended\");\n    }).catch(function (reason) {\n        error(\"error suspending AudioContext\", reason);\n    });\n}\nfunction unlock() {\n    unlocked = true;\n    var removeEventListener = document.removeEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        removeEventListener(unlockEvents[i], unlock);\n    }\n    if (ctx && ctx.state === \"suspended\") {\n        resumeAudioContext(ctx);\n    }\n}\nfunction setupUnlockHandler() {\n    var addEventListener = document.addEventListener;\n    for (var i = 0; i < unlockEvents.length; ++i) {\n        addEventListener(unlockEvents[i], unlock);\n    }\n}\nexport function initContext() {\n    if (ctx) {\n        warn(\"already initialized\");\n        return ctx;\n    }\n    ctx = new AudioContext({\n        latencyHint: \"interactive\",\n        sampleRate: 22050\n    });\n    if (!ctx) {\n        error(\"error create AudioContext\");\n        return null;\n    }\n    if (ctx.state === \"running\") {\n        suspendAudioContext(ctx);\n    }\n    log(\"Latency: \" + ctx.baseLatency);\n    log(\"Sample rate: \" + ctx.sampleRate);\n    return ctx;\n}\nexport function closeContext(_notNullCtx) {\n    log(\"shutdown...\");\n    _notNullCtx.close().then(function () {\n        log(\"shutdown completed\");\n    }).catch(function (reason) {\n        error(\"shutdown error\", reason);\n    });\n    ctx = null;\n}\n//# sourceMappingURL=Context.js.map","import { getContext } from \"./Context\";\nimport { error, log } from \"./debug\";\nvar emptyWaveData = \"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAVFYAAFRWAAABAAgAZGF0YQAAAAA=\";\nvar StreamPlayer = /** @class */ (function () {\n    function StreamPlayer(el, node) {\n        this.el = el;\n        this.node = node;\n    }\n    return StreamPlayer;\n}());\nexport { StreamPlayer };\nexport function StreamPlayer_create(ctx, url) {\n    var el = new Audio(url);\n    el.preload = \"auto\";\n    el[\"preservesPitch\"] = false;\n    return new StreamPlayer(el, ctx.createMediaElementSource(el));\n}\nexport function StreamPlayer_isFree(player) {\n    return player.el.src === emptyWaveData;\n}\nexport function StreamPlayer_stop(player) {\n    var el = player.el;\n    if (el.src !== emptyWaveData) {\n        el.pause();\n        el.src = emptyWaveData;\n        el.currentTime = 0;\n        player.node.disconnect();\n    }\n}\nexport function StreamPlayer_resume(player) {\n    player.el.play().then(function () {\n        log(\"started stream player\");\n    }).catch(function (reason) {\n        error(\"error on play stream\", reason);\n    });\n}\nvar players = [];\nvar playersMaxCount = 4;\nexport function getNextStreamPlayer(src) {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        if (StreamPlayer_isFree(player)) {\n            player.el.src = src;\n            return player;\n        }\n    }\n    if (players.length < playersMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            var mes = StreamPlayer_create(ctx, src);\n            players.push(mes);\n            return mes;\n        }\n    }\n    return null;\n}\nexport function destroyStreamPlayersPool() {\n    for (var i = 0; i < players.length; ++i) {\n        var player = players[i];\n        StreamPlayer_stop(player);\n        player.el.src = \"\";\n    }\n    players.length = 0;\n}\nexport function getStreamPlayersCount() {\n    var count = 0;\n    for (var i = 0; i < players.length; ++i) {\n        if (!StreamPlayer_isFree(players[i])) {\n            ++count;\n        }\n    }\n    return count;\n}\n//# sourceMappingURL=StreamPlayer.js.map","import { StreamPlayer_resume, StreamPlayer_stop } from \"./StreamPlayer\";\nimport { getContext } from \"./Context\";\nvar vMask = 0xFFFF00;\nvar vIncr = 0x000100;\nvar iMask = 0x0000FF;\nvar VoiceObj = /** @class */ (function () {\n    function VoiceObj(gain, pan) {\n        this.gain = gain;\n        this.pan = pan;\n        this.stream = null;\n        // buffer playback\n        this.buffer = null;\n        // common nodes\n        // \"Pitch\" / \"Playback Rate\"\n        this.rate = 1.0;\n        // Control Flags\n        this.cf = 0;\n        this.target = null;\n        this.src = 0;\n        // handle version (maybe will add index as well)\n        this.v = 0;\n    }\n    return VoiceObj;\n}());\nexport { VoiceObj };\nexport function Voice_create(ctx) {\n    var gain = ctx.createGain();\n    var pan = ctx.createStereoPanner();\n    pan.connect(gain);\n    return new VoiceObj(gain, pan);\n}\nexport function Voice_changeDestination(v, target) {\n    if (target !== v.target) {\n        var gain = v.gain;\n        if (v.target) {\n            gain.disconnect(v.target);\n        }\n        v.target = target;\n        if (target) {\n            gain.connect(target);\n        }\n    }\n}\nexport function Voice_resetDestination(v) {\n    if (v.target) {\n        v.gain.disconnect(v.target);\n        v.target = null;\n    }\n}\nexport function Voice_stop(v) {\n    // stop stream\n    if (v.stream) {\n        StreamPlayer_stop(v.stream);\n        v.stream = null;\n    }\n    // stop buffer\n    var buffer = v.buffer;\n    if (buffer) {\n        if ((v.cf & 1 /* Running */) !== 0) {\n            buffer.stop();\n        }\n        buffer.disconnect();\n        v.buffer = null;\n    }\n    Voice_resetDestination(v);\n    v.src = 0;\n    v.cf = 0;\n    v.v = (v.v + vIncr) & vMask;\n}\nexport function Voice_startBuffer(v) {\n    if ((v.cf & 1 /* Running */) === 0) {\n        var source = v.buffer;\n        if (source) {\n            source.addEventListener(\"ended\", function (e) {\n                // maybe check is useless\n                if (v.buffer === e.target) {\n                    Voice_stop(v);\n                }\n            });\n            source.loop = (v.cf & 4 /* Loop */) !== 0;\n            source.start();\n            v.cf |= 1 /* Running */;\n        }\n    }\n}\nexport function Voice_prepareBuffer(v, ctx, audioBuffer) {\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(v.pan);\n    v.buffer = source;\n}\nexport function Voice_loop(v, value) {\n    var current = (v.cf & 4 /* Loop */) !== 0;\n    if (value !== current) {\n        v.cf ^= 4 /* Loop */;\n        if (v.stream) {\n            v.stream.el.loop = value;\n        }\n        else if (v.buffer) {\n            v.buffer.loop = value;\n        }\n    }\n}\nexport function Voice_pause(v, value) {\n    var paused = (v.cf & 2 /* Paused */) !== 0;\n    if (value !== paused) {\n        v.cf ^= 2 /* Paused */;\n        if (value) {\n            if (v.stream) {\n                v.stream.el.pause();\n            }\n            else if (v.buffer) {\n                v.buffer.playbackRate.value = 0.0;\n            }\n        }\n        else {\n            if (v.stream) {\n                StreamPlayer_resume(v.stream);\n            }\n            else if (v.buffer) {\n                v.buffer.playbackRate.value = v.rate;\n                // restart if play called in pause mode\n                Voice_startBuffer(v);\n            }\n        }\n    }\n}\nexport function Voice_pitch(v, value) {\n    if (v.rate !== value) {\n        v.rate = value;\n        if (v.stream) {\n            v.stream.el.playbackRate = value;\n        }\n        else if (v.buffer) {\n            if (!(v.cf & 2 /* Paused */)) {\n                v.buffer.playbackRate.value = value;\n            }\n        }\n    }\n}\nexport var voicePool = [null];\nvar voicesMaxCount = 64;\nexport function _checkVoiceHandle(handle) {\n    var obj = voicePool[handle & iMask];\n    return !!obj && obj.v === (handle & vMask);\n}\nexport function _getVoiceObjAt(index) {\n    return voicePool[index];\n}\nexport function _getVoiceObj(handle) {\n    var obj = voicePool[handle & iMask];\n    return (obj && obj.v === (handle & vMask)) ? obj : null;\n}\nexport function getNextVoice() {\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.src === 0) {\n            return i | v.v;\n        }\n    }\n    var index = voicePool.length;\n    if (index < voicesMaxCount) {\n        var ctx = getContext();\n        if (ctx) {\n            voicePool.push(Voice_create(ctx));\n            return index;\n        }\n    }\n    return 0;\n}\n//# sourceMappingURL=Voice.js.map","var AudioSourceObj = /** @class */ (function () {\n    function AudioSourceObj() {\n        this.isFree = true;\n        this.url = null;\n        this.buffer = null;\n    }\n    return AudioSourceObj;\n}());\nexport { AudioSourceObj };\nexport var audioSources = [null];\n//# sourceMappingURL=AudioSource.js.map","import { getContext } from \"./Context\";\nvar BusObj = /** @class */ (function () {\n    function BusObj(gain, e) {\n        if (e === void 0) { e = true; }\n        this.gain = gain;\n        this.e = e;\n    }\n    return BusObj;\n}());\nexport { BusObj };\nvar busPool = [];\nexport function Bus_create(ctx) {\n    var obj = new BusObj(ctx.createGain());\n    busPool.push(obj);\n    return obj;\n}\nexport function initBusPool(ctx) {\n    var master = Bus_create(ctx).gain;\n    master.connect(ctx.destination);\n    Bus_create(ctx).gain.connect(master);\n    Bus_create(ctx).gain.connect(master);\n    Bus_create(ctx).gain.connect(master);\n}\nexport function termBusPool() {\n    for (var i = 0; i < busPool.length; ++i) {\n        busPool[i].gain.disconnect();\n    }\n    busPool.length = 0;\n}\nexport function _getBus(handle) {\n    return busPool[handle];\n}\nexport function _getBusGain(handle) {\n    var _a;\n    return (_a = _getBus(handle)) === null || _a === void 0 ? void 0 : _a.gain;\n}\nexport function Bus_enable(bus, enabled) {\n    if (bus.e !== enabled) {\n        var master = busPool[0];\n        var dest = bus === master ? getContext().destination : master.gain;\n        if (enabled) {\n            bus.gain.connect(dest);\n        }\n        else {\n            bus.gain.disconnect(dest);\n        }\n        bus.e = enabled;\n    }\n}\n//# sourceMappingURL=Bus.js.map","import { destroyStreamPlayersPool, getNextStreamPlayer, getStreamPlayersCount, StreamPlayer_resume } from \"./impl/StreamPlayer\";\nimport { closeContext, getContext, getContextState, initContext, resumeAudioContext } from \"./impl/Context\";\nimport { _checkVoiceHandle, _getVoiceObj, getNextVoice, Voice_changeDestination, Voice_loop, Voice_pause, Voice_pitch, Voice_prepareBuffer, Voice_startBuffer, Voice_stop, voicePool } from \"./impl/Voice\";\nimport { AudioSourceObj, audioSources } from \"./impl/AudioSource\";\nimport { _getBus, _getBusGain, Bus_enable, initBusPool, termBusPool } from \"./impl/Bus\";\nimport { error, log, measure, warn } from \"./impl/debug\";\nexport function init() {\n    var ctx = initContext();\n    if (ctx) {\n        initBusPool(ctx);\n    }\n}\nexport function resume() {\n    var ctx = getContext();\n    if (ctx && ctx.state === \"suspended\") {\n        resumeAudioContext(ctx);\n    }\n}\nexport function pause() {\n    var ctx = getContext();\n    if (ctx && ctx.state === \"running\") {\n        log(\"pausing\");\n        ctx.suspend().then(function () {\n            log(\"paused\");\n        }).catch(function (reason) {\n            error(\"pause error\", reason);\n        });\n    }\n}\nexport function shutdown() {\n    var ctx = getContext();\n    if (ctx) {\n        termBusPool();\n        voicePool.length = 1;\n        audioSources.length = 1;\n        destroyStreamPlayersPool();\n        closeContext(ctx);\n    }\n}\n/*** Context State ***/\nexport function getInteger(param) {\n    switch (param) {\n        case VOICES_IN_USE: {\n            var count = 0;\n            for (var i = 1; i < voicePool.length; ++i) {\n                if (voicePool[i].buffer) {\n                    ++count;\n                }\n            }\n            return count;\n        }\n        case STREAMS_IN_USE: {\n            return getStreamPlayersCount();\n        }\n        case BUFFERS_LOADED: {\n            return 0;\n        }\n        case STREAMS_LOADED: {\n            return 0;\n        }\n        case DEVICE_SAMPLE_RATE: {\n            var ctx = getContext();\n            return ctx ? ctx.sampleRate : 0;\n        }\n        case DEVICE_STATE: {\n            return getContextState();\n        }\n    }\n    return 0;\n}\n/**\n * private function to get native HTMl5 AudioContext\n */\nexport function _getAudioContext() {\n    return getContext();\n}\n/***/\nexport function loadAudioSource(filepath, streaming) {\n    if (!getContext()) {\n        return 0;\n    }\n    var handle = 0;\n    for (var i = 1; i < audioSources.length; ++i) {\n        if (audioSources[i].isFree) {\n            handle = i;\n        }\n    }\n    if (handle === 0) {\n        audioSources.push(new AudioSourceObj());\n        handle = audioSources.length - 1;\n    }\n    var obj = audioSources[handle];\n    obj.isFree = false;\n    if (streaming) {\n        obj.url = filepath;\n    }\n    else {\n        var timeDecoding_1 = 0;\n        fetch(new Request(filepath)).then(function (response) {\n            return response.arrayBuffer();\n        }).then(function (buffer) {\n            var ctx = getContext();\n            if (ctx) {\n                timeDecoding_1 = measure();\n                return ctx.decodeAudioData(buffer);\n            }\n            return null;\n        }).then(function (buffer) {\n            obj.buffer = buffer;\n            if (buffer) {\n                log(\"decoding time: \" + (measure(timeDecoding_1) | 0) + \" ms.\");\n            }\n        }).catch(function (reason) {\n            error(\"can't load audio buffer from \" + filepath, reason);\n        });\n    }\n    return handle;\n}\nexport function destroyAudioSource(source) {\n    if (source === 0) {\n        return;\n    }\n    stopAudioSource(source);\n    var sourceObj = audioSources[source];\n    if (sourceObj) {\n        sourceObj.buffer = null;\n        sourceObj.url = null;\n        sourceObj.isFree = true;\n    }\n}\nexport var INFINITE_LOOPING = 0x40000000; // for SMI optimization we use 31-th bit\n/***\n *\n * @param source\n * @param volume\n * @param pan\n * @param pitch\n * @param paused\n * @param loop\n * @param bus\n */\nexport function play(source, volume, pan, pitch, paused, loop, bus) {\n    if (volume === void 0) { volume = 1.0; }\n    if (pan === void 0) { pan = 0.0; }\n    if (pitch === void 0) { pitch = 1.0; }\n    if (paused === void 0) { paused = false; }\n    if (loop === void 0) { loop = false; }\n    if (bus === void 0) { bus = 1; }\n    if (source === 0) {\n        return 0;\n    }\n    var ctx = getContext();\n    if (!ctx) {\n        return 0;\n    }\n    var sourceObj = audioSources[source];\n    if (!sourceObj || sourceObj.isFree) {\n        warn(\"audio source not found\");\n        return 0;\n    }\n    if (!sourceObj.url && !sourceObj.buffer) {\n        warn(\"nothing to play, audio source is empty!\");\n        return 0;\n    }\n    var targetNode = _getBusGain(bus);\n    if (!targetNode) {\n        warn(\"invalid target bus!\");\n        return 0;\n    }\n    var voice = getNextVoice();\n    if (!voice) {\n        warn(\"no more free simple voices!\");\n        return 0;\n    }\n    var voiceObj = _getVoiceObj(voice);\n    if (loop) {\n        voiceObj.cf |= 4 /* Loop */;\n    }\n    if (paused) {\n        voiceObj.cf |= 2 /* Paused */;\n    }\n    voiceObj.rate = 1.0;\n    voiceObj.src = source;\n    voiceObj.gain.gain.value = volume;\n    voiceObj.pan.pan.value = pan;\n    if (sourceObj.url) {\n        var mes = getNextStreamPlayer(sourceObj.url);\n        if (!mes) {\n            warn(\"no more free media stream elements!\");\n            return 0;\n        }\n        voiceObj.stream = mes;\n        mes.el.loop = loop;\n        mes.node.connect(voiceObj.pan);\n        if (!paused) {\n            StreamPlayer_resume(mes);\n            voiceObj.cf |= 1 /* Running */;\n        }\n    }\n    else if (sourceObj.buffer) {\n        Voice_prepareBuffer(voiceObj, ctx, sourceObj.buffer);\n        if (!paused) {\n            Voice_startBuffer(voiceObj);\n        }\n    }\n    // maybe we need to set target before `startBuffer()`\n    Voice_changeDestination(voiceObj, targetNode);\n    Voice_pitch(voiceObj, pitch);\n    return voice;\n}\nexport function stop(voice) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_stop(obj);\n    }\n}\nexport function isVoiceValid(voice) {\n    return _checkVoiceHandle(voice);\n}\nexport function getVoiceState(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.cf : 0;\n}\nexport function setPan(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        obj.pan.pan.value = value;\n    }\n}\nexport function setVolume(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        obj.gain.gain.value = value;\n    }\n}\nexport function setPitch(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_pitch(obj, value);\n    }\n}\nexport function setPause(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_pause(obj, value);\n    }\n}\nexport function setLoop(voice, value) {\n    var obj = _getVoiceObj(voice);\n    if (obj) {\n        Voice_loop(obj, value);\n    }\n}\nexport function getPan(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.pan.pan.value : 0.0;\n}\nexport function getVolume(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.gain.gain.value : 1.0;\n}\nexport function getPitch(voice) {\n    var obj = _getVoiceObj(voice);\n    return obj ? obj.rate : 1.0;\n}\nexport function getPause(voice) {\n    var obj = _getVoiceObj(voice);\n    return !!obj && (obj.cf & 2 /* Paused */) !== 0;\n}\nexport function getLoop(voice) {\n    var obj = _getVoiceObj(voice);\n    return !!obj && (obj.cf & 4 /* Loop */) !== 0;\n}\nexport function stopAudioSource(source) {\n    if (source === 0) {\n        console.warn(\"invalid source\");\n        return;\n    }\n    for (var i = 1; i < voicePool.length; ++i) {\n        var v = voicePool[i];\n        if (v.src === source) {\n            Voice_stop(v);\n        }\n    }\n}\n/** Bus controls **/\nexport function setBusVolume(bus, value) {\n    var gain = _getBusGain(bus);\n    if (gain) {\n        gain.gain.value = value;\n    }\n}\nexport function getBusVolume(bus) {\n    var gain = _getBusGain(bus);\n    return gain ? gain.gain.value : 0.0;\n}\nexport function setBusEnabled(bus, enabled) {\n    var obj = _getBus(bus);\n    if (obj) {\n        Bus_enable(obj, enabled);\n    }\n}\nexport function getBusEnabled(bus) {\n    var obj = _getBus(bus);\n    return !!obj && obj.e;\n}\n/** length / position **/\nexport function getAudioSourceLength(source) {\n    var d = 0.0;\n    if (source !== 0) {\n        var obj = audioSources[source];\n        if (obj) {\n            if (obj.buffer) {\n                obj.buffer.duration;\n            }\n            else if (obj.url) {\n                // TODO: :(\n            }\n        }\n    }\n    return d;\n}\nexport function getVoiceLength(voice) {\n    var obj = _getVoiceObj(voice);\n    var d = 0.0;\n    if (obj) {\n        if (obj.buffer && obj.buffer.buffer) {\n            d = obj.buffer.buffer.duration;\n        }\n        else if (obj.stream) {\n            d = obj.stream.el.duration;\n        }\n    }\n    return d;\n}\nexport function getVoicePosition(voice) {\n    var obj = _getVoiceObj(voice);\n    var d = 0.0;\n    if (obj) {\n        if (obj.buffer && obj.buffer) {\n            // TODO: :(\n        }\n        else if (obj.stream) {\n            d = obj.stream.el.currentTime;\n        }\n    }\n    return d;\n}\n/** Export Constants only for pre-bundled usage **/\nexport var VOICES_IN_USE = 0 /* VoicesInUse */;\nexport var STREAMS_IN_USE = 1 /* StreamsInUse */;\nexport var BUFFERS_LOADED = 2 /* BuffersLoaded */;\nexport var STREAMS_LOADED = 3 /* StreamsLoaded */;\nexport var DEVICE_SAMPLE_RATE = 4 /* Device_SampleRate */;\nexport var DEVICE_STATE = 5 /* Device_State */;\nexport var BUS_MASTER = 0;\nexport var BUS_SFX = 1;\nexport var BUS_MUSIC = 2;\nexport var BUS_SPEECH = 2;\nexport function getDeviceStateString(state) {\n    var _a;\n    return (_a = [\"invalid\", \"running\", \"paused\"][state]) !== null && _a !== void 0 ? _a : \"undefined\";\n}\n//# sourceMappingURL=index.js.map"],"names":["TAG","log","message","console","warn","error","reason","measure","ts","performance","now","ctx","unlockEvents","unlocked","getContext","state","getContextState","resumeAudioContext","resume","then","catch","addEventListener","document","i","length","unlock","setupUnlockHandler","removeEventListener","initContext","AudioContext","latencyHint","sampleRate","suspend","suspendAudioContext","baseLatency","closeContext","_notNullCtx","close","emptyWaveData","StreamPlayer","el","node","this","StreamPlayer_isFree","player","src","StreamPlayer_stop","pause","currentTime","disconnect","StreamPlayer_resume","play","players","getNextStreamPlayer","mes","url","Audio","preload","createMediaElementSource","StreamPlayer_create","push","vMask","VoiceObj","gain","pan","stream","buffer","rate","cf","target","v","Voice_stop","stop","Voice_resetDestination","Voice_startBuffer","source","e","loop","start","Voice_pitch","value","playbackRate","voicePool","_getVoiceObj","handle","obj","getNextVoice","index","createGain","createStereoPanner","connect","Voice_create","AudioSourceObj","isFree","audioSources","BusObj","busPool","Bus_create","_getBus","_getBusGain","_a","stopAudioSource","VOICES_IN_USE","STREAMS_IN_USE","BUFFERS_LOADED","STREAMS_LOADED","DEVICE_SAMPLE_RATE","DEVICE_STATE","sourceObj","duration","bus","param","count","getStreamPlayersCount","voice","d","master","destination","initBusPool","filepath","streaming","timeDecoding_1","fetch","Request","response","arrayBuffer","decodeAudioData","volume","pitch","paused","targetNode","voiceObj","audioBuffer","createBufferSource","Voice_prepareBuffer","Voice_changeDestination","enabled","dest","Bus_enable","Voice_loop","Voice_pause","termBusPool","destroyStreamPlayersPool"],"mappings":"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"}