var auph=function(n){"use strict";var t=805306368,e=255,r=1024;var u=Object.freeze({__proto__:null,init:function(){},shutdown:function(){},load:function(n,t){return 0},loadMemory:function(n,t){return 0},unload:function(n){},voice:function(n,t,e,r,u,i){return 0},stop:function(n){},set:function(n,t,e){},get:function(n,t){return 0}}),i="[AUPH]";function a(n){console.warn(i,n)}function o(n,t){console.error(i,n,t)}var f=null,c=null;function s(){return f&&"closed"!==f.state?f:(a(2),null)}function l(){return f}function d(n){n.resume().then((function(){})).catch((function(n){o(5,n)}))}function v(){return f?(a(14),f):((f=function(n){var t=window,e=t.AudioContext||t.webkitAudioContext;try{return new e}catch(n){o(1,n)}return null}())&&(c||(c=f.createBuffer(1,1,22050)),function(n){for(var t=["touchstart","touchend","mousedown","click","keydown"],e=t.length,r=document,u=function(){if(n())for(var i=0;i<e;++i)r.removeEventListener(t[i],u,!0)},i=0;i<e;++i)r.addEventListener(t[i],u,!0)}((function(){return"suspended"!==f.state||(d(f),!1)}))),f)}function h(n){n.close().then((function(){})).catch((function(n){o(11,n)})),f=null}function g(n){return n+256&16776960|805306623&n}var b=function(n,t,e){var u=this;this.gain=n,this.pan=t,this.h=0,this.s=0,this._gain=r,this._pan=r,this._rate=r,this.data=0,this.bus=0,this._started=!1,this.buffer=null,this.out=null,this._e=function(){_(u)},this.h=805306368|e};function _(n){var t=n.buffer;if(t){0!=(2&n.s)&&t.stop(),t.onended=null,t.disconnect();try{t.buffer=c}catch(n){}n.buffer=null}!function(n){n.out&&(n.gain.disconnect(n.out),n.out=null)}(n),n.data=0,n.bus=0,n.s=0,n.h=g(n.h)}function p(n){var t=n.buffer;t&&!n._started&&(t.onended=n._e,t.loop=0!=(4&n.s),t.start(),n._started=!0)}function w(n,t){2&n.s&&n.buffer&&(n.buffer.playbackRate.value=t/r)}var S=[null];function y(n){var t=S[n&e];return t&&t.h===n?t:null}function E(n){for(var t=1;t<S.length;++t){if(0===(e=S[t]).s)return e.h}var e,r=S.length;return r<64?((e=function(n,t){var e=n.createGain(),r=n.createStereoPanner();return r.connect(e),new b(e,r,t)}(n,r)).h=805306368|r,S.push(e),e.h):0}var A=function(n){this.gain=n,this.h=0,this.s=3,this._gain=r},m=[];function R(n){var t=m.length,e=new A(n.createGain());return e.h=268435456|t,m.push(e),e}function B(n){var t=m[n&e];return t&&t.h===n?t:null}var M=function(n,t,e){this.h=n,this.s=t,this.b=e},C=[null];function P(){for(var n=1;n<C.length;++n){var t=C[n];if(0===t.s)return t.h}var e=C.length;if(e<128){var r=new M(536870912|e,0,null);return C.push(r),r.h}return 0}function U(n){n.h=g(n.h),n.s=0,n.b=null}function O(n){var t=C[n&e];return t&&t.h===n?t:null}function k(n,t,e){n.decodeAudioData(e,(function(n){t.s|=2,t.b=n}),(function(n){o("Error decode audio buffer",n),U(t)}))}function L(n){if(0!==n){var e=n&t;if(805306368===e)(r=y(n))&&_(r);else if(536870912===e){var r;if(r=O(n))for(var u=1;u<S.length;++u){var i=S[u];i.data===n&&_(i)}}}}function T(n,t){for(var e=0,r=1;r<n.length;++r){var u=n[r];u&&(u.s&t)===t&&++e}return e}var x=Object.freeze({__proto__:null,init:function(){var n=v();n&&function(n){var t=R(n).gain;t.connect(n.destination),R(n).gain.connect(t),R(n).gain.connect(t),R(n).gain.connect(t)}(n)},shutdown:function(){var n=s();n&&(!function(){for(var n=0;n<m.length;++n)m[n].gain.disconnect();m.length=0}(),S.length=1,C.length=1,h(n))},load:function(n,t){var r=P();if(r){var u=l();if(!u)return 0;!function(n,t,e,r){n.s|=1,fetch(new Request(e)).then((function(n){return n.arrayBuffer()})).then((function(e){return k(t,n,e)})).catch((function(t){o("Error load file",t),U(n)}))}(C[r&e],u,n)}return r},loadMemory:function(n,t){var r=P();if(r){var u=l();if(!u)return 0;!function(n,t,e,r){n.s|=1,k(t,n,e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}(C[r&e],u,n)}return r},unload:function(n){var t=O(n);t&&(L(n),U(t))},voice:function(n,t,e,u,i,a){if(-7&i)return 0;var o=l();if(!o||"running"!==o.state)return null==o||o.state,0;var f=O(n);if(!f)return 0;if(!(2&f.s))return 0;if(!f.b)return 0;var c,s=(c=B(a||268435457))?c.gain:void 0;if(!s)return 0;var d=E(o);if(0===d)return 0;var v=y(d);return v.s=1|i,v.data=n,v._gain=t,v._pan=e,v._rate=u,v.gain.gain.value=t/r,v.pan.pan.value=e/r-1,function(n,t,e){var r=t.createBufferSource();r.buffer=e,r.connect(n.pan),n.buffer=r,n._started=!1}(v,o,f.b),2&i&&p(v),function(n,t){if(t!==n.out){var e=n.gain;n.out&&e.disconnect(n.out),n.out=t,t&&e.connect(t)}}(v,s),w(v,u),d},stop:L,set:function(n,e,u){if(0!==n){if(1===n&&128&e&&2&e){var i=s();i&&(u&&"suspended"===i.state?d(i):u||"running"!==i.state||function(n){n.suspend().then((function(){})).catch((function(n){o(8,n)}))}(i))}var a=n&t;if(805306368===a){if(c=y(n))if(128&e){var f=0!==u;2&e?function(n,t){if(t!==!!(2&n.s)){n.s^=2;var e=t?n._rate/r:0;n.buffer&&(n.buffer.playbackRate.value=e,t&&p(n))}}(c,f):4&e&&function(n,t){t!==(0!=(4&n.s))&&(n.s^=4,n.buffer&&(n.buffer.loop=t))}(c,f)}else switch(e){case 1:c._gain!==u&&(c._gain=u,c.gain.gain.value=u/r);break;case 2:c._pan!==u&&(c._pan=u,c.pan.pan.value=u/r-1);break;case 3:c._rate!==u&&(c._rate=u,w(c,u))}}else if(268435456===a){var c;if(c=B(n))if(128&e)2&e&&function(n,t){if(!!(2&n.s)!==t){var e=m[0],r=n===e?l().destination:e.gain;t?n.gain.connect(r):n.gain.disconnect(r),n.s^=2}}(c,!!u);else switch(e){case 1:c._gain!==u&&(c.gain.gain.value=u/r,c._gain=u)}}}},get:function(n,u){if(1===n){var i=l();if(i){if(0===u)return function(n){var t=0;return"closed"!==n.state&&(t|=1,"running"===n.state&&(t|=2)),t}(i);if(5===u)return 0|i.sampleRate}return 0}var o=n&t;if(256&u&&!(n&e)){var f=127&u;return 805306368===o?T(S,f):268435456===o?T(m,f):536870912===o?T(C,f):0}if(805306368===o){if(s=y(n))switch(u){case 0:return s.s;case 1:return s._gain;case 2:return s._pan;case 3:return s._rate;case 6:var c=0;return s.buffer&&s.buffer.buffer&&(c=s.buffer.buffer.duration*r),c*r|0;case 4:c=0;return s.buffer&&s.buffer.buffer,c*r|0;default:a(1)}return 0}if(268435456===o){if(s=B(n))switch(u){case 0:return s.s;case 1:return s._gain;default:a(1)}return 0}if(536870912===o){var s;if(s=O(n))switch(u){case 0:return s.s;case 6:c=0;return s.b&&(c=s.b.duration),c*r|0;default:a(1)}return 0}return 0}});var G="undefined"!=typeof process?require("bindings")("auph"):"undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext)?x:u,I=G.init,N=G.shutdown,j=G.set,F=G.get,q=G.load,z=G.loadMemory,D=G.unload,H=G.stop;function V(n,t){j(n,130,0|!t)}function X(n){return n*r|0}return n.ACTIVE=1,n.BUFFER=536870912,n.BUS=268435456,n.BUS_MASTER=268435456,n.BUS_MUSIC=268435458,n.BUS_SFX=268435457,n.BUS_SPEECH=268435459,n.COUNT=256,n.LOOP=4,n.MIXER=1,n.RUNNING=2,n.SAMPLE_RATE=5,n.STATE=0,n.STREAM=4,n.VOICE=805306368,n.get=F,n.getBufferStateString=function(n){return["free","loading","","loaded"][3&n]+[""," streaming"][n>>>2&1]},n.getCurrentTime=function(n){return F(n,4)/r},n.getDuration=function(n){return F(n,6)/r},n.getGain=function(n){return F(n,1)/r},n.getLoop=function(n){return!!(4&F(n,0))},n.getMixerStateString=function(n){return["closed","paused","","running"][3&n]},n.getPan=function(n){return F(n,2)/r-1},n.getPause=function(n){return!(2&F(n,0))},n.getRate=function(n){return F(n,3)/r},n.init=I,n.isActive=function(n){return!!(1&F(n,0))},n.isBufferLoaded=function(n){return 3==(3&F(n,0))},n.load=q,n.loadMemory=z,n.pause=function(n){void 0===n&&(n=1),V(n,!0)},n.play=function(n,t,e,r,u,i,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=1);var o=0;return u&&(o|=4),i||(o|=2),G.voice(n,X(t),X(+e+1),X(r),o,0|a)},n.resume=function(n){void 0===n&&(n=1),V(n,!1)},n.set=j,n.setGain=function(n,t){j(n,1,X(t))},n.setLoop=function(n,t){j(n,132,0|t)},n.setPan=function(n,t){j(n,2,X(+t+1))},n.setPause=V,n.setRate=function(n,t){j(n,3,X(t))},n.shutdown=N,n.stop=H,n.unload=D,Object.defineProperty(n,"__esModule",{value:!0}),n}({});//# sourceMappingURL=auph.js.map
